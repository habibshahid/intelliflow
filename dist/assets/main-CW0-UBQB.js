import{r as S,g as Ri,R as B,a as Ai,j as l,c as Le,X as tt,C as Ii,b as Dt,T as vn,P as or,L as sr,S as ir,D as Di,A as pt,d as So,e as Pi,U as Oi,f as Bi,h as Hi}from"./index-BXICclDe.js";function he(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,r;n<e.length;n++)(r=he(e[n]))!==""&&(t+=(t&&" ")+r);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var _o={exports:{}},Eo={},ko={exports:{}},jo={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var St=S;function Li(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Fi=typeof Object.is=="function"?Object.is:Li,Vi=St.useState,Wi=St.useEffect,Yi=St.useLayoutEffect,Xi=St.useDebugValue;function qi(e,t){var n=t(),r=Vi({inst:{value:n,getSnapshot:t}}),o=r[0].inst,i=r[1];return Yi(function(){o.value=n,o.getSnapshot=t,Mn(o)&&i({inst:o})},[e,n,t]),Wi(function(){return Mn(o)&&i({inst:o}),e(function(){Mn(o)&&i({inst:o})})},[e]),Xi(n),n}function Mn(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Fi(e,n)}catch{return!0}}function Ui(e,t){return t()}var Gi=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Ui:qi;jo.useSyncExternalStore=St.useSyncExternalStore!==void 0?St.useSyncExternalStore:Gi;ko.exports=jo;var Zi=ko.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wn=S,Ki=Zi;function Ji(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Qi=typeof Object.is=="function"?Object.is:Ji,ea=Ki.useSyncExternalStore,ta=wn.useRef,na=wn.useEffect,ra=wn.useMemo,oa=wn.useDebugValue;Eo.useSyncExternalStoreWithSelector=function(e,t,n,r,o){var i=ta(null);if(i.current===null){var s={hasValue:!1,value:null};i.current=s}else s=i.current;i=ra(function(){function u(x){if(!c){if(c=!0,d=x,x=r(x),o!==void 0&&s.hasValue){var m=s.value;if(o(m,x))return p=m}return p=x}if(m=p,Qi(d,x))return m;var y=r(x);return o!==void 0&&o(m,y)?(d=x,m):(d=x,p=y)}var c=!1,d,p,g=n===void 0?null:n;return[function(){return u(t())},g===null?void 0:function(){return u(g())}]},[t,n,r,o]);var a=ea(e,i[0],i[1]);return na(function(){s.hasValue=!0,s.value=a},[a]),oa(a),a};_o.exports=Eo;var sa=_o.exports;const ia=Ri(sa),aa={},$r=e=>{let t;const n=new Set,r=(d,p)=>{const g=typeof d=="function"?d(t):d;if(!Object.is(g,t)){const x=t;t=p??(typeof g!="object"||g===null)?g:Object.assign({},t,g),n.forEach(m=>m(t,x))}},o=()=>t,u={setState:r,getState:o,getInitialState:()=>c,subscribe:d=>(n.add(d),()=>n.delete(d)),destroy:()=>{(aa?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},c=t=e(r,o,u);return u},la=e=>e?$r(e):$r,{useDebugValue:ca}=B,{useSyncExternalStoreWithSelector:ua}=ia,da=e=>e;function Co(e,t=da,n){const r=ua(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return ca(r),r}const Mr=(e,t)=>{const n=la(e),r=(o,i=t)=>Co(n,o,i);return Object.assign(r,n),r},fa=(e,t)=>e?Mr(e,t):Mr;function fe(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[r,o]of e)if(!Object.is(o,t.get(r)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}var pa={value:()=>{}};function Sn(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new sn(n)}function sn(e){this._=e}function ha(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",o=n.indexOf(".");if(o>=0&&(r=n.slice(o+1),n=n.slice(0,o)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}sn.prototype=Sn.prototype={constructor:sn,on:function(e,t){var n=this._,r=ha(e+"",n),o,i=-1,s=r.length;if(arguments.length<2){for(;++i<s;)if((o=(e=r[i]).type)&&(o=ga(n[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(o=(e=r[i]).type)n[o]=Rr(n[o],e.name,t);else if(t==null)for(o in n)n[o]=Rr(n[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new sn(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var n=new Array(o),r=0,o,i;r<o;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,i=r.length;o<i;++o)r[o].value.apply(t,n)}};function ga(e,t){for(var n=0,r=e.length,o;n<r;++n)if((o=e[n]).name===t)return o.value}function Rr(e,t,n){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=pa,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var Vn="http://www.w3.org/1999/xhtml";const Ar={svg:"http://www.w3.org/2000/svg",xhtml:Vn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function _n(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Ar.hasOwnProperty(t)?{space:Ar[t],local:e}:e}function xa(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Vn&&t.documentElement.namespaceURI===Vn?t.createElement(e):t.createElementNS(n,e)}}function ya(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function To(e){var t=_n(e);return(t.local?ya:xa)(t)}function ma(){}function ar(e){return e==null?ma:function(){return this.querySelector(e)}}function ba(e){typeof e!="function"&&(e=ar(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=new Array(s),u,c,d=0;d<s;++d)(u=i[d])&&(c=e.call(u,u.__data__,d,i))&&("__data__"in u&&(c.__data__=u.__data__),a[d]=c);return new be(r,this._parents)}function va(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function wa(){return[]}function No(e){return e==null?wa:function(){return this.querySelectorAll(e)}}function Sa(e){return function(){return va(e.apply(this,arguments))}}function _a(e){typeof e=="function"?e=Sa(e):e=No(e);for(var t=this._groups,n=t.length,r=[],o=[],i=0;i<n;++i)for(var s=t[i],a=s.length,u,c=0;c<a;++c)(u=s[c])&&(r.push(e.call(u,u.__data__,c,s)),o.push(u));return new be(r,o)}function zo(e){return function(){return this.matches(e)}}function $o(e){return function(t){return t.matches(e)}}var Ea=Array.prototype.find;function ka(e){return function(){return Ea.call(this.children,e)}}function ja(){return this.firstElementChild}function Ca(e){return this.select(e==null?ja:ka(typeof e=="function"?e:$o(e)))}var Ta=Array.prototype.filter;function Na(){return Array.from(this.children)}function za(e){return function(){return Ta.call(this.children,e)}}function $a(e){return this.selectAll(e==null?Na:za(typeof e=="function"?e:$o(e)))}function Ma(e){typeof e!="function"&&(e=zo(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=[],u,c=0;c<s;++c)(u=i[c])&&e.call(u,u.__data__,c,i)&&a.push(u);return new be(r,this._parents)}function Mo(e){return new Array(e.length)}function Ra(){return new be(this._enter||this._groups.map(Mo),this._parents)}function dn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}dn.prototype={constructor:dn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Aa(e){return function(){return e}}function Ia(e,t,n,r,o,i){for(var s=0,a,u=t.length,c=i.length;s<c;++s)(a=t[s])?(a.__data__=i[s],r[s]=a):n[s]=new dn(e,i[s]);for(;s<u;++s)(a=t[s])&&(o[s]=a)}function Da(e,t,n,r,o,i,s){var a,u,c=new Map,d=t.length,p=i.length,g=new Array(d),x;for(a=0;a<d;++a)(u=t[a])&&(g[a]=x=s.call(u,u.__data__,a,t)+"",c.has(x)?o[a]=u:c.set(x,u));for(a=0;a<p;++a)x=s.call(e,i[a],a,i)+"",(u=c.get(x))?(r[a]=u,u.__data__=i[a],c.delete(x)):n[a]=new dn(e,i[a]);for(a=0;a<d;++a)(u=t[a])&&c.get(g[a])===u&&(o[a]=u)}function Pa(e){return e.__data__}function Oa(e,t){if(!arguments.length)return Array.from(this,Pa);var n=t?Da:Ia,r=this._parents,o=this._groups;typeof e!="function"&&(e=Aa(e));for(var i=o.length,s=new Array(i),a=new Array(i),u=new Array(i),c=0;c<i;++c){var d=r[c],p=o[c],g=p.length,x=Ba(e.call(d,d&&d.__data__,c,r)),m=x.length,y=a[c]=new Array(m),k=s[c]=new Array(m),h=u[c]=new Array(g);n(d,p,y,k,h,x,t);for(var b=0,R=0,C,H;b<m;++b)if(C=y[b]){for(b>=R&&(R=b+1);!(H=k[R])&&++R<m;);C._next=H||null}}return s=new be(s,r),s._enter=a,s._exit=u,s}function Ba(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Ha(){return new be(this._exit||this._groups.map(Mo),this._parents)}function La(e,t,n){var r=this.enter(),o=this,i=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),n==null?i.remove():n(i),r&&o?r.merge(o).order():o}function Fa(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,o=n.length,i=r.length,s=Math.min(o,i),a=new Array(o),u=0;u<s;++u)for(var c=n[u],d=r[u],p=c.length,g=a[u]=new Array(p),x,m=0;m<p;++m)(x=c[m]||d[m])&&(g[m]=x);for(;u<o;++u)a[u]=n[u];return new be(a,this._parents)}function Va(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],o=r.length-1,i=r[o],s;--o>=0;)(s=r[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function Wa(e){e||(e=Ya);function t(p,g){return p&&g?e(p.__data__,g.__data__):!p-!g}for(var n=this._groups,r=n.length,o=new Array(r),i=0;i<r;++i){for(var s=n[i],a=s.length,u=o[i]=new Array(a),c,d=0;d<a;++d)(c=s[d])&&(u[d]=c);u.sort(t)}return new be(o,this._parents).order()}function Ya(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Xa(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function qa(){return Array.from(this)}function Ua(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length;o<i;++o){var s=r[o];if(s)return s}return null}function Ga(){let e=0;for(const t of this)++e;return e}function Za(){return!this.node()}function Ka(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o=t[n],i=0,s=o.length,a;i<s;++i)(a=o[i])&&e.call(a,a.__data__,i,o);return this}function Ja(e){return function(){this.removeAttribute(e)}}function Qa(e){return function(){this.removeAttributeNS(e.space,e.local)}}function el(e,t){return function(){this.setAttribute(e,t)}}function tl(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function nl(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function rl(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function ol(e,t){var n=_n(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Qa:Ja:typeof t=="function"?n.local?rl:nl:n.local?tl:el)(n,t))}function Ro(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function sl(e){return function(){this.style.removeProperty(e)}}function il(e,t,n){return function(){this.style.setProperty(e,t,n)}}function al(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function ll(e,t,n){return arguments.length>1?this.each((t==null?sl:typeof t=="function"?al:il)(e,t,n??"")):_t(this.node(),e)}function _t(e,t){return e.style.getPropertyValue(t)||Ro(e).getComputedStyle(e,null).getPropertyValue(t)}function cl(e){return function(){delete this[e]}}function ul(e,t){return function(){this[e]=t}}function dl(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function fl(e,t){return arguments.length>1?this.each((t==null?cl:typeof t=="function"?dl:ul)(e,t)):this.node()[e]}function Ao(e){return e.trim().split(/^|\s+/)}function lr(e){return e.classList||new Io(e)}function Io(e){this._node=e,this._names=Ao(e.getAttribute("class")||"")}Io.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Do(e,t){for(var n=lr(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function Po(e,t){for(var n=lr(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function pl(e){return function(){Do(this,e)}}function hl(e){return function(){Po(this,e)}}function gl(e,t){return function(){(t.apply(this,arguments)?Do:Po)(this,e)}}function xl(e,t){var n=Ao(e+"");if(arguments.length<2){for(var r=lr(this.node()),o=-1,i=n.length;++o<i;)if(!r.contains(n[o]))return!1;return!0}return this.each((typeof t=="function"?gl:t?pl:hl)(n,t))}function yl(){this.textContent=""}function ml(e){return function(){this.textContent=e}}function bl(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function vl(e){return arguments.length?this.each(e==null?yl:(typeof e=="function"?bl:ml)(e)):this.node().textContent}function wl(){this.innerHTML=""}function Sl(e){return function(){this.innerHTML=e}}function _l(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function El(e){return arguments.length?this.each(e==null?wl:(typeof e=="function"?_l:Sl)(e)):this.node().innerHTML}function kl(){this.nextSibling&&this.parentNode.appendChild(this)}function jl(){return this.each(kl)}function Cl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Tl(){return this.each(Cl)}function Nl(e){var t=typeof e=="function"?e:To(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function zl(){return null}function $l(e,t){var n=typeof e=="function"?e:To(e),r=t==null?zl:typeof t=="function"?t:ar(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Ml(){var e=this.parentNode;e&&e.removeChild(this)}function Rl(){return this.each(Ml)}function Al(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Il(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Dl(e){return this.select(e?Il:Al)}function Pl(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Ol(e){return function(t){e.call(this,t,this.__data__)}}function Bl(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function Hl(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,o=t.length,i;n<o;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++r]=i;++r?t.length=r:delete this.__on}}}function Ll(e,t,n){return function(){var r=this.__on,o,i=Ol(t);if(r){for(var s=0,a=r.length;s<a;++s)if((o=r[s]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=n),o.value=t;return}}this.addEventListener(e.type,i,n),o={type:e.type,name:e.name,value:t,listener:i,options:n},r?r.push(o):this.__on=[o]}}function Fl(e,t,n){var r=Bl(e+""),o,i=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var u=0,c=a.length,d;u<c;++u)for(o=0,d=a[u];o<i;++o)if((s=r[o]).type===d.type&&s.name===d.name)return d.value}return}for(a=t?Ll:Hl,o=0;o<i;++o)this.each(a(r[o],t,n));return this}function Oo(e,t,n){var r=Ro(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function Vl(e,t){return function(){return Oo(this,e,t)}}function Wl(e,t){return function(){return Oo(this,e,t.apply(this,arguments))}}function Yl(e,t){return this.each((typeof t=="function"?Wl:Vl)(e,t))}function*Xl(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length,s;o<i;++o)(s=r[o])&&(yield s)}var Bo=[null];function be(e,t){this._groups=e,this._parents=t}function Ut(){return new be([[document.documentElement]],Bo)}function ql(){return this}be.prototype=Ut.prototype={constructor:be,select:ba,selectAll:_a,selectChild:Ca,selectChildren:$a,filter:Ma,data:Oa,enter:Ra,exit:Ha,join:La,merge:Fa,selection:ql,order:Va,sort:Wa,call:Xa,nodes:qa,node:Ua,size:Ga,empty:Za,each:Ka,attr:ol,style:ll,property:fl,classed:xl,text:vl,html:El,raise:jl,lower:Tl,append:Nl,insert:$l,remove:Rl,clone:Dl,datum:Pl,on:Fl,dispatch:Yl,[Symbol.iterator]:Xl};function ve(e){return typeof e=="string"?new be([[document.querySelector(e)]],[document.documentElement]):new be([[e]],Bo)}function Ul(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Ee(e,t){if(e=Ul(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const Gl={passive:!1},Ht={capture:!0,passive:!1};function Rn(e){e.stopImmediatePropagation()}function bt(e){e.preventDefault(),e.stopImmediatePropagation()}function Ho(e){var t=e.document.documentElement,n=ve(e).on("dragstart.drag",bt,Ht);"onselectstart"in t?n.on("selectstart.drag",bt,Ht):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Lo(e,t){var n=e.document.documentElement,r=ve(e).on("dragstart.drag",null);t&&(r.on("click.drag",bt,Ht),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Zt=e=>()=>e;function Wn(e,{sourceEvent:t,subject:n,target:r,identifier:o,active:i,x:s,y:a,dx:u,dy:c,dispatch:d}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:d}})}Wn.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function Zl(e){return!e.ctrlKey&&!e.button}function Kl(){return this.parentNode}function Jl(e,t){return t??{x:e.x,y:e.y}}function Ql(){return navigator.maxTouchPoints||"ontouchstart"in this}function ec(){var e=Zl,t=Kl,n=Jl,r=Ql,o={},i=Sn("start","drag","end"),s=0,a,u,c,d,p=0;function g(C){C.on("mousedown.drag",x).filter(r).on("touchstart.drag",k).on("touchmove.drag",h,Gl).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function x(C,H){if(!(d||!e.call(this,C,H))){var _=R(this,t.call(this,C,H),C,H,"mouse");_&&(ve(C.view).on("mousemove.drag",m,Ht).on("mouseup.drag",y,Ht),Ho(C.view),Rn(C),c=!1,a=C.clientX,u=C.clientY,_("start",C))}}function m(C){if(bt(C),!c){var H=C.clientX-a,_=C.clientY-u;c=H*H+_*_>p}o.mouse("drag",C)}function y(C){ve(C.view).on("mousemove.drag mouseup.drag",null),Lo(C.view,c),bt(C),o.mouse("end",C)}function k(C,H){if(e.call(this,C,H)){var _=C.changedTouches,A=t.call(this,C,H),$=_.length,I,N;for(I=0;I<$;++I)(N=R(this,A,C,H,_[I].identifier,_[I]))&&(Rn(C),N("start",C,_[I]))}}function h(C){var H=C.changedTouches,_=H.length,A,$;for(A=0;A<_;++A)($=o[H[A].identifier])&&(bt(C),$("drag",C,H[A]))}function b(C){var H=C.changedTouches,_=H.length,A,$;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),A=0;A<_;++A)($=o[H[A].identifier])&&(Rn(C),$("end",C,H[A]))}function R(C,H,_,A,$,I){var N=i.copy(),L=Ee(I||_,H),P,w,f;if((f=n.call(C,new Wn("beforestart",{sourceEvent:_,target:g,identifier:$,active:s,x:L[0],y:L[1],dx:0,dy:0,dispatch:N}),A))!=null)return P=f.x-L[0]||0,w=f.y-L[1]||0,function T(j,D,z){var E=L,v;switch(j){case"start":o[$]=T,v=s++;break;case"end":delete o[$],--s;case"drag":L=Ee(z||D,H),v=s;break}N.call(j,C,new Wn(j,{sourceEvent:D,subject:f,target:g,identifier:$,active:v,x:L[0]+P,y:L[1]+w,dx:L[0]-E[0],dy:L[1]-E[1],dispatch:N}),A)}}return g.filter=function(C){return arguments.length?(e=typeof C=="function"?C:Zt(!!C),g):e},g.container=function(C){return arguments.length?(t=typeof C=="function"?C:Zt(C),g):t},g.subject=function(C){return arguments.length?(n=typeof C=="function"?C:Zt(C),g):n},g.touchable=function(C){return arguments.length?(r=typeof C=="function"?C:Zt(!!C),g):r},g.on=function(){var C=i.on.apply(i,arguments);return C===i?g:C},g.clickDistance=function(C){return arguments.length?(p=(C=+C)*C,g):Math.sqrt(p)},g}function cr(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Fo(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Gt(){}var Lt=.7,fn=1/Lt,vt="\\s*([+-]?\\d+)\\s*",Ft="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",$e="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",tc=/^#([0-9a-f]{3,8})$/,nc=new RegExp(`^rgb\\(${vt},${vt},${vt}\\)$`),rc=new RegExp(`^rgb\\(${$e},${$e},${$e}\\)$`),oc=new RegExp(`^rgba\\(${vt},${vt},${vt},${Ft}\\)$`),sc=new RegExp(`^rgba\\(${$e},${$e},${$e},${Ft}\\)$`),ic=new RegExp(`^hsl\\(${Ft},${$e},${$e}\\)$`),ac=new RegExp(`^hsla\\(${Ft},${$e},${$e},${Ft}\\)$`),Ir={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};cr(Gt,Vt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Dr,formatHex:Dr,formatHex8:lc,formatHsl:cc,formatRgb:Pr,toString:Pr});function Dr(){return this.rgb().formatHex()}function lc(){return this.rgb().formatHex8()}function cc(){return Vo(this).formatHsl()}function Pr(){return this.rgb().formatRgb()}function Vt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=tc.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Or(t):n===3?new ye(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Kt(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Kt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=nc.exec(e))?new ye(t[1],t[2],t[3],1):(t=rc.exec(e))?new ye(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=oc.exec(e))?Kt(t[1],t[2],t[3],t[4]):(t=sc.exec(e))?Kt(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=ic.exec(e))?Lr(t[1],t[2]/100,t[3]/100,1):(t=ac.exec(e))?Lr(t[1],t[2]/100,t[3]/100,t[4]):Ir.hasOwnProperty(e)?Or(Ir[e]):e==="transparent"?new ye(NaN,NaN,NaN,0):null}function Or(e){return new ye(e>>16&255,e>>8&255,e&255,1)}function Kt(e,t,n,r){return r<=0&&(e=t=n=NaN),new ye(e,t,n,r)}function uc(e){return e instanceof Gt||(e=Vt(e)),e?(e=e.rgb(),new ye(e.r,e.g,e.b,e.opacity)):new ye}function Yn(e,t,n,r){return arguments.length===1?uc(e):new ye(e,t,n,r??1)}function ye(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}cr(ye,Yn,Fo(Gt,{brighter(e){return e=e==null?fn:Math.pow(fn,e),new ye(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Lt:Math.pow(Lt,e),new ye(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ye(st(this.r),st(this.g),st(this.b),pn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Br,formatHex:Br,formatHex8:dc,formatRgb:Hr,toString:Hr}));function Br(){return`#${nt(this.r)}${nt(this.g)}${nt(this.b)}`}function dc(){return`#${nt(this.r)}${nt(this.g)}${nt(this.b)}${nt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Hr(){const e=pn(this.opacity);return`${e===1?"rgb(":"rgba("}${st(this.r)}, ${st(this.g)}, ${st(this.b)}${e===1?")":`, ${e})`}`}function pn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function st(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function nt(e){return e=st(e),(e<16?"0":"")+e.toString(16)}function Lr(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new je(e,t,n,r)}function Vo(e){if(e instanceof je)return new je(e.h,e.s,e.l,e.opacity);if(e instanceof Gt||(e=Vt(e)),!e)return new je;if(e instanceof je)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,o=Math.min(t,n,r),i=Math.max(t,n,r),s=NaN,a=i-o,u=(i+o)/2;return a?(t===i?s=(n-r)/a+(n<r)*6:n===i?s=(r-t)/a+2:s=(t-n)/a+4,a/=u<.5?i+o:2-i-o,s*=60):a=u>0&&u<1?0:s,new je(s,a,u,e.opacity)}function fc(e,t,n,r){return arguments.length===1?Vo(e):new je(e,t,n,r??1)}function je(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}cr(je,fc,Fo(Gt,{brighter(e){return e=e==null?fn:Math.pow(fn,e),new je(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Lt:Math.pow(Lt,e),new je(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,o=2*n-r;return new ye(An(e>=240?e-240:e+120,o,r),An(e,o,r),An(e<120?e+240:e-120,o,r),this.opacity)},clamp(){return new je(Fr(this.h),Jt(this.s),Jt(this.l),pn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=pn(this.opacity);return`${e===1?"hsl(":"hsla("}${Fr(this.h)}, ${Jt(this.s)*100}%, ${Jt(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Fr(e){return e=(e||0)%360,e<0?e+360:e}function Jt(e){return Math.max(0,Math.min(1,e||0))}function An(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Wo=e=>()=>e;function pc(e,t){return function(n){return e+n*t}}function hc(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function gc(e){return(e=+e)==1?Yo:function(t,n){return n-t?hc(t,n,e):Wo(isNaN(t)?n:t)}}function Yo(e,t){var n=t-e;return n?pc(e,n):Wo(isNaN(e)?t:e)}const Vr=function e(t){var n=gc(t);function r(o,i){var s=n((o=Yn(o)).r,(i=Yn(i)).r),a=n(o.g,i.g),u=n(o.b,i.b),c=Yo(o.opacity,i.opacity);return function(d){return o.r=s(d),o.g=a(d),o.b=u(d),o.opacity=c(d),o+""}}return r.gamma=e,r}(1);function Ve(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Xn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,In=new RegExp(Xn.source,"g");function xc(e){return function(){return e}}function yc(e){return function(t){return e(t)+""}}function mc(e,t){var n=Xn.lastIndex=In.lastIndex=0,r,o,i,s=-1,a=[],u=[];for(e=e+"",t=t+"";(r=Xn.exec(e))&&(o=In.exec(t));)(i=o.index)>n&&(i=t.slice(n,i),a[s]?a[s]+=i:a[++s]=i),(r=r[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,u.push({i:s,x:Ve(r,o)})),n=In.lastIndex;return n<t.length&&(i=t.slice(n),a[s]?a[s]+=i:a[++s]=i),a.length<2?u[0]?yc(u[0].x):xc(t):(t=u.length,function(c){for(var d=0,p;d<t;++d)a[(p=u[d]).i]=p.x(c);return a.join("")})}var Wr=180/Math.PI,qn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Xo(e,t,n,r,o,i){var s,a,u;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,u/=a),e*r<t*n&&(e=-e,t=-t,u=-u,s=-s),{translateX:o,translateY:i,rotate:Math.atan2(t,e)*Wr,skewX:Math.atan(u)*Wr,scaleX:s,scaleY:a}}var Qt;function bc(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?qn:Xo(t.a,t.b,t.c,t.d,t.e,t.f)}function vc(e){return e==null||(Qt||(Qt=document.createElementNS("http://www.w3.org/2000/svg","g")),Qt.setAttribute("transform",e),!(e=Qt.transform.baseVal.consolidate()))?qn:(e=e.matrix,Xo(e.a,e.b,e.c,e.d,e.e,e.f))}function qo(e,t,n,r){function o(c){return c.length?c.pop()+" ":""}function i(c,d,p,g,x,m){if(c!==p||d!==g){var y=x.push("translate(",null,t,null,n);m.push({i:y-4,x:Ve(c,p)},{i:y-2,x:Ve(d,g)})}else(p||g)&&x.push("translate("+p+t+g+n)}function s(c,d,p,g){c!==d?(c-d>180?d+=360:d-c>180&&(c+=360),g.push({i:p.push(o(p)+"rotate(",null,r)-2,x:Ve(c,d)})):d&&p.push(o(p)+"rotate("+d+r)}function a(c,d,p,g){c!==d?g.push({i:p.push(o(p)+"skewX(",null,r)-2,x:Ve(c,d)}):d&&p.push(o(p)+"skewX("+d+r)}function u(c,d,p,g,x,m){if(c!==p||d!==g){var y=x.push(o(x)+"scale(",null,",",null,")");m.push({i:y-4,x:Ve(c,p)},{i:y-2,x:Ve(d,g)})}else(p!==1||g!==1)&&x.push(o(x)+"scale("+p+","+g+")")}return function(c,d){var p=[],g=[];return c=e(c),d=e(d),i(c.translateX,c.translateY,d.translateX,d.translateY,p,g),s(c.rotate,d.rotate,p,g),a(c.skewX,d.skewX,p,g),u(c.scaleX,c.scaleY,d.scaleX,d.scaleY,p,g),c=d=null,function(x){for(var m=-1,y=g.length,k;++m<y;)p[(k=g[m]).i]=k.x(x);return p.join("")}}}var wc=qo(bc,"px, ","px)","deg)"),Sc=qo(vc,", ",")",")"),_c=1e-12;function Yr(e){return((e=Math.exp(e))+1/e)/2}function Ec(e){return((e=Math.exp(e))-1/e)/2}function kc(e){return((e=Math.exp(2*e))-1)/(e+1)}const jc=function e(t,n,r){function o(i,s){var a=i[0],u=i[1],c=i[2],d=s[0],p=s[1],g=s[2],x=d-a,m=p-u,y=x*x+m*m,k,h;if(y<_c)h=Math.log(g/c)/t,k=function(A){return[a+A*x,u+A*m,c*Math.exp(t*A*h)]};else{var b=Math.sqrt(y),R=(g*g-c*c+r*y)/(2*c*n*b),C=(g*g-c*c-r*y)/(2*g*n*b),H=Math.log(Math.sqrt(R*R+1)-R),_=Math.log(Math.sqrt(C*C+1)-C);h=(_-H)/t,k=function(A){var $=A*h,I=Yr(H),N=c/(n*b)*(I*kc(t*$+H)-Ec(H));return[a+N*x,u+N*m,c*I/Yr(t*$+H)]}}return k.duration=h*1e3*t/Math.SQRT2,k}return o.rho=function(i){var s=Math.max(.001,+i),a=s*s,u=a*a;return e(s,a,u)},o}(Math.SQRT2,2,4);var Et=0,Pt=0,$t=0,Uo=1e3,hn,Ot,gn=0,lt=0,En=0,Wt=typeof performance=="object"&&performance.now?performance:Date,Go=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function ur(){return lt||(Go(Cc),lt=Wt.now()+En)}function Cc(){lt=0}function xn(){this._call=this._time=this._next=null}xn.prototype=Zo.prototype={constructor:xn,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?ur():+n)+(t==null?0:+t),!this._next&&Ot!==this&&(Ot?Ot._next=this:hn=this,Ot=this),this._call=e,this._time=n,Un()},stop:function(){this._call&&(this._call=null,this._time=1/0,Un())}};function Zo(e,t,n){var r=new xn;return r.restart(e,t,n),r}function Tc(){ur(),++Et;for(var e=hn,t;e;)(t=lt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Et}function Xr(){lt=(gn=Wt.now())+En,Et=Pt=0;try{Tc()}finally{Et=0,zc(),lt=0}}function Nc(){var e=Wt.now(),t=e-gn;t>Uo&&(En-=t,gn=e)}function zc(){for(var e,t=hn,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:hn=n);Ot=e,Un(r)}function Un(e){if(!Et){Pt&&(Pt=clearTimeout(Pt));var t=e-lt;t>24?(e<1/0&&(Pt=setTimeout(Xr,e-Wt.now()-En)),$t&&($t=clearInterval($t))):($t||(gn=Wt.now(),$t=setInterval(Nc,Uo)),Et=1,Go(Xr))}}function qr(e,t,n){var r=new xn;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,n),r}var $c=Sn("start","end","cancel","interrupt"),Mc=[],Ko=0,Ur=1,Gn=2,an=3,Gr=4,Zn=5,ln=6;function kn(e,t,n,r,o,i){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;Rc(e,n,{name:t,index:r,group:o,on:$c,tween:Mc,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Ko})}function dr(e,t){var n=Te(e,t);if(n.state>Ko)throw new Error("too late; already scheduled");return n}function Me(e,t){var n=Te(e,t);if(n.state>an)throw new Error("too late; already running");return n}function Te(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Rc(e,t,n){var r=e.__transition,o;r[t]=n,n.timer=Zo(i,0,n.time);function i(c){n.state=Ur,n.timer.restart(s,n.delay,n.time),n.delay<=c&&s(c-n.delay)}function s(c){var d,p,g,x;if(n.state!==Ur)return u();for(d in r)if(x=r[d],x.name===n.name){if(x.state===an)return qr(s);x.state===Gr?(x.state=ln,x.timer.stop(),x.on.call("interrupt",e,e.__data__,x.index,x.group),delete r[d]):+d<t&&(x.state=ln,x.timer.stop(),x.on.call("cancel",e,e.__data__,x.index,x.group),delete r[d])}if(qr(function(){n.state===an&&(n.state=Gr,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=Gn,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Gn){for(n.state=an,o=new Array(g=n.tween.length),d=0,p=-1;d<g;++d)(x=n.tween[d].value.call(e,e.__data__,n.index,n.group))&&(o[++p]=x);o.length=p+1}}function a(c){for(var d=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(u),n.state=Zn,1),p=-1,g=o.length;++p<g;)o[p].call(e,d);n.state===Zn&&(n.on.call("end",e,e.__data__,n.index,n.group),u())}function u(){n.state=ln,n.timer.stop(),delete r[t];for(var c in r)return;delete e.__transition}}function cn(e,t){var n=e.__transition,r,o,i=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((r=n[s]).name!==t){i=!1;continue}o=r.state>Gn&&r.state<Zn,r.state=ln,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[s]}i&&delete e.__transition}}function Ac(e){return this.each(function(){cn(this,e)})}function Ic(e,t){var n,r;return function(){var o=Me(this,e),i=o.tween;if(i!==n){r=n=i;for(var s=0,a=r.length;s<a;++s)if(r[s].name===t){r=r.slice(),r.splice(s,1);break}}o.tween=r}}function Dc(e,t,n){var r,o;if(typeof n!="function")throw new Error;return function(){var i=Me(this,e),s=i.tween;if(s!==r){o=(r=s).slice();for(var a={name:t,value:n},u=0,c=o.length;u<c;++u)if(o[u].name===t){o[u]=a;break}u===c&&o.push(a)}i.tween=o}}function Pc(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=Te(this.node(),n).tween,o=0,i=r.length,s;o<i;++o)if((s=r[o]).name===e)return s.value;return null}return this.each((t==null?Ic:Dc)(n,e,t))}function fr(e,t,n){var r=e._id;return e.each(function(){var o=Me(this,r);(o.value||(o.value={}))[t]=n.apply(this,arguments)}),function(o){return Te(o,r).value[t]}}function Jo(e,t){var n;return(typeof t=="number"?Ve:t instanceof Vt?Vr:(n=Vt(t))?(t=n,Vr):mc)(e,t)}function Oc(e){return function(){this.removeAttribute(e)}}function Bc(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Hc(e,t,n){var r,o=n+"",i;return function(){var s=this.getAttribute(e);return s===o?null:s===r?i:i=t(r=s,n)}}function Lc(e,t,n){var r,o=n+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===r?i:i=t(r=s,n)}}function Fc(e,t,n){var r,o,i;return function(){var s,a=n(this),u;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),u=a+"",s===u?null:s===r&&u===o?i:(o=u,i=t(r=s,a)))}}function Vc(e,t,n){var r,o,i;return function(){var s,a=n(this),u;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),u=a+"",s===u?null:s===r&&u===o?i:(o=u,i=t(r=s,a)))}}function Wc(e,t){var n=_n(e),r=n==="transform"?Sc:Jo;return this.attrTween(e,typeof t=="function"?(n.local?Vc:Fc)(n,r,fr(this,"attr."+e,t)):t==null?(n.local?Bc:Oc)(n):(n.local?Lc:Hc)(n,r,t))}function Yc(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function Xc(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function qc(e,t){var n,r;function o(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&Xc(e,i)),n}return o._value=t,o}function Uc(e,t){var n,r;function o(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&Yc(e,i)),n}return o._value=t,o}function Gc(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=_n(e);return this.tween(n,(r.local?qc:Uc)(r,t))}function Zc(e,t){return function(){dr(this,e).delay=+t.apply(this,arguments)}}function Kc(e,t){return t=+t,function(){dr(this,e).delay=t}}function Jc(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Zc:Kc)(t,e)):Te(this.node(),t).delay}function Qc(e,t){return function(){Me(this,e).duration=+t.apply(this,arguments)}}function eu(e,t){return t=+t,function(){Me(this,e).duration=t}}function tu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Qc:eu)(t,e)):Te(this.node(),t).duration}function nu(e,t){if(typeof t!="function")throw new Error;return function(){Me(this,e).ease=t}}function ru(e){var t=this._id;return arguments.length?this.each(nu(t,e)):Te(this.node(),t).ease}function ou(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Me(this,e).ease=n}}function su(e){if(typeof e!="function")throw new Error;return this.each(ou(this._id,e))}function iu(e){typeof e!="function"&&(e=zo(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,a=r[o]=[],u,c=0;c<s;++c)(u=i[c])&&e.call(u,u.__data__,c,i)&&a.push(u);return new Be(r,this._parents,this._name,this._id)}function au(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,o=n.length,i=Math.min(r,o),s=new Array(r),a=0;a<i;++a)for(var u=t[a],c=n[a],d=u.length,p=s[a]=new Array(d),g,x=0;x<d;++x)(g=u[x]||c[x])&&(p[x]=g);for(;a<r;++a)s[a]=t[a];return new Be(s,this._parents,this._name,this._id)}function lu(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function cu(e,t,n){var r,o,i=lu(t)?dr:Me;return function(){var s=i(this,e),a=s.on;a!==r&&(o=(r=a).copy()).on(t,n),s.on=o}}function uu(e,t){var n=this._id;return arguments.length<2?Te(this.node(),n).on.on(e):this.each(cu(n,e,t))}function du(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function fu(){return this.on("end.remove",du(this._id))}function pu(e){var t=this._name,n=this._id;typeof e!="function"&&(e=ar(e));for(var r=this._groups,o=r.length,i=new Array(o),s=0;s<o;++s)for(var a=r[s],u=a.length,c=i[s]=new Array(u),d,p,g=0;g<u;++g)(d=a[g])&&(p=e.call(d,d.__data__,g,a))&&("__data__"in d&&(p.__data__=d.__data__),c[g]=p,kn(c[g],t,n,g,c,Te(d,n)));return new Be(i,this._parents,t,n)}function hu(e){var t=this._name,n=this._id;typeof e!="function"&&(e=No(e));for(var r=this._groups,o=r.length,i=[],s=[],a=0;a<o;++a)for(var u=r[a],c=u.length,d,p=0;p<c;++p)if(d=u[p]){for(var g=e.call(d,d.__data__,p,u),x,m=Te(d,n),y=0,k=g.length;y<k;++y)(x=g[y])&&kn(x,t,n,y,g,m);i.push(g),s.push(d)}return new Be(i,s,t,n)}var gu=Ut.prototype.constructor;function xu(){return new gu(this._groups,this._parents)}function yu(e,t){var n,r,o;return function(){var i=_t(this,e),s=(this.style.removeProperty(e),_t(this,e));return i===s?null:i===n&&s===r?o:o=t(n=i,r=s)}}function Qo(e){return function(){this.style.removeProperty(e)}}function mu(e,t,n){var r,o=n+"",i;return function(){var s=_t(this,e);return s===o?null:s===r?i:i=t(r=s,n)}}function bu(e,t,n){var r,o,i;return function(){var s=_t(this,e),a=n(this),u=a+"";return a==null&&(u=a=(this.style.removeProperty(e),_t(this,e))),s===u?null:s===r&&u===o?i:(o=u,i=t(r=s,a))}}function vu(e,t){var n,r,o,i="style."+t,s="end."+i,a;return function(){var u=Me(this,e),c=u.on,d=u.value[i]==null?a||(a=Qo(t)):void 0;(c!==n||o!==d)&&(r=(n=c).copy()).on(s,o=d),u.on=r}}function wu(e,t,n){var r=(e+="")=="transform"?wc:Jo;return t==null?this.styleTween(e,yu(e,r)).on("end.style."+e,Qo(e)):typeof t=="function"?this.styleTween(e,bu(e,r,fr(this,"style."+e,t))).each(vu(this._id,e)):this.styleTween(e,mu(e,r,t),n).on("end.style."+e,null)}function Su(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function _u(e,t,n){var r,o;function i(){var s=t.apply(this,arguments);return s!==o&&(r=(o=s)&&Su(e,s,n)),r}return i._value=t,i}function Eu(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,_u(e,t,n??""))}function ku(e){return function(){this.textContent=e}}function ju(e){return function(){var t=e(this);this.textContent=t??""}}function Cu(e){return this.tween("text",typeof e=="function"?ju(fr(this,"text",e)):ku(e==null?"":e+""))}function Tu(e){return function(t){this.textContent=e.call(this,t)}}function Nu(e){var t,n;function r(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&Tu(o)),t}return r._value=e,r}function zu(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Nu(e))}function $u(){for(var e=this._name,t=this._id,n=es(),r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,u,c=0;c<a;++c)if(u=s[c]){var d=Te(u,t);kn(u,e,n,c,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Be(r,this._parents,e,n)}function Mu(){var e,t,n=this,r=n._id,o=n.size();return new Promise(function(i,s){var a={value:s},u={value:function(){--o===0&&i()}};n.each(function(){var c=Me(this,r),d=c.on;d!==e&&(t=(e=d).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(u)),c.on=t}),o===0&&i()})}var Ru=0;function Be(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function es(){return++Ru}var Ie=Ut.prototype;Be.prototype={constructor:Be,select:pu,selectAll:hu,selectChild:Ie.selectChild,selectChildren:Ie.selectChildren,filter:iu,merge:au,selection:xu,transition:$u,call:Ie.call,nodes:Ie.nodes,node:Ie.node,size:Ie.size,empty:Ie.empty,each:Ie.each,on:uu,attr:Wc,attrTween:Gc,style:wu,styleTween:Eu,text:Cu,textTween:zu,remove:fu,tween:Pc,delay:Jc,duration:tu,ease:ru,easeVarying:su,end:Mu,[Symbol.iterator]:Ie[Symbol.iterator]};function Au(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Iu={time:null,delay:0,duration:250,ease:Au};function Du(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Pu(e){var t,n;e instanceof Be?(t=e._id,e=e._name):(t=es(),(n=Iu).time=ur(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,u,c=0;c<a;++c)(u=s[c])&&kn(u,e,t,c,s,n||Du(u,t));return new Be(r,this._parents,e,t)}Ut.prototype.interrupt=Ac;Ut.prototype.transition=Pu;const en=e=>()=>e;function Ou(e,{sourceEvent:t,target:n,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function De(e,t,n){this.k=e,this.x=t,this.y=n}De.prototype={constructor:De,scale:function(e){return e===1?this:new De(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new De(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Pe=new De(1,0,0);De.prototype;function Dn(e){e.stopImmediatePropagation()}function Mt(e){e.preventDefault(),e.stopImmediatePropagation()}function Bu(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Hu(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Zr(){return this.__zoom||Pe}function Lu(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Fu(){return navigator.maxTouchPoints||"ontouchstart"in this}function Vu(e,t,n){var r=e.invertX(t[0][0])-n[0][0],o=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function ts(){var e=Bu,t=Hu,n=Vu,r=Lu,o=Fu,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,u=jc,c=Sn("start","zoom","end"),d,p,g,x=500,m=150,y=0,k=10;function h(f){f.property("__zoom",Zr).on("wheel.zoom",$,{passive:!1}).on("mousedown.zoom",I).on("dblclick.zoom",N).filter(o).on("touchstart.zoom",L).on("touchmove.zoom",P).on("touchend.zoom touchcancel.zoom",w).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}h.transform=function(f,T,j,D){var z=f.selection?f.selection():f;z.property("__zoom",Zr),f!==z?H(f,T,j,D):z.interrupt().each(function(){_(this,arguments).event(D).start().zoom(null,typeof T=="function"?T.apply(this,arguments):T).end()})},h.scaleBy=function(f,T,j,D){h.scaleTo(f,function(){var z=this.__zoom.k,E=typeof T=="function"?T.apply(this,arguments):T;return z*E},j,D)},h.scaleTo=function(f,T,j,D){h.transform(f,function(){var z=t.apply(this,arguments),E=this.__zoom,v=j==null?C(z):typeof j=="function"?j.apply(this,arguments):j,M=E.invert(v),O=typeof T=="function"?T.apply(this,arguments):T;return n(R(b(E,O),v,M),z,s)},j,D)},h.translateBy=function(f,T,j,D){h.transform(f,function(){return n(this.__zoom.translate(typeof T=="function"?T.apply(this,arguments):T,typeof j=="function"?j.apply(this,arguments):j),t.apply(this,arguments),s)},null,D)},h.translateTo=function(f,T,j,D,z){h.transform(f,function(){var E=t.apply(this,arguments),v=this.__zoom,M=D==null?C(E):typeof D=="function"?D.apply(this,arguments):D;return n(Pe.translate(M[0],M[1]).scale(v.k).translate(typeof T=="function"?-T.apply(this,arguments):-T,typeof j=="function"?-j.apply(this,arguments):-j),E,s)},D,z)};function b(f,T){return T=Math.max(i[0],Math.min(i[1],T)),T===f.k?f:new De(T,f.x,f.y)}function R(f,T,j){var D=T[0]-j[0]*f.k,z=T[1]-j[1]*f.k;return D===f.x&&z===f.y?f:new De(f.k,D,z)}function C(f){return[(+f[0][0]+ +f[1][0])/2,(+f[0][1]+ +f[1][1])/2]}function H(f,T,j,D){f.on("start.zoom",function(){_(this,arguments).event(D).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).event(D).end()}).tween("zoom",function(){var z=this,E=arguments,v=_(z,E).event(D),M=t.apply(z,E),O=j==null?C(M):typeof j=="function"?j.apply(z,E):j,V=Math.max(M[1][0]-M[0][0],M[1][1]-M[0][1]),W=z.__zoom,X=typeof T=="function"?T.apply(z,E):T,U=u(W.invert(O).concat(V/W.k),X.invert(O).concat(V/X.k));return function(J){if(J===1)J=X;else{var Q=U(J),te=V/Q[2];J=new De(te,O[0]-Q[0]*te,O[1]-Q[1]*te)}v.zoom(null,J)}})}function _(f,T,j){return!j&&f.__zooming||new A(f,T)}function A(f,T){this.that=f,this.args=T,this.active=0,this.sourceEvent=null,this.extent=t.apply(f,T),this.taps=0}A.prototype={event:function(f){return f&&(this.sourceEvent=f),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(f,T){return this.mouse&&f!=="mouse"&&(this.mouse[1]=T.invert(this.mouse[0])),this.touch0&&f!=="touch"&&(this.touch0[1]=T.invert(this.touch0[0])),this.touch1&&f!=="touch"&&(this.touch1[1]=T.invert(this.touch1[0])),this.that.__zoom=T,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(f){var T=ve(this.that).datum();c.call(f,this.that,new Ou(f,{sourceEvent:this.sourceEvent,target:h,transform:this.that.__zoom,dispatch:c}),T)}};function $(f,...T){if(!e.apply(this,arguments))return;var j=_(this,T).event(f),D=this.__zoom,z=Math.max(i[0],Math.min(i[1],D.k*Math.pow(2,r.apply(this,arguments)))),E=Ee(f);if(j.wheel)(j.mouse[0][0]!==E[0]||j.mouse[0][1]!==E[1])&&(j.mouse[1]=D.invert(j.mouse[0]=E)),clearTimeout(j.wheel);else{if(D.k===z)return;j.mouse=[E,D.invert(E)],cn(this),j.start()}Mt(f),j.wheel=setTimeout(v,m),j.zoom("mouse",n(R(b(D,z),j.mouse[0],j.mouse[1]),j.extent,s));function v(){j.wheel=null,j.end()}}function I(f,...T){if(g||!e.apply(this,arguments))return;var j=f.currentTarget,D=_(this,T,!0).event(f),z=ve(f.view).on("mousemove.zoom",O,!0).on("mouseup.zoom",V,!0),E=Ee(f,j),v=f.clientX,M=f.clientY;Ho(f.view),Dn(f),D.mouse=[E,this.__zoom.invert(E)],cn(this),D.start();function O(W){if(Mt(W),!D.moved){var X=W.clientX-v,U=W.clientY-M;D.moved=X*X+U*U>y}D.event(W).zoom("mouse",n(R(D.that.__zoom,D.mouse[0]=Ee(W,j),D.mouse[1]),D.extent,s))}function V(W){z.on("mousemove.zoom mouseup.zoom",null),Lo(W.view,D.moved),Mt(W),D.event(W).end()}}function N(f,...T){if(e.apply(this,arguments)){var j=this.__zoom,D=Ee(f.changedTouches?f.changedTouches[0]:f,this),z=j.invert(D),E=j.k*(f.shiftKey?.5:2),v=n(R(b(j,E),D,z),t.apply(this,T),s);Mt(f),a>0?ve(this).transition().duration(a).call(H,v,D,f):ve(this).call(h.transform,v,D,f)}}function L(f,...T){if(e.apply(this,arguments)){var j=f.touches,D=j.length,z=_(this,T,f.changedTouches.length===D).event(f),E,v,M,O;for(Dn(f),v=0;v<D;++v)M=j[v],O=Ee(M,this),O=[O,this.__zoom.invert(O),M.identifier],z.touch0?!z.touch1&&z.touch0[2]!==O[2]&&(z.touch1=O,z.taps=0):(z.touch0=O,E=!0,z.taps=1+!!d);d&&(d=clearTimeout(d)),E&&(z.taps<2&&(p=O[0],d=setTimeout(function(){d=null},x)),cn(this),z.start())}}function P(f,...T){if(this.__zooming){var j=_(this,T).event(f),D=f.changedTouches,z=D.length,E,v,M,O;for(Mt(f),E=0;E<z;++E)v=D[E],M=Ee(v,this),j.touch0&&j.touch0[2]===v.identifier?j.touch0[0]=M:j.touch1&&j.touch1[2]===v.identifier&&(j.touch1[0]=M);if(v=j.that.__zoom,j.touch1){var V=j.touch0[0],W=j.touch0[1],X=j.touch1[0],U=j.touch1[1],J=(J=X[0]-V[0])*J+(J=X[1]-V[1])*J,Q=(Q=U[0]-W[0])*Q+(Q=U[1]-W[1])*Q;v=b(v,Math.sqrt(J/Q)),M=[(V[0]+X[0])/2,(V[1]+X[1])/2],O=[(W[0]+U[0])/2,(W[1]+U[1])/2]}else if(j.touch0)M=j.touch0[0],O=j.touch0[1];else return;j.zoom("touch",n(R(v,M,O),j.extent,s))}}function w(f,...T){if(this.__zooming){var j=_(this,T).event(f),D=f.changedTouches,z=D.length,E,v;for(Dn(f),g&&clearTimeout(g),g=setTimeout(function(){g=null},x),E=0;E<z;++E)v=D[E],j.touch0&&j.touch0[2]===v.identifier?delete j.touch0:j.touch1&&j.touch1[2]===v.identifier&&delete j.touch1;if(j.touch1&&!j.touch0&&(j.touch0=j.touch1,delete j.touch1),j.touch0)j.touch0[1]=this.__zoom.invert(j.touch0[0]);else if(j.end(),j.taps===2&&(v=Ee(v,this),Math.hypot(p[0]-v[0],p[1]-v[1])<k)){var M=ve(this).on("dblclick.zoom");M&&M.apply(this,arguments)}}}return h.wheelDelta=function(f){return arguments.length?(r=typeof f=="function"?f:en(+f),h):r},h.filter=function(f){return arguments.length?(e=typeof f=="function"?f:en(!!f),h):e},h.touchable=function(f){return arguments.length?(o=typeof f=="function"?f:en(!!f),h):o},h.extent=function(f){return arguments.length?(t=typeof f=="function"?f:en([[+f[0][0],+f[0][1]],[+f[1][0],+f[1][1]]]),h):t},h.scaleExtent=function(f){return arguments.length?(i[0]=+f[0],i[1]=+f[1],h):[i[0],i[1]]},h.translateExtent=function(f){return arguments.length?(s[0][0]=+f[0][0],s[1][0]=+f[1][0],s[0][1]=+f[0][1],s[1][1]=+f[1][1],h):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},h.constrain=function(f){return arguments.length?(n=f,h):n},h.duration=function(f){return arguments.length?(a=+f,h):a},h.interpolate=function(f){return arguments.length?(u=f,h):u},h.on=function(){var f=c.on.apply(c,arguments);return f===c?h:f},h.clickDistance=function(f){return arguments.length?(y=(f=+f)*f,h):Math.sqrt(y)},h.tapDistance=function(f){return arguments.length?(k=+f,h):k},h}const jn=S.createContext(null),Wu=jn.Provider,He={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},ns=He.error001();function ae(e,t){const n=S.useContext(jn);if(n===null)throw new Error(ns);return Co(n,e,t)}const de=()=>{const e=S.useContext(jn);if(e===null)throw new Error(ns);return S.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},Yu=e=>e.userSelectionActive?"none":"all";function pr({position:e,children:t,className:n,style:r,...o}){const i=ae(Yu),s=`${e}`.split("-");return B.createElement("div",{className:he(["react-flow__panel",n,...s]),style:{...r,pointerEvents:i},...o},t)}function Xu({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:B.createElement(pr,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},B.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const qu=({x:e,y:t,label:n,labelStyle:r={},labelShowBg:o=!0,labelBgStyle:i={},labelBgPadding:s=[2,4],labelBgBorderRadius:a=2,children:u,className:c,...d})=>{const p=S.useRef(null),[g,x]=S.useState({x:0,y:0,width:0,height:0}),m=he(["react-flow__edge-textwrapper",c]);return S.useEffect(()=>{if(p.current){const y=p.current.getBBox();x({x:y.x,y:y.y,width:y.width,height:y.height})}},[n]),typeof n>"u"||!n?null:B.createElement("g",{transform:`translate(${e-g.width/2} ${t-g.height/2})`,className:m,visibility:g.width?"visible":"hidden",...d},o&&B.createElement("rect",{width:g.width+2*s[0],x:-s[0],y:-s[1],height:g.height+2*s[1],className:"react-flow__edge-textbg",style:i,rx:a,ry:a}),B.createElement("text",{className:"react-flow__edge-text",y:g.height/2,dy:"0.3em",ref:p,style:r},n),u)};var Uu=S.memo(qu);const hr=e=>({width:e.offsetWidth,height:e.offsetHeight}),kt=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),gr=(e={x:0,y:0},t)=>({x:kt(e.x,t[0][0],t[1][0]),y:kt(e.y,t[0][1],t[1][1])}),Kr=(e,t,n)=>e<t?kt(Math.abs(e-t),1,50)/50:e>n?-kt(Math.abs(e-n),1,50)/50:0,rs=(e,t)=>{const n=Kr(e.x,35,t.width-35)*20,r=Kr(e.y,35,t.height-35)*20;return[n,r]},os=e=>{var t;return((t=e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},ss=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Yt=({x:e,y:t,width:n,height:r})=>({x:e,y:t,x2:e+n,y2:t+r}),is=({x:e,y:t,x2:n,y2:r})=>({x:e,y:t,width:n-e,height:r-t}),Jr=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),Gu=(e,t)=>is(ss(Yt(e),Yt(t))),Kn=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),r=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*r)},Zu=e=>we(e.width)&&we(e.height)&&we(e.x)&&we(e.y),we=e=>!isNaN(e)&&isFinite(e),ue=Symbol.for("internals"),as=["Enter"," ","Escape"],Ku=(e,t)=>{},Ju=e=>"nativeEvent"in e;function Jn(e){var o,i;const t=Ju(e)?e.nativeEvent:e,n=((i=(o=t.composedPath)==null?void 0:o.call(t))==null?void 0:i[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(n==null?void 0:n.nodeName)||(n==null?void 0:n.hasAttribute("contenteditable"))||!!(n!=null&&n.closest(".nokey"))}const ls=e=>"clientX"in e,Xe=(e,t)=>{var i,s;const n=ls(e),r=n?e.clientX:(i=e.touches)==null?void 0:i[0].clientX,o=n?e.clientY:(s=e.touches)==null?void 0:s[0].clientY;return{x:r-((t==null?void 0:t.left)??0),y:o-((t==null?void 0:t.top)??0)}},yn=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0},Ct=({id:e,path:t,labelX:n,labelY:r,label:o,labelStyle:i,labelShowBg:s,labelBgStyle:a,labelBgPadding:u,labelBgBorderRadius:c,style:d,markerEnd:p,markerStart:g,interactionWidth:x=20})=>B.createElement(B.Fragment,null,B.createElement("path",{id:e,style:d,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:p,markerStart:g}),x&&B.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:x,className:"react-flow__edge-interaction"}),o&&we(n)&&we(r)?B.createElement(Uu,{x:n,y:r,label:o,labelStyle:i,labelShowBg:s,labelBgStyle:a,labelBgPadding:u,labelBgBorderRadius:c}):null);Ct.displayName="BaseEdge";function Rt(e,t,n){return n===void 0?n:r=>{const o=t().edges.find(i=>i.id===e);o&&n(r,{...o})}}function cs({sourceX:e,sourceY:t,targetX:n,targetY:r}){const o=Math.abs(n-e)/2,i=n<e?n+o:n-o,s=Math.abs(r-t)/2,a=r<t?r+s:r-s;return[i,a,o,s]}function us({sourceX:e,sourceY:t,targetX:n,targetY:r,sourceControlX:o,sourceControlY:i,targetControlX:s,targetControlY:a}){const u=e*.125+o*.375+s*.375+n*.125,c=t*.125+i*.375+a*.375+r*.125,d=Math.abs(u-e),p=Math.abs(c-t);return[u,c,d,p]}var ct;(function(e){e.Strict="strict",e.Loose="loose"})(ct||(ct={}));var rt;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(rt||(rt={}));var Xt;(function(e){e.Partial="partial",e.Full="full"})(Xt||(Xt={}));var Ye;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Ye||(Ye={}));var jt;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(jt||(jt={}));var G;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(G||(G={}));function Qr({pos:e,x1:t,y1:n,x2:r,y2:o}){return e===G.Left||e===G.Right?[.5*(t+r),n]:[t,.5*(n+o)]}function ds({sourceX:e,sourceY:t,sourcePosition:n=G.Bottom,targetX:r,targetY:o,targetPosition:i=G.Top}){const[s,a]=Qr({pos:n,x1:e,y1:t,x2:r,y2:o}),[u,c]=Qr({pos:i,x1:r,y1:o,x2:e,y2:t}),[d,p,g,x]=us({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:s,sourceControlY:a,targetControlX:u,targetControlY:c});return[`M${e},${t} C${s},${a} ${u},${c} ${r},${o}`,d,p,g,x]}const xr=S.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,sourcePosition:o=G.Bottom,targetPosition:i=G.Top,label:s,labelStyle:a,labelShowBg:u,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:x,markerStart:m,interactionWidth:y})=>{const[k,h,b]=ds({sourceX:e,sourceY:t,sourcePosition:o,targetX:n,targetY:r,targetPosition:i});return B.createElement(Ct,{path:k,labelX:h,labelY:b,label:s,labelStyle:a,labelShowBg:u,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:x,markerStart:m,interactionWidth:y})});xr.displayName="SimpleBezierEdge";const eo={[G.Left]:{x:-1,y:0},[G.Right]:{x:1,y:0},[G.Top]:{x:0,y:-1},[G.Bottom]:{x:0,y:1}},Qu=({source:e,sourcePosition:t=G.Bottom,target:n})=>t===G.Left||t===G.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},to=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function ed({source:e,sourcePosition:t=G.Bottom,target:n,targetPosition:r=G.Top,center:o,offset:i}){const s=eo[t],a=eo[r],u={x:e.x+s.x*i,y:e.y+s.y*i},c={x:n.x+a.x*i,y:n.y+a.y*i},d=Qu({source:u,sourcePosition:t,target:c}),p=d.x!==0?"x":"y",g=d[p];let x=[],m,y;const k={x:0,y:0},h={x:0,y:0},[b,R,C,H]=cs({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(s[p]*a[p]===-1){m=o.x??b,y=o.y??R;const A=[{x:m,y:u.y},{x:m,y:c.y}],$=[{x:u.x,y},{x:c.x,y}];s[p]===g?x=p==="x"?A:$:x=p==="x"?$:A}else{const A=[{x:u.x,y:c.y}],$=[{x:c.x,y:u.y}];if(p==="x"?x=s.x===g?$:A:x=s.y===g?A:$,t===r){const w=Math.abs(e[p]-n[p]);if(w<=i){const f=Math.min(i-1,i-w);s[p]===g?k[p]=(u[p]>e[p]?-1:1)*f:h[p]=(c[p]>n[p]?-1:1)*f}}if(t!==r){const w=p==="x"?"y":"x",f=s[p]===a[w],T=u[w]>c[w],j=u[w]<c[w];(s[p]===1&&(!f&&T||f&&j)||s[p]!==1&&(!f&&j||f&&T))&&(x=p==="x"?A:$)}const I={x:u.x+k.x,y:u.y+k.y},N={x:c.x+h.x,y:c.y+h.y},L=Math.max(Math.abs(I.x-x[0].x),Math.abs(N.x-x[0].x)),P=Math.max(Math.abs(I.y-x[0].y),Math.abs(N.y-x[0].y));L>=P?(m=(I.x+N.x)/2,y=x[0].y):(m=x[0].x,y=(I.y+N.y)/2)}return[[e,{x:u.x+k.x,y:u.y+k.y},...x,{x:c.x+h.x,y:c.y+h.y},n],m,y,C,H]}function td(e,t,n,r){const o=Math.min(to(e,t)/2,to(t,n)/2,r),{x:i,y:s}=t;if(e.x===i&&i===n.x||e.y===s&&s===n.y)return`L${i} ${s}`;if(e.y===s){const c=e.x<n.x?-1:1,d=e.y<n.y?1:-1;return`L ${i+o*c},${s}Q ${i},${s} ${i},${s+o*d}`}const a=e.x<n.x?1:-1,u=e.y<n.y?-1:1;return`L ${i},${s+o*u}Q ${i},${s} ${i+o*a},${s}`}function mn({sourceX:e,sourceY:t,sourcePosition:n=G.Bottom,targetX:r,targetY:o,targetPosition:i=G.Top,borderRadius:s=5,centerX:a,centerY:u,offset:c=20}){const[d,p,g,x,m]=ed({source:{x:e,y:t},sourcePosition:n,target:{x:r,y:o},targetPosition:i,center:{x:a,y:u},offset:c});return[d.reduce((k,h,b)=>{let R="";return b>0&&b<d.length-1?R=td(d[b-1],h,d[b+1],s):R=`${b===0?"M":"L"}${h.x} ${h.y}`,k+=R,k},""),p,g,x,m]}const Cn=S.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,label:o,labelStyle:i,labelShowBg:s,labelBgStyle:a,labelBgPadding:u,labelBgBorderRadius:c,style:d,sourcePosition:p=G.Bottom,targetPosition:g=G.Top,markerEnd:x,markerStart:m,pathOptions:y,interactionWidth:k})=>{const[h,b,R]=mn({sourceX:e,sourceY:t,sourcePosition:p,targetX:n,targetY:r,targetPosition:g,borderRadius:y==null?void 0:y.borderRadius,offset:y==null?void 0:y.offset});return B.createElement(Ct,{path:h,labelX:b,labelY:R,label:o,labelStyle:i,labelShowBg:s,labelBgStyle:a,labelBgPadding:u,labelBgBorderRadius:c,style:d,markerEnd:x,markerStart:m,interactionWidth:k})});Cn.displayName="SmoothStepEdge";const yr=S.memo(e=>{var t;return B.createElement(Cn,{...e,pathOptions:S.useMemo(()=>{var n;return{borderRadius:0,offset:(n=e.pathOptions)==null?void 0:n.offset}},[(t=e.pathOptions)==null?void 0:t.offset])})});yr.displayName="StepEdge";function nd({sourceX:e,sourceY:t,targetX:n,targetY:r}){const[o,i,s,a]=cs({sourceX:e,sourceY:t,targetX:n,targetY:r});return[`M ${e},${t}L ${n},${r}`,o,i,s,a]}const mr=S.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,label:o,labelStyle:i,labelShowBg:s,labelBgStyle:a,labelBgPadding:u,labelBgBorderRadius:c,style:d,markerEnd:p,markerStart:g,interactionWidth:x})=>{const[m,y,k]=nd({sourceX:e,sourceY:t,targetX:n,targetY:r});return B.createElement(Ct,{path:m,labelX:y,labelY:k,label:o,labelStyle:i,labelShowBg:s,labelBgStyle:a,labelBgPadding:u,labelBgBorderRadius:c,style:d,markerEnd:p,markerStart:g,interactionWidth:x})});mr.displayName="StraightEdge";function tn(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function no({pos:e,x1:t,y1:n,x2:r,y2:o,c:i}){switch(e){case G.Left:return[t-tn(t-r,i),n];case G.Right:return[t+tn(r-t,i),n];case G.Top:return[t,n-tn(n-o,i)];case G.Bottom:return[t,n+tn(o-n,i)]}}function fs({sourceX:e,sourceY:t,sourcePosition:n=G.Bottom,targetX:r,targetY:o,targetPosition:i=G.Top,curvature:s=.25}){const[a,u]=no({pos:n,x1:e,y1:t,x2:r,y2:o,c:s}),[c,d]=no({pos:i,x1:r,y1:o,x2:e,y2:t,c:s}),[p,g,x,m]=us({sourceX:e,sourceY:t,targetX:r,targetY:o,sourceControlX:a,sourceControlY:u,targetControlX:c,targetControlY:d});return[`M${e},${t} C${a},${u} ${c},${d} ${r},${o}`,p,g,x,m]}const bn=S.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,sourcePosition:o=G.Bottom,targetPosition:i=G.Top,label:s,labelStyle:a,labelShowBg:u,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:x,markerStart:m,pathOptions:y,interactionWidth:k})=>{const[h,b,R]=fs({sourceX:e,sourceY:t,sourcePosition:o,targetX:n,targetY:r,targetPosition:i,curvature:y==null?void 0:y.curvature});return B.createElement(Ct,{path:h,labelX:b,labelY:R,label:s,labelStyle:a,labelShowBg:u,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:p,style:g,markerEnd:x,markerStart:m,interactionWidth:k})});bn.displayName="BezierEdge";const br=S.createContext(null),rd=br.Provider;br.Consumer;const od=()=>S.useContext(br),sd=e=>"id"in e&&"source"in e&&"target"in e,id=({source:e,sourceHandle:t,target:n,targetHandle:r})=>`reactflow__edge-${e}${t||""}-${n}${r||""}`,Qn=(e,t)=>typeof e>"u"?"":typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(r=>`${r}=${e[r]}`).join("&")}`,ad=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),ps=(e,t)=>{if(!e.source||!e.target)return t;let n;return sd(e)?n={...e}:n={...e,id:id(e)},ad(n,t)?t:t.concat(n)},er=({x:e,y:t},[n,r,o],i,[s,a])=>{const u={x:(e-n)/o,y:(t-r)/o};return i?{x:s*Math.round(u.x/s),y:a*Math.round(u.y/a)}:u},hs=({x:e,y:t},[n,r,o])=>({x:e*o+n,y:t*o+r}),it=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const n=(e.width??0)*t[0],r=(e.height??0)*t[1],o={x:e.position.x-n,y:e.position.y-r};return{...o,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-n,y:e.positionAbsolute.y-r}:o}},Tn=(e,t=[0,0])=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((r,o)=>{const{x:i,y:s}=it(o,t).positionAbsolute;return ss(r,Yt({x:i,y:s,width:o.width||0,height:o.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return is(n)},gs=(e,t,[n,r,o]=[0,0,1],i=!1,s=!1,a=[0,0])=>{const u={x:(t.x-n)/o,y:(t.y-r)/o,width:t.width/o,height:t.height/o},c=[];return e.forEach(d=>{const{width:p,height:g,selectable:x=!0,hidden:m=!1}=d;if(s&&!x||m)return!1;const{positionAbsolute:y}=it(d,a),k={x:y.x,y:y.y,width:p||0,height:g||0},h=Kn(u,k),b=typeof p>"u"||typeof g>"u"||p===null||g===null,R=i&&h>0,C=(p||0)*(g||0);(b||R||h>=C||d.dragging)&&c.push(d)}),c},xs=(e,t)=>{const n=e.map(r=>r.id);return t.filter(r=>n.includes(r.source)||n.includes(r.target))},ys=(e,t,n,r,o,i=.1)=>{const s=t/(e.width*(1+i)),a=n/(e.height*(1+i)),u=Math.min(s,a),c=kt(u,r,o),d=e.x+e.width/2,p=e.y+e.height/2,g=t/2-d*c,x=n/2-p*c;return{x:g,y:x,zoom:c}},et=(e,t=0)=>e.transition().duration(t);function ro(e,t,n,r){return(t[n]||[]).reduce((o,i)=>{var s,a;return`${e.id}-${i.id}-${n}`!==r&&o.push({id:i.id||null,type:n,nodeId:e.id,x:(((s=e.positionAbsolute)==null?void 0:s.x)??0)+i.x+i.width/2,y:(((a=e.positionAbsolute)==null?void 0:a.y)??0)+i.y+i.height/2}),o},[])}function ld(e,t,n,r,o,i){const{x:s,y:a}=Xe(e),c=t.elementsFromPoint(s,a).find(m=>m.classList.contains("react-flow__handle"));if(c){const m=c.getAttribute("data-nodeid");if(m){const y=vr(void 0,c),k=c.getAttribute("data-handleid"),h=i({nodeId:m,id:k,type:y});if(h){const b=o.find(R=>R.nodeId===m&&R.type===y&&R.id===k);return{handle:{id:k,type:y,nodeId:m,x:(b==null?void 0:b.x)||n.x,y:(b==null?void 0:b.y)||n.y},validHandleResult:h}}}}let d=[],p=1/0;if(o.forEach(m=>{const y=Math.sqrt((m.x-n.x)**2+(m.y-n.y)**2);if(y<=r){const k=i(m);y<=p&&(y<p?d=[{handle:m,validHandleResult:k}]:y===p&&d.push({handle:m,validHandleResult:k}),p=y)}}),!d.length)return{handle:null,validHandleResult:ms()};if(d.length===1)return d[0];const g=d.some(({validHandleResult:m})=>m.isValid),x=d.some(({handle:m})=>m.type==="target");return d.find(({handle:m,validHandleResult:y})=>x?m.type==="target":g?y.isValid:!0)||d[0]}const cd={source:null,target:null,sourceHandle:null,targetHandle:null},ms=()=>({handleDomNode:null,isValid:!1,connection:cd,endHandle:null});function bs(e,t,n,r,o,i,s){const a=o==="target",u=s.querySelector(`.react-flow__handle[data-id="${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`),c={...ms(),handleDomNode:u};if(u){const d=vr(void 0,u),p=u.getAttribute("data-nodeid"),g=u.getAttribute("data-handleid"),x=u.classList.contains("connectable"),m=u.classList.contains("connectableend"),y={source:a?p:n,sourceHandle:a?g:r,target:a?n:p,targetHandle:a?r:g};c.connection=y,x&&m&&(t===ct.Strict?a&&d==="source"||!a&&d==="target":p!==n||g!==r)&&(c.endHandle={nodeId:p,handleId:g,type:d},c.isValid=i(y))}return c}function ud({nodes:e,nodeId:t,handleId:n,handleType:r}){return e.reduce((o,i)=>{if(i[ue]){const{handleBounds:s}=i[ue];let a=[],u=[];s&&(a=ro(i,s,"source",`${t}-${n}-${r}`),u=ro(i,s,"target",`${t}-${n}-${r}`)),o.push(...a,...u)}return o},[])}function vr(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function Pn(e){e==null||e.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function dd(e,t){let n=null;return t?n="valid":e&&!t&&(n="invalid"),n}function vs({event:e,handleId:t,nodeId:n,onConnect:r,isTarget:o,getState:i,setState:s,isValidConnection:a,edgeUpdaterType:u,onReconnectEnd:c}){const d=os(e.target),{connectionMode:p,domNode:g,autoPanOnConnect:x,connectionRadius:m,onConnectStart:y,panBy:k,getNodes:h,cancelConnection:b}=i();let R=0,C;const{x:H,y:_}=Xe(e),A=d==null?void 0:d.elementFromPoint(H,_),$=vr(u,A),I=g==null?void 0:g.getBoundingClientRect();if(!I||!$)return;let N,L=Xe(e,I),P=!1,w=null,f=!1,T=null;const j=ud({nodes:h(),nodeId:n,handleId:t,handleType:$}),D=()=>{if(!x)return;const[v,M]=rs(L,I);k({x:v,y:M}),R=requestAnimationFrame(D)};s({connectionPosition:L,connectionStatus:null,connectionNodeId:n,connectionHandleId:t,connectionHandleType:$,connectionStartHandle:{nodeId:n,handleId:t,type:$},connectionEndHandle:null}),y==null||y(e,{nodeId:n,handleId:t,handleType:$});function z(v){const{transform:M}=i();L=Xe(v,I);const{handle:O,validHandleResult:V}=ld(v,d,er(L,M,!1,[1,1]),m,j,W=>bs(W,p,n,t,o?"target":"source",a,d));if(C=O,P||(D(),P=!0),T=V.handleDomNode,w=V.connection,f=V.isValid,s({connectionPosition:C&&f?hs({x:C.x,y:C.y},M):L,connectionStatus:dd(!!C,f),connectionEndHandle:V.endHandle}),!C&&!f&&!T)return Pn(N);w.source!==w.target&&T&&(Pn(N),N=T,T.classList.add("connecting","react-flow__handle-connecting"),T.classList.toggle("valid",f),T.classList.toggle("react-flow__handle-valid",f))}function E(v){var M,O;(C||T)&&w&&f&&(r==null||r(w)),(O=(M=i()).onConnectEnd)==null||O.call(M,v),u&&(c==null||c(v)),Pn(N),b(),cancelAnimationFrame(R),P=!1,f=!1,w=null,T=null,d.removeEventListener("mousemove",z),d.removeEventListener("mouseup",E),d.removeEventListener("touchmove",z),d.removeEventListener("touchend",E)}d.addEventListener("mousemove",z),d.addEventListener("mouseup",E),d.addEventListener("touchmove",z),d.addEventListener("touchend",E)}const oo=()=>!0,fd=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),pd=(e,t,n)=>r=>{const{connectionStartHandle:o,connectionEndHandle:i,connectionClickStartHandle:s}=r;return{connecting:(o==null?void 0:o.nodeId)===e&&(o==null?void 0:o.handleId)===t&&(o==null?void 0:o.type)===n||(i==null?void 0:i.nodeId)===e&&(i==null?void 0:i.handleId)===t&&(i==null?void 0:i.type)===n,clickConnecting:(s==null?void 0:s.nodeId)===e&&(s==null?void 0:s.handleId)===t&&(s==null?void 0:s.type)===n}},ws=S.forwardRef(({type:e="source",position:t=G.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:o=!0,isConnectableEnd:i=!0,id:s,onConnect:a,children:u,className:c,onMouseDown:d,onTouchStart:p,...g},x)=>{var I,N;const m=s||null,y=e==="target",k=de(),h=od(),{connectOnClick:b,noPanClassName:R}=ae(fd,fe),{connecting:C,clickConnecting:H}=ae(pd(h,m,e),fe);h||(N=(I=k.getState()).onError)==null||N.call(I,"010",He.error010());const _=L=>{const{defaultEdgeOptions:P,onConnect:w,hasDefaultEdges:f}=k.getState(),T={...P,...L};if(f){const{edges:j,setEdges:D}=k.getState();D(ps(T,j))}w==null||w(T),a==null||a(T)},A=L=>{if(!h)return;const P=ls(L);o&&(P&&L.button===0||!P)&&vs({event:L,handleId:m,nodeId:h,onConnect:_,isTarget:y,getState:k.getState,setState:k.setState,isValidConnection:n||k.getState().isValidConnection||oo}),P?d==null||d(L):p==null||p(L)},$=L=>{const{onClickConnectStart:P,onClickConnectEnd:w,connectionClickStartHandle:f,connectionMode:T,isValidConnection:j}=k.getState();if(!h||!f&&!o)return;if(!f){P==null||P(L,{nodeId:h,handleId:m,handleType:e}),k.setState({connectionClickStartHandle:{nodeId:h,type:e,handleId:m}});return}const D=os(L.target),z=n||j||oo,{connection:E,isValid:v}=bs({nodeId:h,id:m,type:e},T,f.nodeId,f.handleId||null,f.type,z,D);v&&_(E),w==null||w(L),k.setState({connectionClickStartHandle:null})};return B.createElement("div",{"data-handleid":m,"data-nodeid":h,"data-handlepos":t,"data-id":`${h}-${m}-${e}`,className:he(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",R,c,{source:!y,target:y,connectable:r,connectablestart:o,connectableend:i,connecting:H,connectionindicator:r&&(o&&!C||i&&C)}]),onMouseDown:A,onTouchStart:A,onClick:b?$:void 0,ref:x,...g},u)});ws.displayName="Handle";var at=S.memo(ws);const Ss=({data:e,isConnectable:t,targetPosition:n=G.Top,sourcePosition:r=G.Bottom})=>B.createElement(B.Fragment,null,B.createElement(at,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,B.createElement(at,{type:"source",position:r,isConnectable:t}));Ss.displayName="DefaultNode";var tr=S.memo(Ss);const _s=({data:e,isConnectable:t,sourcePosition:n=G.Bottom})=>B.createElement(B.Fragment,null,e==null?void 0:e.label,B.createElement(at,{type:"source",position:n,isConnectable:t}));_s.displayName="InputNode";var Es=S.memo(_s);const ks=({data:e,isConnectable:t,targetPosition:n=G.Top})=>B.createElement(B.Fragment,null,B.createElement(at,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label);ks.displayName="OutputNode";var js=S.memo(ks);const wr=()=>null;wr.displayName="GroupNode";const hd=e=>({selectedNodes:e.getNodes().filter(t=>t.selected),selectedEdges:e.edges.filter(t=>t.selected).map(t=>({...t}))}),nn=e=>e.id;function gd(e,t){return fe(e.selectedNodes.map(nn),t.selectedNodes.map(nn))&&fe(e.selectedEdges.map(nn),t.selectedEdges.map(nn))}const Cs=S.memo(({onSelectionChange:e})=>{const t=de(),{selectedNodes:n,selectedEdges:r}=ae(hd,gd);return S.useEffect(()=>{const o={nodes:n,edges:r};e==null||e(o),t.getState().onSelectionChange.forEach(i=>i(o))},[n,r,e]),null});Cs.displayName="SelectionListener";const xd=e=>!!e.onSelectionChange;function yd({onSelectionChange:e}){const t=ae(xd);return e||t?B.createElement(Cs,{onSelectionChange:e}):null}const md=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function ht(e,t){S.useEffect(()=>{typeof e<"u"&&t(e)},[e])}function ne(e,t,n){S.useEffect(()=>{typeof t<"u"&&n({[e]:t})},[t])}const bd=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:o,onConnectStart:i,onConnectEnd:s,onClickConnectStart:a,onClickConnectEnd:u,nodesDraggable:c,nodesConnectable:d,nodesFocusable:p,edgesFocusable:g,edgesUpdatable:x,elevateNodesOnSelect:m,minZoom:y,maxZoom:k,nodeExtent:h,onNodesChange:b,onEdgesChange:R,elementsSelectable:C,connectionMode:H,snapGrid:_,snapToGrid:A,translateExtent:$,connectOnClick:I,defaultEdgeOptions:N,fitView:L,fitViewOptions:P,onNodesDelete:w,onEdgesDelete:f,onNodeDrag:T,onNodeDragStart:j,onNodeDragStop:D,onSelectionDrag:z,onSelectionDragStart:E,onSelectionDragStop:v,noPanClassName:M,nodeOrigin:O,rfId:V,autoPanOnConnect:W,autoPanOnNodeDrag:X,onError:U,connectionRadius:J,isValidConnection:Q,nodeDragThreshold:te})=>{const{setNodes:ee,setEdges:oe,setDefaultNodesAndEdges:se,setMinZoom:re,setMaxZoom:le,setTranslateExtent:K,setNodeExtent:q,reset:Y}=ae(md,fe),F=de();return S.useEffect(()=>{const Z=r==null?void 0:r.map(ie=>({...ie,...N}));return se(n,Z),()=>{Y()}},[]),ne("defaultEdgeOptions",N,F.setState),ne("connectionMode",H,F.setState),ne("onConnect",o,F.setState),ne("onConnectStart",i,F.setState),ne("onConnectEnd",s,F.setState),ne("onClickConnectStart",a,F.setState),ne("onClickConnectEnd",u,F.setState),ne("nodesDraggable",c,F.setState),ne("nodesConnectable",d,F.setState),ne("nodesFocusable",p,F.setState),ne("edgesFocusable",g,F.setState),ne("edgesUpdatable",x,F.setState),ne("elementsSelectable",C,F.setState),ne("elevateNodesOnSelect",m,F.setState),ne("snapToGrid",A,F.setState),ne("snapGrid",_,F.setState),ne("onNodesChange",b,F.setState),ne("onEdgesChange",R,F.setState),ne("connectOnClick",I,F.setState),ne("fitViewOnInit",L,F.setState),ne("fitViewOnInitOptions",P,F.setState),ne("onNodesDelete",w,F.setState),ne("onEdgesDelete",f,F.setState),ne("onNodeDrag",T,F.setState),ne("onNodeDragStart",j,F.setState),ne("onNodeDragStop",D,F.setState),ne("onSelectionDrag",z,F.setState),ne("onSelectionDragStart",E,F.setState),ne("onSelectionDragStop",v,F.setState),ne("noPanClassName",M,F.setState),ne("nodeOrigin",O,F.setState),ne("rfId",V,F.setState),ne("autoPanOnConnect",W,F.setState),ne("autoPanOnNodeDrag",X,F.setState),ne("onError",U,F.setState),ne("connectionRadius",J,F.setState),ne("isValidConnection",Q,F.setState),ne("nodeDragThreshold",te,F.setState),ht(e,ee),ht(t,oe),ht(y,re),ht(k,le),ht($,K),ht(h,q),null},so={display:"none"},vd={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Ts="react-flow__node-desc",Ns="react-flow__edge-desc",wd="react-flow__aria-live",Sd=e=>e.ariaLiveMessage;function _d({rfId:e}){const t=ae(Sd);return B.createElement("div",{id:`${wd}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:vd},t)}function Ed({rfId:e,disableKeyboardA11y:t}){return B.createElement(B.Fragment,null,B.createElement("div",{id:`${Ts}-${e}`,style:so},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),B.createElement("div",{id:`${Ns}-${e}`,style:so},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&B.createElement(_d,{rfId:e}))}var qt=(e=null,t={actInsideInputWithModifier:!0})=>{const[n,r]=S.useState(!1),o=S.useRef(!1),i=S.useRef(new Set([])),[s,a]=S.useMemo(()=>{if(e!==null){const c=(Array.isArray(e)?e:[e]).filter(p=>typeof p=="string").map(p=>p.split("+")),d=c.reduce((p,g)=>p.concat(...g),[]);return[c,d]}return[[],[]]},[e]);return S.useEffect(()=>{const u=typeof document<"u"?document:null,c=(t==null?void 0:t.target)||u;if(e!==null){const d=x=>{if(o.current=x.ctrlKey||x.metaKey||x.shiftKey,(!o.current||o.current&&!t.actInsideInputWithModifier)&&Jn(x))return!1;const y=ao(x.code,a);i.current.add(x[y]),io(s,i.current,!1)&&(x.preventDefault(),r(!0))},p=x=>{if((!o.current||o.current&&!t.actInsideInputWithModifier)&&Jn(x))return!1;const y=ao(x.code,a);io(s,i.current,!0)?(r(!1),i.current.clear()):i.current.delete(x[y]),x.key==="Meta"&&i.current.clear(),o.current=!1},g=()=>{i.current.clear(),r(!1)};return c==null||c.addEventListener("keydown",d),c==null||c.addEventListener("keyup",p),window.addEventListener("blur",g),()=>{c==null||c.removeEventListener("keydown",d),c==null||c.removeEventListener("keyup",p),window.removeEventListener("blur",g)}}},[e,r]),n};function io(e,t,n){return e.filter(r=>n||r.length===t.size).some(r=>r.every(o=>t.has(o)))}function ao(e,t){return t.includes(e)?"code":"key"}function zs(e,t,n,r){var a,u;const o=e.parentNode||e.parentId;if(!o)return n;const i=t.get(o),s=it(i,r);return zs(i,t,{x:(n.x??0)+s.x,y:(n.y??0)+s.y,z:(((a=i[ue])==null?void 0:a.z)??0)>(n.z??0)?((u=i[ue])==null?void 0:u.z)??0:n.z??0},r)}function $s(e,t,n){e.forEach(r=>{var i;const o=r.parentNode||r.parentId;if(o&&!e.has(o))throw new Error(`Parent node ${o} not found`);if(o||n!=null&&n[r.id]){const{x:s,y:a,z:u}=zs(r,e,{...r.position,z:((i=r[ue])==null?void 0:i.z)??0},t);r.positionAbsolute={x:s,y:a},r[ue].z=u,n!=null&&n[r.id]&&(r[ue].isParent=!0)}})}function On(e,t,n,r){const o=new Map,i={},s=r?1e3:0;return e.forEach(a=>{var x;const u=(we(a.zIndex)?a.zIndex:0)+(a.selected?s:0),c=t.get(a.id),d={...a,positionAbsolute:{x:a.position.x,y:a.position.y}},p=a.parentNode||a.parentId;p&&(i[p]=!0);const g=(c==null?void 0:c.type)&&(c==null?void 0:c.type)!==a.type;Object.defineProperty(d,ue,{enumerable:!1,value:{handleBounds:g||(x=c==null?void 0:c[ue])==null?void 0:x.handleBounds,z:u}}),o.set(a.id,d)}),$s(o,n,i),o}function Ms(e,t={}){const{getNodes:n,width:r,height:o,minZoom:i,maxZoom:s,d3Zoom:a,d3Selection:u,fitViewOnInitDone:c,fitViewOnInit:d,nodeOrigin:p}=e(),g=t.initial&&!c&&d;if(a&&u&&(g||!t.initial)){const m=n().filter(k=>{var b;const h=t.includeHiddenNodes?k.width&&k.height:!k.hidden;return(b=t.nodes)!=null&&b.length?h&&t.nodes.some(R=>R.id===k.id):h}),y=m.every(k=>k.width&&k.height);if(m.length>0&&y){const k=Tn(m,p),{x:h,y:b,zoom:R}=ys(k,r,o,t.minZoom??i,t.maxZoom??s,t.padding??.1),C=Pe.translate(h,b).scale(R);return typeof t.duration=="number"&&t.duration>0?a.transform(et(u,t.duration),C):a.transform(u,C),!0}}return!1}function kd(e,t){return e.forEach(n=>{const r=t.get(n.id);r&&t.set(r.id,{...r,[ue]:r[ue],selected:n.selected})}),new Map(t)}function jd(e,t){return t.map(n=>{const r=e.find(o=>o.id===n.id);return r&&(n.selected=r.selected),n})}function rn({changedNodes:e,changedEdges:t,get:n,set:r}){const{nodeInternals:o,edges:i,onNodesChange:s,onEdgesChange:a,hasDefaultNodes:u,hasDefaultEdges:c}=n();e!=null&&e.length&&(u&&r({nodeInternals:kd(e,o)}),s==null||s(e)),t!=null&&t.length&&(c&&r({edges:jd(t,i)}),a==null||a(t))}const gt=()=>{},Cd={zoomIn:gt,zoomOut:gt,zoomTo:gt,getZoom:()=>1,setViewport:gt,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:gt,fitBounds:gt,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},Td=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),Nd=()=>{const e=de(),{d3Zoom:t,d3Selection:n}=ae(Td,fe);return S.useMemo(()=>n&&t?{zoomIn:o=>t.scaleBy(et(n,o==null?void 0:o.duration),1.2),zoomOut:o=>t.scaleBy(et(n,o==null?void 0:o.duration),1/1.2),zoomTo:(o,i)=>t.scaleTo(et(n,i==null?void 0:i.duration),o),getZoom:()=>e.getState().transform[2],setViewport:(o,i)=>{const[s,a,u]=e.getState().transform,c=Pe.translate(o.x??s,o.y??a).scale(o.zoom??u);t.transform(et(n,i==null?void 0:i.duration),c)},getViewport:()=>{const[o,i,s]=e.getState().transform;return{x:o,y:i,zoom:s}},fitView:o=>Ms(e.getState,o),setCenter:(o,i,s)=>{const{width:a,height:u,maxZoom:c}=e.getState(),d=typeof(s==null?void 0:s.zoom)<"u"?s.zoom:c,p=a/2-o*d,g=u/2-i*d,x=Pe.translate(p,g).scale(d);t.transform(et(n,s==null?void 0:s.duration),x)},fitBounds:(o,i)=>{const{width:s,height:a,minZoom:u,maxZoom:c}=e.getState(),{x:d,y:p,zoom:g}=ys(o,s,a,u,c,(i==null?void 0:i.padding)??.1),x=Pe.translate(d,p).scale(g);t.transform(et(n,i==null?void 0:i.duration),x)},project:o=>{const{transform:i,snapToGrid:s,snapGrid:a}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),er(o,i,s,a)},screenToFlowPosition:o=>{const{transform:i,snapToGrid:s,snapGrid:a,domNode:u}=e.getState();if(!u)return o;const{x:c,y:d}=u.getBoundingClientRect(),p={x:o.x-c,y:o.y-d};return er(p,i,s,a)},flowToScreenPosition:o=>{const{transform:i,domNode:s}=e.getState();if(!s)return o;const{x:a,y:u}=s.getBoundingClientRect(),c=hs(o,i);return{x:c.x+a,y:c.y+u}},viewportInitialized:!0}:Cd,[t,n])};function Sr(){const e=Nd(),t=de(),n=S.useCallback(()=>t.getState().getNodes().map(y=>({...y})),[]),r=S.useCallback(y=>t.getState().nodeInternals.get(y),[]),o=S.useCallback(()=>{const{edges:y=[]}=t.getState();return y.map(k=>({...k}))},[]),i=S.useCallback(y=>{const{edges:k=[]}=t.getState();return k.find(h=>h.id===y)},[]),s=S.useCallback(y=>{const{getNodes:k,setNodes:h,hasDefaultNodes:b,onNodesChange:R}=t.getState(),C=k(),H=typeof y=="function"?y(C):y;if(b)h(H);else if(R){const _=H.length===0?C.map(A=>({type:"remove",id:A.id})):H.map(A=>({item:A,type:"reset"}));R(_)}},[]),a=S.useCallback(y=>{const{edges:k=[],setEdges:h,hasDefaultEdges:b,onEdgesChange:R}=t.getState(),C=typeof y=="function"?y(k):y;if(b)h(C);else if(R){const H=C.length===0?k.map(_=>({type:"remove",id:_.id})):C.map(_=>({item:_,type:"reset"}));R(H)}},[]),u=S.useCallback(y=>{const k=Array.isArray(y)?y:[y],{getNodes:h,setNodes:b,hasDefaultNodes:R,onNodesChange:C}=t.getState();if(R){const _=[...h(),...k];b(_)}else if(C){const H=k.map(_=>({item:_,type:"add"}));C(H)}},[]),c=S.useCallback(y=>{const k=Array.isArray(y)?y:[y],{edges:h=[],setEdges:b,hasDefaultEdges:R,onEdgesChange:C}=t.getState();if(R)b([...h,...k]);else if(C){const H=k.map(_=>({item:_,type:"add"}));C(H)}},[]),d=S.useCallback(()=>{const{getNodes:y,edges:k=[],transform:h}=t.getState(),[b,R,C]=h;return{nodes:y().map(H=>({...H})),edges:k.map(H=>({...H})),viewport:{x:b,y:R,zoom:C}}},[]),p=S.useCallback(({nodes:y,edges:k})=>{const{nodeInternals:h,getNodes:b,edges:R,hasDefaultNodes:C,hasDefaultEdges:H,onNodesDelete:_,onEdgesDelete:A,onNodesChange:$,onEdgesChange:I}=t.getState(),N=(y||[]).map(T=>T.id),L=(k||[]).map(T=>T.id),P=b().reduce((T,j)=>{const D=j.parentNode||j.parentId,z=!N.includes(j.id)&&D&&T.find(v=>v.id===D);return(typeof j.deletable=="boolean"?j.deletable:!0)&&(N.includes(j.id)||z)&&T.push(j),T},[]),w=R.filter(T=>typeof T.deletable=="boolean"?T.deletable:!0),f=w.filter(T=>L.includes(T.id));if(P||f){const T=xs(P,w),j=[...f,...T],D=j.reduce((z,E)=>(z.includes(E.id)||z.push(E.id),z),[]);if((H||C)&&(H&&t.setState({edges:R.filter(z=>!D.includes(z.id))}),C&&(P.forEach(z=>{h.delete(z.id)}),t.setState({nodeInternals:new Map(h)}))),D.length>0&&(A==null||A(j),I&&I(D.map(z=>({id:z,type:"remove"})))),P.length>0&&(_==null||_(P),$)){const z=P.map(E=>({id:E.id,type:"remove"}));$(z)}}},[]),g=S.useCallback(y=>{const k=Zu(y),h=k?null:t.getState().nodeInternals.get(y.id);return!k&&!h?[null,null,k]:[k?y:Jr(h),h,k]},[]),x=S.useCallback((y,k=!0,h)=>{const[b,R,C]=g(y);return b?(h||t.getState().getNodes()).filter(H=>{if(!C&&(H.id===R.id||!H.positionAbsolute))return!1;const _=Jr(H),A=Kn(_,b);return k&&A>0||A>=b.width*b.height}):[]},[]),m=S.useCallback((y,k,h=!0)=>{const[b]=g(y);if(!b)return!1;const R=Kn(b,k);return h&&R>0||R>=b.width*b.height},[]);return S.useMemo(()=>({...e,getNodes:n,getNode:r,getEdges:o,getEdge:i,setNodes:s,setEdges:a,addNodes:u,addEdges:c,toObject:d,deleteElements:p,getIntersectingNodes:x,isNodeIntersecting:m}),[e,n,r,o,i,s,a,u,c,d,p,x,m])}const zd={actInsideInputWithModifier:!1};var $d=({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const n=de(),{deleteElements:r}=Sr(),o=qt(e,zd),i=qt(t);S.useEffect(()=>{if(o){const{edges:s,getNodes:a}=n.getState(),u=a().filter(d=>d.selected),c=s.filter(d=>d.selected);r({nodes:u,edges:c}),n.setState({nodesSelectionActive:!1})}},[o]),S.useEffect(()=>{n.setState({multiSelectionActive:i})},[i])};function Md(e){const t=de();S.useEffect(()=>{let n;const r=()=>{var i,s;if(!e.current)return;const o=hr(e.current);(o.height===0||o.width===0)&&((s=(i=t.getState()).onError)==null||s.call(i,"004",He.error004())),t.setState({width:o.width||500,height:o.height||500})};return r(),window.addEventListener("resize",r),e.current&&(n=new ResizeObserver(()=>r()),n.observe(e.current)),()=>{window.removeEventListener("resize",r),n&&e.current&&n.unobserve(e.current)}},[])}const _r={position:"absolute",width:"100%",height:"100%",top:0,left:0},Rd=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,on=e=>({x:e.x,y:e.y,zoom:e.k}),xt=(e,t)=>e.target.closest(`.${t}`),lo=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),co=e=>{const t=e.ctrlKey&&yn()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t},Ad=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),Id=({onMove:e,onMoveStart:t,onMoveEnd:n,onPaneContextMenu:r,zoomOnScroll:o=!0,zoomOnPinch:i=!0,panOnScroll:s=!1,panOnScrollSpeed:a=.5,panOnScrollMode:u=rt.Free,zoomOnDoubleClick:c=!0,elementsSelectable:d,panOnDrag:p=!0,defaultViewport:g,translateExtent:x,minZoom:m,maxZoom:y,zoomActivationKeyCode:k,preventScrolling:h=!0,children:b,noWheelClassName:R,noPanClassName:C})=>{const H=S.useRef(),_=de(),A=S.useRef(!1),$=S.useRef(!1),I=S.useRef(null),N=S.useRef({x:0,y:0,zoom:0}),{d3Zoom:L,d3Selection:P,d3ZoomHandler:w,userSelectionActive:f}=ae(Ad,fe),T=qt(k),j=S.useRef(0),D=S.useRef(!1),z=S.useRef();return Md(I),S.useEffect(()=>{if(I.current){const E=I.current.getBoundingClientRect(),v=ts().scaleExtent([m,y]).translateExtent(x),M=ve(I.current).call(v),O=Pe.translate(g.x,g.y).scale(kt(g.zoom,m,y)),V=[[0,0],[E.width,E.height]],W=v.constrain()(O,V,x);v.transform(M,W),v.wheelDelta(co),_.setState({d3Zoom:v,d3Selection:M,d3ZoomHandler:M.on("wheel.zoom"),transform:[W.x,W.y,W.k],domNode:I.current.closest(".react-flow")})}},[]),S.useEffect(()=>{P&&L&&(s&&!T&&!f?P.on("wheel.zoom",E=>{if(xt(E,R))return!1;E.preventDefault(),E.stopImmediatePropagation();const v=P.property("__zoom").k||1;if(E.ctrlKey&&i){const Q=Ee(E),te=co(E),ee=v*Math.pow(2,te);L.scaleTo(P,ee,Q,E);return}const M=E.deltaMode===1?20:1;let O=u===rt.Vertical?0:E.deltaX*M,V=u===rt.Horizontal?0:E.deltaY*M;!yn()&&E.shiftKey&&u!==rt.Vertical&&(O=E.deltaY*M,V=0),L.translateBy(P,-(O/v)*a,-(V/v)*a,{internal:!0});const W=on(P.property("__zoom")),{onViewportChangeStart:X,onViewportChange:U,onViewportChangeEnd:J}=_.getState();clearTimeout(z.current),D.current||(D.current=!0,t==null||t(E,W),X==null||X(W)),D.current&&(e==null||e(E,W),U==null||U(W),z.current=setTimeout(()=>{n==null||n(E,W),J==null||J(W),D.current=!1},150))},{passive:!1}):typeof w<"u"&&P.on("wheel.zoom",function(E,v){if(!h&&E.type==="wheel"&&!E.ctrlKey||xt(E,R))return null;E.preventDefault(),w.call(this,E,v)},{passive:!1}))},[f,s,u,P,L,w,T,i,h,R,t,e,n]),S.useEffect(()=>{L&&L.on("start",E=>{var O,V;if(!E.sourceEvent||E.sourceEvent.internal)return null;j.current=(O=E.sourceEvent)==null?void 0:O.button;const{onViewportChangeStart:v}=_.getState(),M=on(E.transform);A.current=!0,N.current=M,((V=E.sourceEvent)==null?void 0:V.type)==="mousedown"&&_.setState({paneDragging:!0}),v==null||v(M),t==null||t(E.sourceEvent,M)})},[L,t]),S.useEffect(()=>{L&&(f&&!A.current?L.on("zoom",null):f||L.on("zoom",E=>{var M;const{onViewportChange:v}=_.getState();if(_.setState({transform:[E.transform.x,E.transform.y,E.transform.k]}),$.current=!!(r&&lo(p,j.current??0)),(e||v)&&!((M=E.sourceEvent)!=null&&M.internal)){const O=on(E.transform);v==null||v(O),e==null||e(E.sourceEvent,O)}}))},[f,L,e,p,r]),S.useEffect(()=>{L&&L.on("end",E=>{if(!E.sourceEvent||E.sourceEvent.internal)return null;const{onViewportChangeEnd:v}=_.getState();if(A.current=!1,_.setState({paneDragging:!1}),r&&lo(p,j.current??0)&&!$.current&&r(E.sourceEvent),$.current=!1,(n||v)&&Rd(N.current,E.transform)){const M=on(E.transform);N.current=M,clearTimeout(H.current),H.current=setTimeout(()=>{v==null||v(M),n==null||n(E.sourceEvent,M)},s?150:0)}})},[L,s,p,n,r]),S.useEffect(()=>{L&&L.filter(E=>{const v=T||o,M=i&&E.ctrlKey;if((p===!0||Array.isArray(p)&&p.includes(1))&&E.button===1&&E.type==="mousedown"&&(xt(E,"react-flow__node")||xt(E,"react-flow__edge")))return!0;if(!p&&!v&&!s&&!c&&!i||f||!c&&E.type==="dblclick"||xt(E,R)&&E.type==="wheel"||xt(E,C)&&(E.type!=="wheel"||s&&E.type==="wheel"&&!T)||!i&&E.ctrlKey&&E.type==="wheel"||!v&&!s&&!M&&E.type==="wheel"||!p&&(E.type==="mousedown"||E.type==="touchstart")||Array.isArray(p)&&!p.includes(E.button)&&E.type==="mousedown")return!1;const O=Array.isArray(p)&&p.includes(E.button)||!E.button||E.button<=1;return(!E.ctrlKey||E.type==="wheel")&&O})},[f,L,o,i,s,c,p,d,T]),B.createElement("div",{className:"react-flow__renderer",ref:I,style:_r},b)},Dd=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function Pd(){const{userSelectionActive:e,userSelectionRect:t}=ae(Dd,fe);return e&&t?B.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function uo(e,t){const n=t.parentNode||t.parentId,r=e.find(o=>o.id===n);if(r){const o=t.position.x+t.width-r.width,i=t.position.y+t.height-r.height;if(o>0||i>0||t.position.x<0||t.position.y<0){if(r.style={...r.style},r.style.width=r.style.width??r.width,r.style.height=r.style.height??r.height,o>0&&(r.style.width+=o),i>0&&(r.style.height+=i),t.position.x<0){const s=Math.abs(t.position.x);r.position.x=r.position.x-s,r.style.width+=s,t.position.x=0}if(t.position.y<0){const s=Math.abs(t.position.y);r.position.y=r.position.y-s,r.style.height+=s,t.position.y=0}r.width=r.style.width,r.height=r.style.height}}}function Rs(e,t){if(e.some(r=>r.type==="reset"))return e.filter(r=>r.type==="reset").map(r=>r.item);const n=e.filter(r=>r.type==="add").map(r=>r.item);return t.reduce((r,o)=>{const i=e.filter(a=>a.id===o.id);if(i.length===0)return r.push(o),r;const s={...o};for(const a of i)if(a)switch(a.type){case"select":{s.selected=a.selected;break}case"position":{typeof a.position<"u"&&(s.position=a.position),typeof a.positionAbsolute<"u"&&(s.positionAbsolute=a.positionAbsolute),typeof a.dragging<"u"&&(s.dragging=a.dragging),s.expandParent&&uo(r,s);break}case"dimensions":{typeof a.dimensions<"u"&&(s.width=a.dimensions.width,s.height=a.dimensions.height),typeof a.updateStyle<"u"&&(s.style={...s.style||{},...a.dimensions}),typeof a.resizing=="boolean"&&(s.resizing=a.resizing),s.expandParent&&uo(r,s);break}case"remove":return r}return r.push(s),r},n)}function As(e,t){return Rs(e,t)}function Od(e,t){return Rs(e,t)}const We=(e,t)=>({id:e,type:"select",selected:t});function mt(e,t){return e.reduce((n,r)=>{const o=t.includes(r.id);return!r.selected&&o?(r.selected=!0,n.push(We(r.id,!0))):r.selected&&!o&&(r.selected=!1,n.push(We(r.id,!1))),n},[])}const Bn=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},Bd=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),Is=S.memo(({isSelecting:e,selectionMode:t=Xt.Full,panOnDrag:n,onSelectionStart:r,onSelectionEnd:o,onPaneClick:i,onPaneContextMenu:s,onPaneScroll:a,onPaneMouseEnter:u,onPaneMouseMove:c,onPaneMouseLeave:d,children:p})=>{const g=S.useRef(null),x=de(),m=S.useRef(0),y=S.useRef(0),k=S.useRef(),{userSelectionActive:h,elementsSelectable:b,dragging:R}=ae(Bd,fe),C=()=>{x.setState({userSelectionActive:!1,userSelectionRect:null}),m.current=0,y.current=0},H=w=>{i==null||i(w),x.getState().resetSelectedElements(),x.setState({nodesSelectionActive:!1})},_=w=>{if(Array.isArray(n)&&(n!=null&&n.includes(2))){w.preventDefault();return}s==null||s(w)},A=a?w=>a(w):void 0,$=w=>{const{resetSelectedElements:f,domNode:T}=x.getState();if(k.current=T==null?void 0:T.getBoundingClientRect(),!b||!e||w.button!==0||w.target!==g.current||!k.current)return;const{x:j,y:D}=Xe(w,k.current);f(),x.setState({userSelectionRect:{width:0,height:0,startX:j,startY:D,x:j,y:D}}),r==null||r(w)},I=w=>{const{userSelectionRect:f,nodeInternals:T,edges:j,transform:D,onNodesChange:z,onEdgesChange:E,nodeOrigin:v,getNodes:M}=x.getState();if(!e||!k.current||!f)return;x.setState({userSelectionActive:!0,nodesSelectionActive:!1});const O=Xe(w,k.current),V=f.startX??0,W=f.startY??0,X={...f,x:O.x<V?O.x:V,y:O.y<W?O.y:W,width:Math.abs(O.x-V),height:Math.abs(O.y-W)},U=M(),J=gs(T,X,D,t===Xt.Partial,!0,v),Q=xs(J,j).map(ee=>ee.id),te=J.map(ee=>ee.id);if(m.current!==te.length){m.current=te.length;const ee=mt(U,te);ee.length&&(z==null||z(ee))}if(y.current!==Q.length){y.current=Q.length;const ee=mt(j,Q);ee.length&&(E==null||E(ee))}x.setState({userSelectionRect:X})},N=w=>{if(w.button!==0)return;const{userSelectionRect:f}=x.getState();!h&&f&&w.target===g.current&&(H==null||H(w)),x.setState({nodesSelectionActive:m.current>0}),C(),o==null||o(w)},L=w=>{h&&(x.setState({nodesSelectionActive:m.current>0}),o==null||o(w)),C()},P=b&&(e||h);return B.createElement("div",{className:he(["react-flow__pane",{dragging:R,selection:e}]),onClick:P?void 0:Bn(H,g),onContextMenu:Bn(_,g),onWheel:Bn(A,g),onMouseEnter:P?void 0:u,onMouseDown:P?$:void 0,onMouseMove:P?I:c,onMouseUp:P?N:void 0,onMouseLeave:P?L:d,ref:g,style:_r},p,B.createElement(Pd,null))});Is.displayName="Pane";function Ds(e,t){const n=e.parentNode||e.parentId;if(!n)return!1;const r=t.get(n);return r?r.selected?!0:Ds(r,t):!1}function fo(e,t,n){let r=e;do{if(r!=null&&r.matches(t))return!0;if(r===n.current)return!1;r=r.parentElement}while(r);return!1}function Hd(e,t,n,r){return Array.from(e.values()).filter(o=>(o.selected||o.id===r)&&(!o.parentNode||o.parentId||!Ds(o,e))&&(o.draggable||t&&typeof o.draggable>"u")).map(o=>{var i,s;return{id:o.id,position:o.position||{x:0,y:0},positionAbsolute:o.positionAbsolute||{x:0,y:0},distance:{x:n.x-(((i=o.positionAbsolute)==null?void 0:i.x)??0),y:n.y-(((s=o.positionAbsolute)==null?void 0:s.y)??0)},delta:{x:0,y:0},extent:o.extent,parentNode:o.parentNode||o.parentId,parentId:o.parentNode||o.parentId,width:o.width,height:o.height,expandParent:o.expandParent}})}function Ld(e,t){return!t||t==="parent"?t:[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]}function Ps(e,t,n,r,o=[0,0],i){const s=Ld(e,e.extent||r);let a=s;const u=e.parentNode||e.parentId;if(e.extent==="parent"&&!e.expandParent)if(u&&e.width&&e.height){const p=n.get(u),{x:g,y:x}=it(p,o).positionAbsolute;a=p&&we(g)&&we(x)&&we(p.width)&&we(p.height)?[[g+e.width*o[0],x+e.height*o[1]],[g+p.width-e.width+e.width*o[0],x+p.height-e.height+e.height*o[1]]]:a}else i==null||i("005",He.error005()),a=s;else if(e.extent&&u&&e.extent!=="parent"){const p=n.get(u),{x:g,y:x}=it(p,o).positionAbsolute;a=[[e.extent[0][0]+g,e.extent[0][1]+x],[e.extent[1][0]+g,e.extent[1][1]+x]]}let c={x:0,y:0};if(u){const p=n.get(u);c=it(p,o).positionAbsolute}const d=a&&a!=="parent"?gr(t,a):t;return{position:{x:d.x-c.x,y:d.y-c.y},positionAbsolute:d}}function Hn({nodeId:e,dragItems:t,nodeInternals:n}){const r=t.map(o=>({...n.get(o.id),position:o.position,positionAbsolute:o.positionAbsolute}));return[e?r.find(o=>o.id===e):r[0],r]}const po=(e,t,n,r)=>{const o=t.querySelectorAll(e);if(!o||!o.length)return null;const i=Array.from(o),s=t.getBoundingClientRect(),a={x:s.width*r[0],y:s.height*r[1]};return i.map(u=>{const c=u.getBoundingClientRect();return{id:u.getAttribute("data-handleid"),position:u.getAttribute("data-handlepos"),x:(c.left-s.left-a.x)/n,y:(c.top-s.top-a.y)/n,...hr(u)}})};function At(e,t,n){return n===void 0?n:r=>{const o=t().nodeInternals.get(e);o&&n(r,{...o})}}function nr({id:e,store:t,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:o,unselectNodesAndEdges:i,multiSelectionActive:s,nodeInternals:a,onError:u}=t.getState(),c=a.get(e);if(!c){u==null||u("012",He.error012(e));return}t.setState({nodesSelectionActive:!1}),c.selected?(n||c.selected&&s)&&(i({nodes:[c],edges:[]}),requestAnimationFrame(()=>{var d;return(d=r==null?void 0:r.current)==null?void 0:d.blur()})):o([e])}function Fd(){const e=de();return S.useCallback(({sourceEvent:n})=>{const{transform:r,snapGrid:o,snapToGrid:i}=e.getState(),s=n.touches?n.touches[0].clientX:n.clientX,a=n.touches?n.touches[0].clientY:n.clientY,u={x:(s-r[0])/r[2],y:(a-r[1])/r[2]};return{xSnapped:i?o[0]*Math.round(u.x/o[0]):u.x,ySnapped:i?o[1]*Math.round(u.y/o[1]):u.y,...u}},[])}function Ln(e){return(t,n,r)=>e==null?void 0:e(t,r)}function Os({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:r,nodeId:o,isSelectable:i,selectNodesOnDrag:s}){const a=de(),[u,c]=S.useState(!1),d=S.useRef([]),p=S.useRef({x:null,y:null}),g=S.useRef(0),x=S.useRef(null),m=S.useRef({x:0,y:0}),y=S.useRef(null),k=S.useRef(!1),h=S.useRef(!1),b=S.useRef(!1),R=Fd();return S.useEffect(()=>{if(e!=null&&e.current){const C=ve(e.current),H=({x:$,y:I})=>{const{nodeInternals:N,onNodeDrag:L,onSelectionDrag:P,updateNodePositions:w,nodeExtent:f,snapGrid:T,snapToGrid:j,nodeOrigin:D,onError:z}=a.getState();p.current={x:$,y:I};let E=!1,v={x:0,y:0,x2:0,y2:0};if(d.current.length>1&&f){const O=Tn(d.current,D);v=Yt(O)}if(d.current=d.current.map(O=>{const V={x:$-O.distance.x,y:I-O.distance.y};j&&(V.x=T[0]*Math.round(V.x/T[0]),V.y=T[1]*Math.round(V.y/T[1]));const W=[[f[0][0],f[0][1]],[f[1][0],f[1][1]]];d.current.length>1&&f&&!O.extent&&(W[0][0]=O.positionAbsolute.x-v.x+f[0][0],W[1][0]=O.positionAbsolute.x+(O.width??0)-v.x2+f[1][0],W[0][1]=O.positionAbsolute.y-v.y+f[0][1],W[1][1]=O.positionAbsolute.y+(O.height??0)-v.y2+f[1][1]);const X=Ps(O,V,N,W,D,z);return E=E||O.position.x!==X.position.x||O.position.y!==X.position.y,O.position=X.position,O.positionAbsolute=X.positionAbsolute,O}),!E)return;w(d.current,!0,!0),c(!0);const M=o?L:Ln(P);if(M&&y.current){const[O,V]=Hn({nodeId:o,dragItems:d.current,nodeInternals:N});M(y.current,O,V)}},_=()=>{if(!x.current)return;const[$,I]=rs(m.current,x.current);if($!==0||I!==0){const{transform:N,panBy:L}=a.getState();p.current.x=(p.current.x??0)-$/N[2],p.current.y=(p.current.y??0)-I/N[2],L({x:$,y:I})&&H(p.current)}g.current=requestAnimationFrame(_)},A=$=>{var D;const{nodeInternals:I,multiSelectionActive:N,nodesDraggable:L,unselectNodesAndEdges:P,onNodeDragStart:w,onSelectionDragStart:f}=a.getState();h.current=!0;const T=o?w:Ln(f);(!s||!i)&&!N&&o&&((D=I.get(o))!=null&&D.selected||P()),o&&i&&s&&nr({id:o,store:a,nodeRef:e});const j=R($);if(p.current=j,d.current=Hd(I,L,j,o),T&&d.current){const[z,E]=Hn({nodeId:o,dragItems:d.current,nodeInternals:I});T($.sourceEvent,z,E)}};if(t)C.on(".drag",null);else{const $=ec().on("start",I=>{const{domNode:N,nodeDragThreshold:L}=a.getState();L===0&&A(I),b.current=!1;const P=R(I);p.current=P,x.current=(N==null?void 0:N.getBoundingClientRect())||null,m.current=Xe(I.sourceEvent,x.current)}).on("drag",I=>{var w,f;const N=R(I),{autoPanOnNodeDrag:L,nodeDragThreshold:P}=a.getState();if(I.sourceEvent.type==="touchmove"&&I.sourceEvent.touches.length>1&&(b.current=!0),!b.current){if(!k.current&&h.current&&L&&(k.current=!0,_()),!h.current){const T=N.xSnapped-(((w=p==null?void 0:p.current)==null?void 0:w.x)??0),j=N.ySnapped-(((f=p==null?void 0:p.current)==null?void 0:f.y)??0);Math.sqrt(T*T+j*j)>P&&A(I)}(p.current.x!==N.xSnapped||p.current.y!==N.ySnapped)&&d.current&&h.current&&(y.current=I.sourceEvent,m.current=Xe(I.sourceEvent,x.current),H(N))}}).on("end",I=>{if(!(!h.current||b.current)&&(c(!1),k.current=!1,h.current=!1,cancelAnimationFrame(g.current),d.current)){const{updateNodePositions:N,nodeInternals:L,onNodeDragStop:P,onSelectionDragStop:w}=a.getState(),f=o?P:Ln(w);if(N(d.current,!1,!1),f){const[T,j]=Hn({nodeId:o,dragItems:d.current,nodeInternals:L});f(I.sourceEvent,T,j)}}}).filter(I=>{const N=I.target;return!I.button&&(!n||!fo(N,`.${n}`,e))&&(!r||fo(N,r,e))});return C.call($),()=>{C.on(".drag",null)}}}},[e,t,n,r,i,a,o,s,R]),u}function Bs(){const e=de();return S.useCallback(n=>{const{nodeInternals:r,nodeExtent:o,updateNodePositions:i,getNodes:s,snapToGrid:a,snapGrid:u,onError:c,nodesDraggable:d}=e.getState(),p=s().filter(b=>b.selected&&(b.draggable||d&&typeof b.draggable>"u")),g=a?u[0]:5,x=a?u[1]:5,m=n.isShiftPressed?4:1,y=n.x*g*m,k=n.y*x*m,h=p.map(b=>{if(b.positionAbsolute){const R={x:b.positionAbsolute.x+y,y:b.positionAbsolute.y+k};a&&(R.x=u[0]*Math.round(R.x/u[0]),R.y=u[1]*Math.round(R.y/u[1]));const{positionAbsolute:C,position:H}=Ps(b,R,r,o,void 0,c);b.position=H,b.positionAbsolute=C}return b});i(h,!0,!1)},[])}const wt={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var It=e=>{const t=({id:n,type:r,data:o,xPos:i,yPos:s,xPosOrigin:a,yPosOrigin:u,selected:c,onClick:d,onMouseEnter:p,onMouseMove:g,onMouseLeave:x,onContextMenu:m,onDoubleClick:y,style:k,className:h,isDraggable:b,isSelectable:R,isConnectable:C,isFocusable:H,selectNodesOnDrag:_,sourcePosition:A,targetPosition:$,hidden:I,resizeObserver:N,dragHandle:L,zIndex:P,isParent:w,noDragClassName:f,noPanClassName:T,initialized:j,disableKeyboardA11y:D,ariaLabel:z,rfId:E,hasHandleBounds:v})=>{const M=de(),O=S.useRef(null),V=S.useRef(null),W=S.useRef(A),X=S.useRef($),U=S.useRef(r),J=R||b||d||p||g||x,Q=Bs(),te=At(n,M.getState,p),ee=At(n,M.getState,g),oe=At(n,M.getState,x),se=At(n,M.getState,m),re=At(n,M.getState,y),le=Y=>{const{nodeDragThreshold:F}=M.getState();if(R&&(!_||!b||F>0)&&nr({id:n,store:M,nodeRef:O}),d){const Z=M.getState().nodeInternals.get(n);Z&&d(Y,{...Z})}},K=Y=>{if(!Jn(Y)&&!D)if(as.includes(Y.key)&&R){const F=Y.key==="Escape";nr({id:n,store:M,unselect:F,nodeRef:O})}else b&&c&&Object.prototype.hasOwnProperty.call(wt,Y.key)&&(M.setState({ariaLiveMessage:`Moved selected node ${Y.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~i}, y: ${~~s}`}),Q({x:wt[Y.key].x,y:wt[Y.key].y,isShiftPressed:Y.shiftKey}))};S.useEffect(()=>()=>{V.current&&(N==null||N.unobserve(V.current),V.current=null)},[]),S.useEffect(()=>{if(O.current&&!I){const Y=O.current;(!j||!v||V.current!==Y)&&(V.current&&(N==null||N.unobserve(V.current)),N==null||N.observe(Y),V.current=Y)}},[I,j,v]),S.useEffect(()=>{const Y=U.current!==r,F=W.current!==A,Z=X.current!==$;O.current&&(Y||F||Z)&&(Y&&(U.current=r),F&&(W.current=A),Z&&(X.current=$),M.getState().updateNodeDimensions([{id:n,nodeElement:O.current,forceUpdate:!0}]))},[n,r,A,$]);const q=Os({nodeRef:O,disabled:I||!b,noDragClassName:f,handleSelector:L,nodeId:n,isSelectable:R,selectNodesOnDrag:_});return I?null:B.createElement("div",{className:he(["react-flow__node",`react-flow__node-${r}`,{[T]:b},h,{selected:c,selectable:R,parent:w,dragging:q}]),ref:O,style:{zIndex:P,transform:`translate(${a}px,${u}px)`,pointerEvents:J?"all":"none",visibility:j?"visible":"hidden",...k},"data-id":n,"data-testid":`rf__node-${n}`,onMouseEnter:te,onMouseMove:ee,onMouseLeave:oe,onContextMenu:se,onClick:le,onDoubleClick:re,onKeyDown:H?K:void 0,tabIndex:H?0:void 0,role:H?"button":void 0,"aria-describedby":D?void 0:`${Ts}-${E}`,"aria-label":z},B.createElement(rd,{value:n},B.createElement(e,{id:n,data:o,type:r,xPos:i,yPos:s,selected:c,isConnectable:C,sourcePosition:A,targetPosition:$,dragging:q,dragHandle:L,zIndex:P})))};return t.displayName="NodeWrapper",S.memo(t)};const Vd=e=>{const t=e.getNodes().filter(n=>n.selected);return{...Tn(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};function Wd({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const r=de(),{width:o,height:i,x:s,y:a,transformString:u,userSelectionActive:c}=ae(Vd,fe),d=Bs(),p=S.useRef(null);if(S.useEffect(()=>{var m;n||(m=p.current)==null||m.focus({preventScroll:!0})},[n]),Os({nodeRef:p}),c||!o||!i)return null;const g=e?m=>{const y=r.getState().getNodes().filter(k=>k.selected);e(m,y)}:void 0,x=m=>{Object.prototype.hasOwnProperty.call(wt,m.key)&&d({x:wt[m.key].x,y:wt[m.key].y,isShiftPressed:m.shiftKey})};return B.createElement("div",{className:he(["react-flow__nodesselection","react-flow__container",t]),style:{transform:u}},B.createElement("div",{ref:p,className:"react-flow__nodesselection-rect",onContextMenu:g,tabIndex:n?void 0:-1,onKeyDown:n?void 0:x,style:{width:o,height:i,top:a,left:s}}))}var Yd=S.memo(Wd);const Xd=e=>e.nodesSelectionActive,Hs=({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:i,onPaneScroll:s,deleteKeyCode:a,onMove:u,onMoveStart:c,onMoveEnd:d,selectionKeyCode:p,selectionOnDrag:g,selectionMode:x,onSelectionStart:m,onSelectionEnd:y,multiSelectionKeyCode:k,panActivationKeyCode:h,zoomActivationKeyCode:b,elementsSelectable:R,zoomOnScroll:C,zoomOnPinch:H,panOnScroll:_,panOnScrollSpeed:A,panOnScrollMode:$,zoomOnDoubleClick:I,panOnDrag:N,defaultViewport:L,translateExtent:P,minZoom:w,maxZoom:f,preventScrolling:T,onSelectionContextMenu:j,noWheelClassName:D,noPanClassName:z,disableKeyboardA11y:E})=>{const v=ae(Xd),M=qt(p),O=qt(h),V=O||N,W=O||_,X=M||g&&V!==!0;return $d({deleteKeyCode:a,multiSelectionKeyCode:k}),B.createElement(Id,{onMove:u,onMoveStart:c,onMoveEnd:d,onPaneContextMenu:i,elementsSelectable:R,zoomOnScroll:C,zoomOnPinch:H,panOnScroll:W,panOnScrollSpeed:A,panOnScrollMode:$,zoomOnDoubleClick:I,panOnDrag:!M&&V,defaultViewport:L,translateExtent:P,minZoom:w,maxZoom:f,zoomActivationKeyCode:b,preventScrolling:T,noWheelClassName:D,noPanClassName:z},B.createElement(Is,{onSelectionStart:m,onSelectionEnd:y,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:o,onPaneContextMenu:i,onPaneScroll:s,panOnDrag:V,isSelecting:!!X,selectionMode:x},e,v&&B.createElement(Yd,{onSelectionContextMenu:j,noPanClassName:z,disableKeyboardA11y:E})))};Hs.displayName="FlowRenderer";var qd=S.memo(Hs);function Ud(e){return ae(S.useCallback(n=>e?gs(n.nodeInternals,{x:0,y:0,width:n.width,height:n.height},n.transform,!0):n.getNodes(),[e]))}function Gd(e){const t={input:It(e.input||Es),default:It(e.default||tr),output:It(e.output||js),group:It(e.group||wr)},n={},r=Object.keys(e).filter(o=>!["input","default","output","group"].includes(o)).reduce((o,i)=>(o[i]=It(e[i]||tr),o),n);return{...t,...r}}const Zd=({x:e,y:t,width:n,height:r,origin:o})=>!n||!r?{x:e,y:t}:o[0]<0||o[1]<0||o[0]>1||o[1]>1?{x:e,y:t}:{x:e-n*o[0],y:t-r*o[1]},Kd=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),Ls=e=>{const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:o,updateNodeDimensions:i,onError:s}=ae(Kd,fe),a=Ud(e.onlyRenderVisibleElements),u=S.useRef(),c=S.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const d=new ResizeObserver(p=>{const g=p.map(x=>({id:x.target.getAttribute("data-id"),nodeElement:x.target,forceUpdate:!0}));i(g)});return u.current=d,d},[]);return S.useEffect(()=>()=>{var d;(d=u==null?void 0:u.current)==null||d.disconnect()},[]),B.createElement("div",{className:"react-flow__nodes",style:_r},a.map(d=>{var H,_,A;let p=d.type||"default";e.nodeTypes[p]||(s==null||s("003",He.error003(p)),p="default");const g=e.nodeTypes[p]||e.nodeTypes.default,x=!!(d.draggable||t&&typeof d.draggable>"u"),m=!!(d.selectable||o&&typeof d.selectable>"u"),y=!!(d.connectable||n&&typeof d.connectable>"u"),k=!!(d.focusable||r&&typeof d.focusable>"u"),h=e.nodeExtent?gr(d.positionAbsolute,e.nodeExtent):d.positionAbsolute,b=(h==null?void 0:h.x)??0,R=(h==null?void 0:h.y)??0,C=Zd({x:b,y:R,width:d.width??0,height:d.height??0,origin:e.nodeOrigin});return B.createElement(g,{key:d.id,id:d.id,className:d.className,style:d.style,type:p,data:d.data,sourcePosition:d.sourcePosition||G.Bottom,targetPosition:d.targetPosition||G.Top,hidden:d.hidden,xPos:b,yPos:R,xPosOrigin:C.x,yPosOrigin:C.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!d.selected,isDraggable:x,isSelectable:m,isConnectable:y,isFocusable:k,resizeObserver:c,dragHandle:d.dragHandle,zIndex:((H=d[ue])==null?void 0:H.z)??0,isParent:!!((_=d[ue])!=null&&_.isParent),noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!d.width&&!!d.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:d.ariaLabel,hasHandleBounds:!!((A=d[ue])!=null&&A.handleBounds)})}))};Ls.displayName="NodeRenderer";var Jd=S.memo(Ls);const Qd=(e,t,n)=>n===G.Left?e-t:n===G.Right?e+t:e,ef=(e,t,n)=>n===G.Top?e-t:n===G.Bottom?e+t:e,ho="react-flow__edgeupdater",go=({position:e,centerX:t,centerY:n,radius:r=10,onMouseDown:o,onMouseEnter:i,onMouseOut:s,type:a})=>B.createElement("circle",{onMouseDown:o,onMouseEnter:i,onMouseOut:s,className:he([ho,`${ho}-${a}`]),cx:Qd(t,r,e),cy:ef(n,r,e),r,stroke:"transparent",fill:"transparent"}),tf=()=>!0;var yt=e=>{const t=({id:n,className:r,type:o,data:i,onClick:s,onEdgeDoubleClick:a,selected:u,animated:c,label:d,labelStyle:p,labelShowBg:g,labelBgStyle:x,labelBgPadding:m,labelBgBorderRadius:y,style:k,source:h,target:b,sourceX:R,sourceY:C,targetX:H,targetY:_,sourcePosition:A,targetPosition:$,elementsSelectable:I,hidden:N,sourceHandleId:L,targetHandleId:P,onContextMenu:w,onMouseEnter:f,onMouseMove:T,onMouseLeave:j,reconnectRadius:D,onReconnect:z,onReconnectStart:E,onReconnectEnd:v,markerEnd:M,markerStart:O,rfId:V,ariaLabel:W,isFocusable:X,isReconnectable:U,pathOptions:J,interactionWidth:Q,disableKeyboardA11y:te})=>{const ee=S.useRef(null),[oe,se]=S.useState(!1),[re,le]=S.useState(!1),K=de(),q=S.useMemo(()=>`url('#${Qn(O,V)}')`,[O,V]),Y=S.useMemo(()=>`url('#${Qn(M,V)}')`,[M,V]);if(N)return null;const F=xe=>{var Ne;const{edges:_e,addSelectedEdges:Ge,unselectNodesAndEdges:Ze,multiSelectionActive:Ke}=K.getState(),Ae=_e.find(Nt=>Nt.id===n);Ae&&(I&&(K.setState({nodesSelectionActive:!1}),Ae.selected&&Ke?(Ze({nodes:[],edges:[Ae]}),(Ne=ee.current)==null||Ne.blur()):Ge([n])),s&&s(xe,Ae))},Z=Rt(n,K.getState,a),ie=Rt(n,K.getState,w),ce=Rt(n,K.getState,f),me=Rt(n,K.getState,T),ge=Rt(n,K.getState,j),Re=(xe,_e)=>{if(xe.button!==0)return;const{edges:Ge,isValidConnection:Ze}=K.getState(),Ke=_e?b:h,Ae=(_e?P:L)||null,Ne=_e?"target":"source",Nt=Ze||tf,Nn=_e,zt=Ge.find(Je=>Je.id===n);le(!0),E==null||E(xe,zt,Ne);const zn=Je=>{le(!1),v==null||v(Je,zt,Ne)};vs({event:xe,handleId:Ae,nodeId:Ke,onConnect:Je=>z==null?void 0:z(zt,Je),isTarget:Nn,getState:K.getState,setState:K.setState,isValidConnection:Nt,edgeUpdaterType:Ne,onReconnectEnd:zn})},ut=xe=>Re(xe,!0),qe=xe=>Re(xe,!1),Ue=()=>se(!0),dt=()=>se(!1),ft=!I&&!s,Tt=xe=>{var _e;if(!te&&as.includes(xe.key)&&I){const{unselectNodesAndEdges:Ge,addSelectedEdges:Ze,edges:Ke}=K.getState();xe.key==="Escape"?((_e=ee.current)==null||_e.blur(),Ge({edges:[Ke.find(Ne=>Ne.id===n)]})):Ze([n])}};return B.createElement("g",{className:he(["react-flow__edge",`react-flow__edge-${o}`,r,{selected:u,animated:c,inactive:ft,updating:oe}]),onClick:F,onDoubleClick:Z,onContextMenu:ie,onMouseEnter:ce,onMouseMove:me,onMouseLeave:ge,onKeyDown:X?Tt:void 0,tabIndex:X?0:void 0,role:X?"button":"img","data-testid":`rf__edge-${n}`,"aria-label":W===null?void 0:W||`Edge from ${h} to ${b}`,"aria-describedby":X?`${Ns}-${V}`:void 0,ref:ee},!re&&B.createElement(e,{id:n,source:h,target:b,selected:u,animated:c,label:d,labelStyle:p,labelShowBg:g,labelBgStyle:x,labelBgPadding:m,labelBgBorderRadius:y,data:i,style:k,sourceX:R,sourceY:C,targetX:H,targetY:_,sourcePosition:A,targetPosition:$,sourceHandleId:L,targetHandleId:P,markerStart:q,markerEnd:Y,pathOptions:J,interactionWidth:Q}),U&&B.createElement(B.Fragment,null,(U==="source"||U===!0)&&B.createElement(go,{position:A,centerX:R,centerY:C,radius:D,onMouseDown:ut,onMouseEnter:Ue,onMouseOut:dt,type:"source"}),(U==="target"||U===!0)&&B.createElement(go,{position:$,centerX:H,centerY:_,radius:D,onMouseDown:qe,onMouseEnter:Ue,onMouseOut:dt,type:"target"})))};return t.displayName="EdgeWrapper",S.memo(t)};function nf(e){const t={default:yt(e.default||bn),straight:yt(e.bezier||mr),step:yt(e.step||yr),smoothstep:yt(e.step||Cn),simplebezier:yt(e.simplebezier||xr)},n={},r=Object.keys(e).filter(o=>!["default","bezier"].includes(o)).reduce((o,i)=>(o[i]=yt(e[i]||bn),o),n);return{...t,...r}}function xo(e,t,n=null){const r=((n==null?void 0:n.x)||0)+t.x,o=((n==null?void 0:n.y)||0)+t.y,i=(n==null?void 0:n.width)||t.width,s=(n==null?void 0:n.height)||t.height;switch(e){case G.Top:return{x:r+i/2,y:o};case G.Right:return{x:r+i,y:o+s/2};case G.Bottom:return{x:r+i/2,y:o+s};case G.Left:return{x:r,y:o+s/2}}}function yo(e,t){return e?e.length===1||!t?e[0]:t&&e.find(n=>n.id===t)||null:null}const rf=(e,t,n,r,o,i)=>{const s=xo(n,e,t),a=xo(i,r,o);return{sourceX:s.x,sourceY:s.y,targetX:a.x,targetY:a.y}};function of({sourcePos:e,targetPos:t,sourceWidth:n,sourceHeight:r,targetWidth:o,targetHeight:i,width:s,height:a,transform:u}){const c={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+n,t.x+o),y2:Math.max(e.y+r,t.y+i)};c.x===c.x2&&(c.x2+=1),c.y===c.y2&&(c.y2+=1);const d=Yt({x:(0-u[0])/u[2],y:(0-u[1])/u[2],width:s/u[2],height:a/u[2]}),p=Math.max(0,Math.min(d.x2,c.x2)-Math.max(d.x,c.x)),g=Math.max(0,Math.min(d.y2,c.y2)-Math.max(d.y,c.y));return Math.ceil(p*g)>0}function mo(e){var r,o,i,s,a;const t=((r=e==null?void 0:e[ue])==null?void 0:r.handleBounds)||null,n=t&&(e==null?void 0:e.width)&&(e==null?void 0:e.height)&&typeof((o=e==null?void 0:e.positionAbsolute)==null?void 0:o.x)<"u"&&typeof((i=e==null?void 0:e.positionAbsolute)==null?void 0:i.y)<"u";return[{x:((s=e==null?void 0:e.positionAbsolute)==null?void 0:s.x)||0,y:((a=e==null?void 0:e.positionAbsolute)==null?void 0:a.y)||0,width:(e==null?void 0:e.width)||0,height:(e==null?void 0:e.height)||0},t,!!n]}const sf=[{level:0,isMaxLevel:!0,edges:[]}];function af(e,t,n=!1){let r=-1;const o=e.reduce((s,a)=>{var d,p;const u=we(a.zIndex);let c=u?a.zIndex:0;if(n){const g=t.get(a.target),x=t.get(a.source),m=a.selected||(g==null?void 0:g.selected)||(x==null?void 0:x.selected),y=Math.max(((d=x==null?void 0:x[ue])==null?void 0:d.z)||0,((p=g==null?void 0:g[ue])==null?void 0:p.z)||0,1e3);c=(u?a.zIndex:0)+(m?y:0)}return s[c]?s[c].push(a):s[c]=[a],r=c>r?c:r,s},{}),i=Object.entries(o).map(([s,a])=>{const u=+s;return{edges:a,level:u,isMaxLevel:u===r}});return i.length===0?sf:i}function lf(e,t,n){const r=ae(S.useCallback(o=>e?o.edges.filter(i=>{const s=t.get(i.source),a=t.get(i.target);return(s==null?void 0:s.width)&&(s==null?void 0:s.height)&&(a==null?void 0:a.width)&&(a==null?void 0:a.height)&&of({sourcePos:s.positionAbsolute||{x:0,y:0},targetPos:a.positionAbsolute||{x:0,y:0},sourceWidth:s.width,sourceHeight:s.height,targetWidth:a.width,targetHeight:a.height,width:o.width,height:o.height,transform:o.transform})}):o.edges,[e,t]));return af(r,t,n)}const cf=({color:e="none",strokeWidth:t=1})=>B.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),uf=({color:e="none",strokeWidth:t=1})=>B.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),bo={[jt.Arrow]:cf,[jt.ArrowClosed]:uf};function df(e){const t=de();return S.useMemo(()=>{var o,i;return Object.prototype.hasOwnProperty.call(bo,e)?bo[e]:((i=(o=t.getState()).onError)==null||i.call(o,"009",He.error009(e)),null)},[e])}const ff=({id:e,type:t,color:n,width:r=12.5,height:o=12.5,markerUnits:i="strokeWidth",strokeWidth:s,orient:a="auto-start-reverse"})=>{const u=df(t);return u?B.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${o}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:a,refX:"0",refY:"0"},B.createElement(u,{color:n,strokeWidth:s})):null},pf=({defaultColor:e,rfId:t})=>n=>{const r=[];return n.edges.reduce((o,i)=>([i.markerStart,i.markerEnd].forEach(s=>{if(s&&typeof s=="object"){const a=Qn(s,t);r.includes(a)||(o.push({id:a,color:s.color||e,...s}),r.push(a))}}),o),[]).sort((o,i)=>o.id.localeCompare(i.id))},Fs=({defaultColor:e,rfId:t})=>{const n=ae(S.useCallback(pf({defaultColor:e,rfId:t}),[e,t]),(r,o)=>!(r.length!==o.length||r.some((i,s)=>i.id!==o[s].id)));return B.createElement("defs",null,n.map(r=>B.createElement(ff,{id:r.id,key:r.id,type:r.type,color:r.color,width:r.width,height:r.height,markerUnits:r.markerUnits,strokeWidth:r.strokeWidth,orient:r.orient})))};Fs.displayName="MarkerDefinitions";var hf=S.memo(Fs);const gf=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),Vs=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:n,rfId:r,edgeTypes:o,noPanClassName:i,onEdgeContextMenu:s,onEdgeMouseEnter:a,onEdgeMouseMove:u,onEdgeMouseLeave:c,onEdgeClick:d,onEdgeDoubleClick:p,onReconnect:g,onReconnectStart:x,onReconnectEnd:m,reconnectRadius:y,children:k,disableKeyboardA11y:h})=>{const{edgesFocusable:b,edgesUpdatable:R,elementsSelectable:C,width:H,height:_,connectionMode:A,nodeInternals:$,onError:I}=ae(gf,fe),N=lf(t,$,n);return H?B.createElement(B.Fragment,null,N.map(({level:L,edges:P,isMaxLevel:w})=>B.createElement("svg",{key:L,style:{zIndex:L},width:H,height:_,className:"react-flow__edges react-flow__container"},w&&B.createElement(hf,{defaultColor:e,rfId:r}),B.createElement("g",null,P.map(f=>{const[T,j,D]=mo($.get(f.source)),[z,E,v]=mo($.get(f.target));if(!D||!v)return null;let M=f.type||"default";o[M]||(I==null||I("011",He.error011(M)),M="default");const O=o[M]||o.default,V=A===ct.Strict?E.target:(E.target??[]).concat(E.source??[]),W=yo(j.source,f.sourceHandle),X=yo(V,f.targetHandle),U=(W==null?void 0:W.position)||G.Bottom,J=(X==null?void 0:X.position)||G.Top,Q=!!(f.focusable||b&&typeof f.focusable>"u"),te=f.reconnectable||f.updatable,ee=typeof g<"u"&&(te||R&&typeof te>"u");if(!W||!X)return I==null||I("008",He.error008(W,f)),null;const{sourceX:oe,sourceY:se,targetX:re,targetY:le}=rf(T,W,U,z,X,J);return B.createElement(O,{key:f.id,id:f.id,className:he([f.className,i]),type:M,data:f.data,selected:!!f.selected,animated:!!f.animated,hidden:!!f.hidden,label:f.label,labelStyle:f.labelStyle,labelShowBg:f.labelShowBg,labelBgStyle:f.labelBgStyle,labelBgPadding:f.labelBgPadding,labelBgBorderRadius:f.labelBgBorderRadius,style:f.style,source:f.source,target:f.target,sourceHandleId:f.sourceHandle,targetHandleId:f.targetHandle,markerEnd:f.markerEnd,markerStart:f.markerStart,sourceX:oe,sourceY:se,targetX:re,targetY:le,sourcePosition:U,targetPosition:J,elementsSelectable:C,onContextMenu:s,onMouseEnter:a,onMouseMove:u,onMouseLeave:c,onClick:d,onEdgeDoubleClick:p,onReconnect:g,onReconnectStart:x,onReconnectEnd:m,reconnectRadius:y,rfId:r,ariaLabel:f.ariaLabel,isFocusable:Q,isReconnectable:ee,pathOptions:"pathOptions"in f?f.pathOptions:void 0,interactionWidth:f.interactionWidth,disableKeyboardA11y:h})})))),k):null};Vs.displayName="EdgeRenderer";var xf=S.memo(Vs);const yf=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function mf({children:e}){const t=ae(yf);return B.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}function bf(e){const t=Sr(),n=S.useRef(!1);S.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const vf={[G.Left]:G.Right,[G.Right]:G.Left,[G.Top]:G.Bottom,[G.Bottom]:G.Top},Ws=({nodeId:e,handleType:t,style:n,type:r=Ye.Bezier,CustomComponent:o,connectionStatus:i})=>{var _,A,$;const{fromNode:s,handleId:a,toX:u,toY:c,connectionMode:d}=ae(S.useCallback(I=>({fromNode:I.nodeInternals.get(e),handleId:I.connectionHandleId,toX:(I.connectionPosition.x-I.transform[0])/I.transform[2],toY:(I.connectionPosition.y-I.transform[1])/I.transform[2],connectionMode:I.connectionMode}),[e]),fe),p=(_=s==null?void 0:s[ue])==null?void 0:_.handleBounds;let g=p==null?void 0:p[t];if(d===ct.Loose&&(g=g||(p==null?void 0:p[t==="source"?"target":"source"])),!s||!g)return null;const x=a?g.find(I=>I.id===a):g[0],m=x?x.x+x.width/2:(s.width??0)/2,y=x?x.y+x.height/2:s.height??0,k=(((A=s.positionAbsolute)==null?void 0:A.x)??0)+m,h=((($=s.positionAbsolute)==null?void 0:$.y)??0)+y,b=x==null?void 0:x.position,R=b?vf[b]:null;if(!b||!R)return null;if(o)return B.createElement(o,{connectionLineType:r,connectionLineStyle:n,fromNode:s,fromHandle:x,fromX:k,fromY:h,toX:u,toY:c,fromPosition:b,toPosition:R,connectionStatus:i});let C="";const H={sourceX:k,sourceY:h,sourcePosition:b,targetX:u,targetY:c,targetPosition:R};return r===Ye.Bezier?[C]=fs(H):r===Ye.Step?[C]=mn({...H,borderRadius:0}):r===Ye.SmoothStep?[C]=mn(H):r===Ye.SimpleBezier?[C]=ds(H):C=`M${k},${h} ${u},${c}`,B.createElement("path",{d:C,fill:"none",className:"react-flow__connection-path",style:n})};Ws.displayName="ConnectionLine";const wf=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function Sf({containerStyle:e,style:t,type:n,component:r}){const{nodeId:o,handleType:i,nodesConnectable:s,width:a,height:u,connectionStatus:c}=ae(wf,fe);return!(o&&i&&a&&s)?null:B.createElement("svg",{style:e,width:a,height:u,className:"react-flow__edges react-flow__connectionline react-flow__container"},B.createElement("g",{className:he(["react-flow__connection",c])},B.createElement(Ws,{nodeId:o,handleType:i,style:t,type:n,CustomComponent:r,connectionStatus:c})))}function vo(e,t){return S.useRef(null),de(),S.useMemo(()=>t(e),[e])}const Ys=({nodeTypes:e,edgeTypes:t,onMove:n,onMoveStart:r,onMoveEnd:o,onInit:i,onNodeClick:s,onEdgeClick:a,onNodeDoubleClick:u,onEdgeDoubleClick:c,onNodeMouseEnter:d,onNodeMouseMove:p,onNodeMouseLeave:g,onNodeContextMenu:x,onSelectionContextMenu:m,onSelectionStart:y,onSelectionEnd:k,connectionLineType:h,connectionLineStyle:b,connectionLineComponent:R,connectionLineContainerStyle:C,selectionKeyCode:H,selectionOnDrag:_,selectionMode:A,multiSelectionKeyCode:$,panActivationKeyCode:I,zoomActivationKeyCode:N,deleteKeyCode:L,onlyRenderVisibleElements:P,elementsSelectable:w,selectNodesOnDrag:f,defaultViewport:T,translateExtent:j,minZoom:D,maxZoom:z,preventScrolling:E,defaultMarkerColor:v,zoomOnScroll:M,zoomOnPinch:O,panOnScroll:V,panOnScrollSpeed:W,panOnScrollMode:X,zoomOnDoubleClick:U,panOnDrag:J,onPaneClick:Q,onPaneMouseEnter:te,onPaneMouseMove:ee,onPaneMouseLeave:oe,onPaneScroll:se,onPaneContextMenu:re,onEdgeContextMenu:le,onEdgeMouseEnter:K,onEdgeMouseMove:q,onEdgeMouseLeave:Y,onReconnect:F,onReconnectStart:Z,onReconnectEnd:ie,reconnectRadius:ce,noDragClassName:me,noWheelClassName:ge,noPanClassName:Re,elevateEdgesOnSelect:ut,disableKeyboardA11y:qe,nodeOrigin:Ue,nodeExtent:dt,rfId:ft})=>{const Tt=vo(e,Gd),xe=vo(t,nf);return bf(i),B.createElement(qd,{onPaneClick:Q,onPaneMouseEnter:te,onPaneMouseMove:ee,onPaneMouseLeave:oe,onPaneContextMenu:re,onPaneScroll:se,deleteKeyCode:L,selectionKeyCode:H,selectionOnDrag:_,selectionMode:A,onSelectionStart:y,onSelectionEnd:k,multiSelectionKeyCode:$,panActivationKeyCode:I,zoomActivationKeyCode:N,elementsSelectable:w,onMove:n,onMoveStart:r,onMoveEnd:o,zoomOnScroll:M,zoomOnPinch:O,zoomOnDoubleClick:U,panOnScroll:V,panOnScrollSpeed:W,panOnScrollMode:X,panOnDrag:J,defaultViewport:T,translateExtent:j,minZoom:D,maxZoom:z,onSelectionContextMenu:m,preventScrolling:E,noDragClassName:me,noWheelClassName:ge,noPanClassName:Re,disableKeyboardA11y:qe},B.createElement(mf,null,B.createElement(xf,{edgeTypes:xe,onEdgeClick:a,onEdgeDoubleClick:c,onlyRenderVisibleElements:P,onEdgeContextMenu:le,onEdgeMouseEnter:K,onEdgeMouseMove:q,onEdgeMouseLeave:Y,onReconnect:F,onReconnectStart:Z,onReconnectEnd:ie,reconnectRadius:ce,defaultMarkerColor:v,noPanClassName:Re,elevateEdgesOnSelect:!!ut,disableKeyboardA11y:qe,rfId:ft},B.createElement(Sf,{style:b,type:h,component:R,containerStyle:C})),B.createElement("div",{className:"react-flow__edgelabel-renderer"}),B.createElement(Jd,{nodeTypes:Tt,onNodeClick:s,onNodeDoubleClick:u,onNodeMouseEnter:d,onNodeMouseMove:p,onNodeMouseLeave:g,onNodeContextMenu:x,selectNodesOnDrag:f,onlyRenderVisibleElements:P,noPanClassName:Re,noDragClassName:me,disableKeyboardA11y:qe,nodeOrigin:Ue,nodeExtent:dt,rfId:ft})))};Ys.displayName="GraphView";var _f=S.memo(Ys);const rr=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Fe={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:rr,nodeExtent:rr,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:ct.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:Ku,isValidConnection:void 0},Ef=()=>fa((e,t)=>({...Fe,setNodes:n=>{const{nodeInternals:r,nodeOrigin:o,elevateNodesOnSelect:i}=t();e({nodeInternals:On(n,r,o,i)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:n=>{const{defaultEdgeOptions:r={}}=t();e({edges:n.map(o=>({...r,...o}))})},setDefaultNodesAndEdges:(n,r)=>{const o=typeof n<"u",i=typeof r<"u",s=o?On(n,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:s,edges:i?r:[],hasDefaultNodes:o,hasDefaultEdges:i})},updateNodeDimensions:n=>{const{onNodesChange:r,nodeInternals:o,fitViewOnInit:i,fitViewOnInitDone:s,fitViewOnInitOptions:a,domNode:u,nodeOrigin:c}=t(),d=u==null?void 0:u.querySelector(".react-flow__viewport");if(!d)return;const p=window.getComputedStyle(d),{m22:g}=new window.DOMMatrixReadOnly(p.transform),x=n.reduce((y,k)=>{const h=o.get(k.id);if(h!=null&&h.hidden)o.set(h.id,{...h,[ue]:{...h[ue],handleBounds:void 0}});else if(h){const b=hr(k.nodeElement);!!(b.width&&b.height&&(h.width!==b.width||h.height!==b.height||k.forceUpdate))&&(o.set(h.id,{...h,[ue]:{...h[ue],handleBounds:{source:po(".source",k.nodeElement,g,c),target:po(".target",k.nodeElement,g,c)}},...b}),y.push({id:h.id,type:"dimensions",dimensions:b}))}return y},[]);$s(o,c);const m=s||i&&!s&&Ms(t,{initial:!0,...a});e({nodeInternals:new Map(o),fitViewOnInitDone:m}),(x==null?void 0:x.length)>0&&(r==null||r(x))},updateNodePositions:(n,r=!0,o=!1)=>{const{triggerNodeChanges:i}=t(),s=n.map(a=>{const u={id:a.id,type:"position",dragging:o};return r&&(u.positionAbsolute=a.positionAbsolute,u.position=a.position),u});i(s)},triggerNodeChanges:n=>{const{onNodesChange:r,nodeInternals:o,hasDefaultNodes:i,nodeOrigin:s,getNodes:a,elevateNodesOnSelect:u}=t();if(n!=null&&n.length){if(i){const c=As(n,a()),d=On(c,o,s,u);e({nodeInternals:d})}r==null||r(n)}},addSelectedNodes:n=>{const{multiSelectionActive:r,edges:o,getNodes:i}=t();let s,a=null;r?s=n.map(u=>We(u,!0)):(s=mt(i(),n),a=mt(o,[])),rn({changedNodes:s,changedEdges:a,get:t,set:e})},addSelectedEdges:n=>{const{multiSelectionActive:r,edges:o,getNodes:i}=t();let s,a=null;r?s=n.map(u=>We(u,!0)):(s=mt(o,n),a=mt(i(),[])),rn({changedNodes:a,changedEdges:s,get:t,set:e})},unselectNodesAndEdges:({nodes:n,edges:r}={})=>{const{edges:o,getNodes:i}=t(),s=n||i(),a=r||o,u=s.map(d=>(d.selected=!1,We(d.id,!1))),c=a.map(d=>We(d.id,!1));rn({changedNodes:u,changedEdges:c,get:t,set:e})},setMinZoom:n=>{const{d3Zoom:r,maxZoom:o}=t();r==null||r.scaleExtent([n,o]),e({minZoom:n})},setMaxZoom:n=>{const{d3Zoom:r,minZoom:o}=t();r==null||r.scaleExtent([o,n]),e({maxZoom:n})},setTranslateExtent:n=>{var r;(r=t().d3Zoom)==null||r.translateExtent(n),e({translateExtent:n})},resetSelectedElements:()=>{const{edges:n,getNodes:r}=t(),i=r().filter(a=>a.selected).map(a=>We(a.id,!1)),s=n.filter(a=>a.selected).map(a=>We(a.id,!1));rn({changedNodes:i,changedEdges:s,get:t,set:e})},setNodeExtent:n=>{const{nodeInternals:r}=t();r.forEach(o=>{o.positionAbsolute=gr(o.position,n)}),e({nodeExtent:n,nodeInternals:new Map(r)})},panBy:n=>{const{transform:r,width:o,height:i,d3Zoom:s,d3Selection:a,translateExtent:u}=t();if(!s||!a||!n.x&&!n.y)return!1;const c=Pe.translate(r[0]+n.x,r[1]+n.y).scale(r[2]),d=[[0,0],[o,i]],p=s==null?void 0:s.constrain()(c,d,u);return s.transform(a,p),r[0]!==p.x||r[1]!==p.y||r[2]!==p.k},cancelConnection:()=>e({connectionNodeId:Fe.connectionNodeId,connectionHandleId:Fe.connectionHandleId,connectionHandleType:Fe.connectionHandleType,connectionStatus:Fe.connectionStatus,connectionStartHandle:Fe.connectionStartHandle,connectionEndHandle:Fe.connectionEndHandle}),reset:()=>e({...Fe})}),Object.is),Er=({children:e})=>{const t=S.useRef(null);return t.current||(t.current=Ef()),B.createElement(Wu,{value:t.current},e)};Er.displayName="ReactFlowProvider";const Xs=({children:e})=>S.useContext(jn)?B.createElement(B.Fragment,null,e):B.createElement(Er,null,e);Xs.displayName="ReactFlowWrapper";const kf={input:Es,default:tr,output:js,group:wr},jf={default:bn,straight:mr,step:yr,smoothstep:Cn,simplebezier:xr},Cf=[0,0],Tf=[15,15],Nf={x:0,y:0,zoom:1},zf={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},qs=S.forwardRef(({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,className:o,nodeTypes:i=kf,edgeTypes:s=jf,onNodeClick:a,onEdgeClick:u,onInit:c,onMove:d,onMoveStart:p,onMoveEnd:g,onConnect:x,onConnectStart:m,onConnectEnd:y,onClickConnectStart:k,onClickConnectEnd:h,onNodeMouseEnter:b,onNodeMouseMove:R,onNodeMouseLeave:C,onNodeContextMenu:H,onNodeDoubleClick:_,onNodeDragStart:A,onNodeDrag:$,onNodeDragStop:I,onNodesDelete:N,onEdgesDelete:L,onSelectionChange:P,onSelectionDragStart:w,onSelectionDrag:f,onSelectionDragStop:T,onSelectionContextMenu:j,onSelectionStart:D,onSelectionEnd:z,connectionMode:E=ct.Strict,connectionLineType:v=Ye.Bezier,connectionLineStyle:M,connectionLineComponent:O,connectionLineContainerStyle:V,deleteKeyCode:W="Backspace",selectionKeyCode:X="Shift",selectionOnDrag:U=!1,selectionMode:J=Xt.Full,panActivationKeyCode:Q="Space",multiSelectionKeyCode:te=yn()?"Meta":"Control",zoomActivationKeyCode:ee=yn()?"Meta":"Control",snapToGrid:oe=!1,snapGrid:se=Tf,onlyRenderVisibleElements:re=!1,selectNodesOnDrag:le=!0,nodesDraggable:K,nodesConnectable:q,nodesFocusable:Y,nodeOrigin:F=Cf,edgesFocusable:Z,edgesUpdatable:ie,elementsSelectable:ce,defaultViewport:me=Nf,minZoom:ge=.5,maxZoom:Re=2,translateExtent:ut=rr,preventScrolling:qe=!0,nodeExtent:Ue,defaultMarkerColor:dt="#b1b1b7",zoomOnScroll:ft=!0,zoomOnPinch:Tt=!0,panOnScroll:xe=!1,panOnScrollSpeed:_e=.5,panOnScrollMode:Ge=rt.Free,zoomOnDoubleClick:Ze=!0,panOnDrag:Ke=!0,onPaneClick:Ae,onPaneMouseEnter:Ne,onPaneMouseMove:Nt,onPaneMouseLeave:Nn,onPaneScroll:zt,onPaneContextMenu:zn,children:Cr,onEdgeContextMenu:Je,onEdgeDoubleClick:ei,onEdgeMouseEnter:ti,onEdgeMouseMove:ni,onEdgeMouseLeave:ri,onEdgeUpdate:oi,onEdgeUpdateStart:si,onEdgeUpdateEnd:ii,onReconnect:ai,onReconnectStart:li,onReconnectEnd:ci,reconnectRadius:ui=10,edgeUpdaterRadius:di=10,onNodesChange:fi,onEdgesChange:pi,noDragClassName:hi="nodrag",noWheelClassName:gi="nowheel",noPanClassName:Tr="nopan",fitView:xi=!1,fitViewOptions:yi,connectOnClick:mi=!0,attributionPosition:bi,proOptions:vi,defaultEdgeOptions:wi,elevateNodesOnSelect:Si=!0,elevateEdgesOnSelect:_i=!1,disableKeyboardA11y:Nr=!1,autoPanOnConnect:Ei=!0,autoPanOnNodeDrag:ki=!0,connectionRadius:ji=20,isValidConnection:Ci,onError:Ti,style:Ni,id:zr,nodeDragThreshold:zi,...$i},Mi)=>{const $n=zr||"1";return B.createElement("div",{...$i,style:{...Ni,...zf},ref:Mi,className:he(["react-flow",o]),"data-testid":"rf__wrapper",id:zr},B.createElement(Xs,null,B.createElement(_f,{onInit:c,onMove:d,onMoveStart:p,onMoveEnd:g,onNodeClick:a,onEdgeClick:u,onNodeMouseEnter:b,onNodeMouseMove:R,onNodeMouseLeave:C,onNodeContextMenu:H,onNodeDoubleClick:_,nodeTypes:i,edgeTypes:s,connectionLineType:v,connectionLineStyle:M,connectionLineComponent:O,connectionLineContainerStyle:V,selectionKeyCode:X,selectionOnDrag:U,selectionMode:J,deleteKeyCode:W,multiSelectionKeyCode:te,panActivationKeyCode:Q,zoomActivationKeyCode:ee,onlyRenderVisibleElements:re,selectNodesOnDrag:le,defaultViewport:me,translateExtent:ut,minZoom:ge,maxZoom:Re,preventScrolling:qe,zoomOnScroll:ft,zoomOnPinch:Tt,zoomOnDoubleClick:Ze,panOnScroll:xe,panOnScrollSpeed:_e,panOnScrollMode:Ge,panOnDrag:Ke,onPaneClick:Ae,onPaneMouseEnter:Ne,onPaneMouseMove:Nt,onPaneMouseLeave:Nn,onPaneScroll:zt,onPaneContextMenu:zn,onSelectionContextMenu:j,onSelectionStart:D,onSelectionEnd:z,onEdgeContextMenu:Je,onEdgeDoubleClick:ei,onEdgeMouseEnter:ti,onEdgeMouseMove:ni,onEdgeMouseLeave:ri,onReconnect:ai??oi,onReconnectStart:li??si,onReconnectEnd:ci??ii,reconnectRadius:ui??di,defaultMarkerColor:dt,noDragClassName:hi,noWheelClassName:gi,noPanClassName:Tr,elevateEdgesOnSelect:_i,rfId:$n,disableKeyboardA11y:Nr,nodeOrigin:F,nodeExtent:Ue}),B.createElement(bd,{nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:x,onConnectStart:m,onConnectEnd:y,onClickConnectStart:k,onClickConnectEnd:h,nodesDraggable:K,nodesConnectable:q,nodesFocusable:Y,edgesFocusable:Z,edgesUpdatable:ie,elementsSelectable:ce,elevateNodesOnSelect:Si,minZoom:ge,maxZoom:Re,nodeExtent:Ue,onNodesChange:fi,onEdgesChange:pi,snapToGrid:oe,snapGrid:se,connectionMode:E,translateExtent:ut,connectOnClick:mi,defaultEdgeOptions:wi,fitView:xi,fitViewOptions:yi,onNodesDelete:N,onEdgesDelete:L,onNodeDragStart:A,onNodeDrag:$,onNodeDragStop:I,onSelectionDrag:f,onSelectionDragStart:w,onSelectionDragStop:T,noPanClassName:Tr,nodeOrigin:F,rfId:$n,autoPanOnConnect:Ei,autoPanOnNodeDrag:ki,onError:Ti,connectionRadius:ji,isValidConnection:Ci,nodeDragThreshold:zi}),B.createElement(yd,{onSelectionChange:P}),Cr,B.createElement(Xu,{proOptions:vi,position:bi}),B.createElement(Ed,{rfId:$n,disableKeyboardA11y:Nr})))});qs.displayName="ReactFlow";const $f=e=>{var t;return(t=e.domNode)==null?void 0:t.querySelector(".react-flow__edgelabel-renderer")};function Mf({children:e}){const t=ae($f);return t?Ai.createPortal(e,t):null}function Us(e){return t=>{const[n,r]=S.useState(t),o=S.useCallback(i=>r(s=>e(i,s)),[]);return[n,r,o]}}const Rf=Us(As),Af=Us(Od),Gs=({id:e,x:t,y:n,width:r,height:o,style:i,color:s,strokeColor:a,strokeWidth:u,className:c,borderRadius:d,shapeRendering:p,onClick:g,selected:x})=>{const{background:m,backgroundColor:y}=i||{},k=s||m||y;return B.createElement("rect",{className:he(["react-flow__minimap-node",{selected:x},c]),x:t,y:n,rx:d,ry:d,width:r,height:o,fill:k,stroke:a,strokeWidth:u,shapeRendering:p,onClick:g?h=>g(h,e):void 0})};Gs.displayName="MiniMapNode";var If=S.memo(Gs);const Df=e=>e.nodeOrigin,Pf=e=>e.getNodes().filter(t=>!t.hidden&&t.width&&t.height),Fn=e=>e instanceof Function?e:()=>e;function Of({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:o=2,nodeComponent:i=If,onClick:s}){const a=ae(Pf,fe),u=ae(Df),c=Fn(t),d=Fn(e),p=Fn(n),g=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return B.createElement(B.Fragment,null,a.map(x=>{const{x:m,y}=it(x,u).positionAbsolute;return B.createElement(i,{key:x.id,x:m,y,width:x.width,height:x.height,style:x.style,selected:x.selected,className:p(x),color:c(x),borderRadius:r,strokeColor:d(x),strokeWidth:o,shapeRendering:g,onClick:s,id:x.id})}))}var Bf=S.memo(Of);const Hf=200,Lf=150,Ff=e=>{const t=e.getNodes(),n={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:n,boundingRect:t.length>0?Gu(Tn(t,e.nodeOrigin),n):n,rfId:e.rfId}},Vf="react-flow__minimap-desc";function Zs({style:e,className:t,nodeStrokeColor:n="transparent",nodeColor:r="#e2e2e2",nodeClassName:o="",nodeBorderRadius:i=5,nodeStrokeWidth:s=2,nodeComponent:a,maskColor:u="rgb(240, 240, 240, 0.6)",maskStrokeColor:c="none",maskStrokeWidth:d=1,position:p="bottom-right",onClick:g,onNodeClick:x,pannable:m=!1,zoomable:y=!1,ariaLabel:k="React Flow mini map",inversePan:h=!1,zoomStep:b=10,offsetScale:R=5}){const C=de(),H=S.useRef(null),{boundingRect:_,viewBB:A,rfId:$}=ae(Ff,fe),I=(e==null?void 0:e.width)??Hf,N=(e==null?void 0:e.height)??Lf,L=_.width/I,P=_.height/N,w=Math.max(L,P),f=w*I,T=w*N,j=R*w,D=_.x-(f-_.width)/2-j,z=_.y-(T-_.height)/2-j,E=f+j*2,v=T+j*2,M=`${Vf}-${$}`,O=S.useRef(0);O.current=w,S.useEffect(()=>{if(H.current){const X=ve(H.current),U=te=>{const{transform:ee,d3Selection:oe,d3Zoom:se}=C.getState();if(te.sourceEvent.type!=="wheel"||!oe||!se)return;const re=-te.sourceEvent.deltaY*(te.sourceEvent.deltaMode===1?.05:te.sourceEvent.deltaMode?1:.002)*b,le=ee[2]*Math.pow(2,re);se.scaleTo(oe,le)},J=te=>{const{transform:ee,d3Selection:oe,d3Zoom:se,translateExtent:re,width:le,height:K}=C.getState();if(te.sourceEvent.type!=="mousemove"||!oe||!se)return;const q=O.current*Math.max(1,ee[2])*(h?-1:1),Y={x:ee[0]-te.sourceEvent.movementX*q,y:ee[1]-te.sourceEvent.movementY*q},F=[[0,0],[le,K]],Z=Pe.translate(Y.x,Y.y).scale(ee[2]),ie=se.constrain()(Z,F,re);se.transform(oe,ie)},Q=ts().on("zoom",m?J:null).on("zoom.wheel",y?U:null);return X.call(Q),()=>{X.on("zoom",null)}}},[m,y,h,b]);const V=g?X=>{const U=Ee(X);g(X,{x:U[0],y:U[1]})}:void 0,W=x?(X,U)=>{const J=C.getState().nodeInternals.get(U);x(X,J)}:void 0;return B.createElement(pr,{position:p,style:e,className:he(["react-flow__minimap",t]),"data-testid":"rf__minimap"},B.createElement("svg",{width:I,height:N,viewBox:`${D} ${z} ${E} ${v}`,role:"img","aria-labelledby":M,ref:H,onClick:V},k&&B.createElement("title",{id:M},k),B.createElement(Bf,{onClick:W,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:i,nodeClassName:o,nodeStrokeWidth:s,nodeComponent:a}),B.createElement("path",{className:"react-flow__minimap-mask",d:`M${D-j},${z-j}h${E+j*2}v${v+j*2}h${-E-j*2}z
        M${A.x},${A.y}h${A.width}v${A.height}h${-A.width}z`,fill:u,fillRule:"evenodd",stroke:c,strokeWidth:d,pointerEvents:"none"})))}Zs.displayName="MiniMap";var Wf=S.memo(Zs);function Yf(){return B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},B.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function Xf(){return B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},B.createElement("path",{d:"M0 0h32v4.2H0z"}))}function qf(){return B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},B.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function Uf(){return B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},B.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function Gf(){return B.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},B.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const Bt=({children:e,className:t,...n})=>B.createElement("button",{type:"button",className:he(["react-flow__controls-button",t]),...n},e);Bt.displayName="ControlButton";const Zf=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),Ks=({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:o,onZoomIn:i,onZoomOut:s,onFitView:a,onInteractiveChange:u,className:c,children:d,position:p="bottom-left"})=>{const g=de(),[x,m]=S.useState(!1),{isInteractive:y,minZoomReached:k,maxZoomReached:h}=ae(Zf,fe),{zoomIn:b,zoomOut:R,fitView:C}=Sr();if(S.useEffect(()=>{m(!0)},[]),!x)return null;const H=()=>{b(),i==null||i()},_=()=>{R(),s==null||s()},A=()=>{C(o),a==null||a()},$=()=>{g.setState({nodesDraggable:!y,nodesConnectable:!y,elementsSelectable:!y}),u==null||u(!y)};return B.createElement(pr,{className:he(["react-flow__controls",c]),position:p,style:e,"data-testid":"rf__controls"},t&&B.createElement(B.Fragment,null,B.createElement(Bt,{onClick:H,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:h},B.createElement(Yf,null)),B.createElement(Bt,{onClick:_,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:k},B.createElement(Xf,null))),n&&B.createElement(Bt,{className:"react-flow__controls-fitview",onClick:A,title:"fit view","aria-label":"fit view"},B.createElement(qf,null)),r&&B.createElement(Bt,{className:"react-flow__controls-interactive",onClick:$,title:"toggle interactivity","aria-label":"toggle interactivity"},y?B.createElement(Gf,null):B.createElement(Uf,null)),d)};Ks.displayName="Controls";var Kf=S.memo(Ks),Ce;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Ce||(Ce={}));function Jf({color:e,dimensions:t,lineWidth:n}){return B.createElement("path",{stroke:e,strokeWidth:n,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function Qf({color:e,radius:t}){return B.createElement("circle",{cx:t,cy:t,r:t,fill:e})}const ep={[Ce.Dots]:"#91919a",[Ce.Lines]:"#eee",[Ce.Cross]:"#e2e2e2"},tp={[Ce.Dots]:1,[Ce.Lines]:1,[Ce.Cross]:6},np=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function Js({id:e,variant:t=Ce.Dots,gap:n=20,size:r,lineWidth:o=1,offset:i=2,color:s,style:a,className:u}){const c=S.useRef(null),{transform:d,patternId:p}=ae(np,fe),g=s||ep[t],x=r||tp[t],m=t===Ce.Dots,y=t===Ce.Cross,k=Array.isArray(n)?n:[n,n],h=[k[0]*d[2]||1,k[1]*d[2]||1],b=x*d[2],R=y?[b,b]:h,C=m?[b/i,b/i]:[R[0]/i,R[1]/i];return B.createElement("svg",{className:he(["react-flow__background",u]),style:{...a,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:c,"data-testid":"rf__background"},B.createElement("pattern",{id:p+e,x:d[0]%h[0],y:d[1]%h[1],width:h[0],height:h[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${C[0]},-${C[1]})`},m?B.createElement(Qf,{color:g,radius:b/i}):B.createElement(Jf,{dimensions:R,color:g,lineWidth:o})),B.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${p+e})`}))}Js.displayName="Background";var rp=S.memo(Js);const op=({data:e,selected:t})=>{var m;const{blockDef:n,properties:r={},propertyLabels:o={},outputLabels:i=[],enabledOutputs:s=null}=e,u=(()=>{const y=n.outputs.mode==="dynamic",k=n.outputs.labels||[];return y?(i.length>0?i:k).map((b,R)=>({label:b,index:R,originalIndex:R})):s&&s.length>0?s.map(h=>({label:k[h]||`Output ${h}`,index:h,originalIndex:h})).sort((h,b)=>h.index-b.index):k.map((h,b)=>({label:h,index:b,originalIndex:b}))})(),c=n.outputs.max>0||n.outputs.max===-1,d=((m=n.outputs.labels)==null?void 0:m.length)||0,p=s&&s.length<d&&n.outputs.mode!=="dynamic",x=(()=>{var k;const y=Object.entries(r);if(y.length===0)return null;for(const[h,b]of y){if(h.startsWith("_")||!b&&b!==0&&b!==!1)continue;const R=o[h]||String(b),C=(k=n.properties)==null?void 0:k.find(_=>_.key===h);return C!=null&&C.label,R.length>25?R.substring(0,25)+"...":R}return null})();return l.jsxs("div",{style:{background:"#fff",border:t?`2px solid ${n.color}`:"1px solid #e0e0e0",borderRadius:"8px",minWidth:"240px",maxWidth:"300px",boxShadow:t?`0 4px 12px ${n.color}20, 0 0 0 4px ${n.color}10`:"0 1px 3px rgba(0,0,0,0.1)",transition:"all 0.2s ease",overflow:"visible",position:"relative"},children:[n.inputs.max>0&&l.jsx(at,{type:"target",position:G.Left,id:"input-0",style:{top:"30px",background:"#fff",width:"12px",height:"12px",border:`2px solid ${n.color}`,left:"-6px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"}}),l.jsx("div",{style:{padding:"12px 16px",borderBottom:c&&u.length>0?"1px solid #e5e7eb":"none",background:"#fff"},children:l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[l.jsx("div",{style:{fontSize:"18px",flexShrink:0,width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center",background:`${n.color}15`,borderRadius:"6px"},children:n.icon}),l.jsxs("div",{style:{flex:1,minWidth:0},children:[l.jsx("div",{style:{fontWeight:"600",fontSize:"14px",color:"#1a1a1a",lineHeight:"1.3"},children:n.name}),x&&l.jsx("div",{style:{fontSize:"11px",color:"#9ca3af",lineHeight:"1.3",marginTop:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:x})]}),p&&l.jsxs("div",{style:{fontSize:"9px",background:"#fef3c7",color:"#92400e",padding:"2px 6px",borderRadius:"4px",fontWeight:"600"},children:[u.length,"/",d]})]})}),c&&u.length>0?l.jsx("div",{style:{position:"relative"},children:u.map((y,k)=>{const h=`output-${y.originalIndex}`;return l.jsxs("div",{style:{position:"relative",padding:"10px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:k<u.length-1?"1px solid #f3f4f6":"none",background:"transparent",transition:"background 0.15s ease",minHeight:"40px"},onMouseEnter:b=>{b.currentTarget.style.background="#f9fafb"},onMouseLeave:b=>{b.currentTarget.style.background="transparent"},children:[l.jsxs("div",{style:{fontSize:"13px",color:"#374151",fontWeight:"500",flex:1,paddingRight:"30px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"6px"},children:[n.outputs.mode!=="dynamic"&&d>5&&l.jsx("span",{style:{fontSize:"10px",background:"#f3f4f6",color:"#6b7280",padding:"1px 5px",borderRadius:"3px",fontWeight:"600"},children:y.originalIndex}),y.label]}),l.jsx("div",{style:{fontSize:"12px",color:"#9ca3af",position:"absolute",right:"20px",pointerEvents:"none"},children:""}),l.jsx(at,{type:"source",position:G.Right,id:h,style:{position:"absolute",top:"50%",transform:"translateY(-50%)",background:"#fff",width:"12px",height:"12px",border:`2px solid ${n.color}`,right:"-6px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"}})]},h)})}):c?l.jsx(at,{type:"source",position:G.Right,id:"output-0",style:{top:"30px",background:"#fff",width:"12px",height:"12px",border:`2px solid ${n.color}`,right:"-6px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"}}):null]})},sp=Le("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),wo=Le("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),ip=Le("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),kr=Le("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),ot=Le("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),un=Le("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),ap=Le("Variable",[["path",{d:"M8 21s-4-3-4-9 4-9 4-9",key:"uto9ud"}],["path",{d:"M16 3s4 3 4 9-4 9-4 9",key:"4w2vsq"}],["line",{x1:"15",x2:"9",y1:"9",y2:"15",key:"f7djnv"}],["line",{x1:"9",x2:"15",y1:"9",y2:"15",key:"1shsy8"}]]),lp=Le("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),cp=Le("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),up=({id:e,sourceX:t,sourceY:n,targetX:r,targetY:o,sourcePosition:i,targetPosition:s,style:a={},markerEnd:u,selected:c,data:d})=>{const[p,g,x]=mn({sourceX:t,sourceY:n,sourcePosition:i,targetX:r,targetY:o,targetPosition:s,borderRadius:8}),m=(y,k)=>{y.stopPropagation(),window.dispatchEvent(new CustomEvent("deleteEdge",{detail:{edgeId:k}}))};return l.jsxs(l.Fragment,{children:[l.jsx(Ct,{path:p,markerEnd:u,style:{...a,strokeWidth:c?3:2,stroke:c?"#3b82f6":"#94a3b8",strokeDasharray:"5,5",animation:"dashdraw 0.5s linear infinite"}}),l.jsx(Mf,{children:l.jsx("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${g}px,${x}px)`,fontSize:12,pointerEvents:"all"},className:"nodrag nopan",children:l.jsx("button",{onClick:y=>m(y,e),style:{width:"20px",height:"20px",background:c?"#ef4444":"#fff",border:`1px solid ${c?"#ef4444":"#d1d5db"}`,borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,opacity:c?1:0,transition:"opacity 0.2s, background 0.2s",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},onMouseEnter:y=>{y.currentTarget.style.opacity="1",y.currentTarget.style.background="#ef4444",y.currentTarget.style.borderColor="#ef4444"},onMouseLeave:y=>{c||(y.currentTarget.style.opacity="0",y.currentTarget.style.background="#fff",y.currentTarget.style.borderColor="#d1d5db")},title:"Delete connection",children:l.jsx(tt,{size:12,color:c?"#fff":"#ef4444"})})})})]})},dp=({blockTypes:e})=>{const[t,n]=S.useState(""),[r,o]=S.useState({}),i=(m,y)=>{m.dataTransfer.setData("application/reactflow",y),m.dataTransfer.effectAllowed="move"},s=S.useMemo(()=>{const m={};return Object.values(e).forEach(y=>{m[y.category]||(m[y.category]=[]),m[y.category].push(y)}),m},[e]),a=S.useMemo(()=>{if(!t.trim())return s;const m=t.toLowerCase(),y={};return Object.entries(s).forEach(([k,h])=>{const b=h.filter(R=>R.name.toLowerCase().includes(m)||R.id.toLowerCase().includes(m)||k.toLowerCase().includes(m));b.length>0&&(y[k]=b)}),y},[s,t]),u=m=>{o(y=>({...y,[m]:!y[m]}))},c=t.trim().length>0,d={intelliflow_globals:"IntelliFlow Globals",call_control:"Call Control",playback:"Playback",functions:"Functions",applications:"Applications",chat_management:"Chat Management",whatsapp_management:"WhatsApp Management",ecommerce:"eCommerce",cx9_apps:"CX9 Apps"},p=m=>d[m]||m.replace(/_/g," ").replace(/\b\w/g,y=>y.toUpperCase()),g=Object.values(e).length,x=Object.values(a).flat().length;return l.jsxs("div",{style:{width:"280px",background:"#fff",borderRight:"1px solid #e5e7eb",display:"flex",flexDirection:"column",height:"100vh"},children:[l.jsxs("div",{style:{padding:"20px 16px 16px",borderBottom:"1px solid #e5e7eb",flexShrink:0},children:[l.jsxs("h3",{style:{margin:"0 0 16px 0",fontSize:"16px",fontWeight:"700",color:"#1a1a1a",letterSpacing:"-0.01em",display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Blocks",l.jsx("span",{style:{fontSize:"12px",fontWeight:"500",color:"#6b7280",background:"#f3f4f6",padding:"2px 8px",borderRadius:"10px"},children:g})]}),l.jsxs("div",{style:{position:"relative"},children:[l.jsx(un,{size:16,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#9ca3af",pointerEvents:"none"}}),l.jsx("input",{type:"text",value:t,onChange:m=>n(m.target.value),placeholder:"Search blocks...",style:{width:"100%",padding:"10px 36px 10px 38px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"13px",outline:"none",transition:"border-color 0.2s, box-shadow 0.2s"},onFocus:m=>{m.target.style.borderColor="#3b82f6",m.target.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"},onBlur:m=>{m.target.style.borderColor="#e5e7eb",m.target.style.boxShadow="none"}}),t&&l.jsx("button",{onClick:()=>n(""),style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:"2px",display:"flex",alignItems:"center",justifyContent:"center",color:"#9ca3af"},children:l.jsx(tt,{size:14})})]}),c&&l.jsxs("div",{style:{marginTop:"10px",fontSize:"12px",color:"#6b7280"},children:["Found ",l.jsx("strong",{style:{color:"#1a1a1a"},children:x})," blocks",x!==g&&` matching "${t}"`]})]}),l.jsx("div",{style:{flex:1,overflowY:"auto",padding:"16px"},children:Object.keys(a).length===0?l.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#6b7280"},children:[l.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:""}),l.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"4px"},children:"No blocks found"}),l.jsx("div",{style:{fontSize:"12px"},children:"Try a different search term"})]}):Object.entries(a).map(([m,y])=>{const k=!c&&r[m];return l.jsxs("div",{style:{marginBottom:"8px"},children:[l.jsxs("button",{onClick:()=>u(m),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",background:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:k?"8px":"8px 8px 0 0",cursor:"pointer",transition:"all 0.2s ease"},onMouseOver:h=>{h.currentTarget.style.background="#f3f4f6"},onMouseOut:h=>{h.currentTarget.style.background="#f9fafb"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[k?l.jsx(Ii,{size:16,style:{color:"#6b7280"}}):l.jsx(Dt,{size:16,style:{color:"#6b7280"}}),l.jsx("span",{style:{fontSize:"12px",fontWeight:"600",textTransform:"uppercase",color:"#374151",letterSpacing:"0.03em"},children:p(m)})]}),l.jsx("span",{style:{fontSize:"11px",fontWeight:"500",color:"#6b7280",background:"#e5e7eb",padding:"2px 8px",borderRadius:"10px"},children:y.length})]}),!k&&l.jsx("div",{style:{border:"1px solid #e5e7eb",borderTop:"none",borderRadius:"0 0 8px 8px",padding:"8px",background:"#fff"},children:y.map(h=>l.jsxs("div",{draggable:!0,onDragStart:b=>i(b,h.id),style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:"6px",padding:"8px 10px",marginBottom:"6px",cursor:"grab",display:"flex",alignItems:"center",gap:"10px",transition:"all 0.15s ease"},onMouseOver:b=>{b.currentTarget.style.borderColor=h.color,b.currentTarget.style.background=`${h.color}08`,b.currentTarget.style.transform="translateX(2px)"},onMouseOut:b=>{b.currentTarget.style.borderColor="#e5e7eb",b.currentTarget.style.background="#fff",b.currentTarget.style.transform="translateX(0)"},children:[l.jsx("div",{style:{fontSize:"16px",width:"26px",height:"26px",display:"flex",alignItems:"center",justifyContent:"center",background:`${h.color}15`,borderRadius:"5px",flexShrink:0},children:h.icon}),l.jsxs("div",{style:{flex:1,minWidth:0},children:[l.jsx("div",{style:{fontWeight:"500",fontSize:"12px",color:"#1a1a1a",lineHeight:"1.3"},children:h.name}),l.jsxs("div",{style:{fontSize:"10px",color:"#9ca3af",lineHeight:"1.3"},children:[h.inputs.max>0&&l.jsxs("span",{children:[h.inputs.max===-1?"":h.inputs.max," in"]}),h.inputs.max>0&&h.outputs.max>0&&l.jsx("span",{children:"  "}),h.outputs.max>0&&l.jsxs("span",{children:[h.outputs.max===-1?"":h.outputs.max," out"]})]})]})]},h.id))})]},m)})}),l.jsx("div",{style:{padding:"12px 16px",borderTop:"1px solid #e5e7eb",flexShrink:0},children:l.jsxs("div",{style:{padding:"10px 12px",background:"#eff6ff",borderRadius:"8px",fontSize:"11px",color:"#1e40af",lineHeight:"1.5",border:"1px solid #dbeafe"},children:[l.jsx("span",{style:{fontWeight:"600"},children:" Tip:"})," Drag blocks onto the canvas"]})})]})},fp="http://localhost:3001",pp=(e,t={})=>{if(!e||!t||Object.keys(t).length===0)return e;let n=e;Object.entries(t).forEach(([o,i])=>{const s=new RegExp(`\\{\\{${o}\\}\\}`,"g"),a=String(i).replace(/'/g,"''");n=n.replace(s,a)});const r=n.match(/\{\{[\w.]+\}\}/g);return r&&console.warn("Unreplaced query placeholders:",r),n},Qs=async(e,t,n,r=null,o={})=>{try{const i=pp(e,o),s=await fetch(`${fp}/api/select-options`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:i,valueField:t,labelField:n,previewField:r})}),a=await s.json();if(!s.ok||!a.success)throw new Error(a.error||"Failed to fetch options");return a.options}catch(i){throw console.error("fetchSelectOptions error:",i),i}},hp=async(e,t={})=>{try{return await Promise.all(e.map(async r=>{try{const o=await Qs(r.query,r.valueField,r.labelField,r.previewField||null,t);return{label:r.label,options:o}}catch(o){return console.error(`Failed to fetch group "${r.label}":`,o),{label:r.label,options:[],error:o.message}}}))}catch(n){throw console.error("fetchGroupedSelectOptions error:",n),n}},Oe="http://localhost:3001",jr=({isOpen:e,onClose:t,title:n,children:r,icon:o})=>e?l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:l.jsxs("div",{style:{background:"#fff",borderRadius:"12px",width:"90%",maxWidth:"500px",maxHeight:"90vh",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[l.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between",background:"#f8fafc"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[o&&l.jsx(o,{size:20,color:"#3b82f6"}),l.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600"},children:n})]}),l.jsx("button",{onClick:t,style:{background:"transparent",border:"none",padding:"4px",cursor:"pointer",borderRadius:"4px"},children:l.jsx(tt,{size:20,color:"#6b7280"})})]}),l.jsx("div",{style:{padding:"20px",overflowY:"auto",maxHeight:"calc(90vh - 120px)"},children:r})]})}):null,ze={width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"},ke={...ze,cursor:"pointer",background:"#fff"},pe={display:"block",fontSize:"13px",fontWeight:"500",color:"#374151",marginBottom:"6px"},Se={padding:"10px 20px",borderRadius:"6px",fontSize:"14px",fontWeight:"500",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"6px"},gp=({value:e,onChange:t,onLabelChange:n,flowContext:r={},prop:o})=>{const[i,s]=S.useState(!1),[a,u]=S.useState([]),[c,d]=S.useState(!1),[p,g]=S.useState(!1),[x,m]=S.useState(null),[y,k]=S.useState(null),[h,b]=S.useState({db_type:"mysql",name:"",host:"localhost",port:"3306",username:"",password:""}),R=[{value:"mysql",label:"MySQL"},{value:"sql",label:"SQL Server"},{value:"mongo",label:"MongoDB"}],C=async()=>{if(r.intelliflowId){d(!0);try{const L=await(await fetch(`${Oe}/api/query-raw`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`SELECT id, name, db_type, host, port, username, password FROM yovo_tbl_ivr_databases WHERE ivr_id = ${r.intelliflowId}`})})).json();L.success&&u(L.rows||[])}catch(N){console.error("Failed to fetch databases:",N)}finally{d(!1)}}};S.useEffect(()=>{C()},[r.intelliflowId]);const H=()=>{b({db_type:"mysql",name:"",host:"localhost",port:"3306",username:"",password:""}),k(null),m(null)},_=async()=>{if(!h.name||!h.username){m("Database name and username are required");return}g(!0),m(null);try{const N=y?"/api/update-record":"/api/create-record",L={db_type:h.db_type,name:h.name,host:h.host,port:h.port,username:h.username,password:h.password},P=y?{table:"yovo_tbl_ivr_databases",data:L,where:{id:y}}:{table:"yovo_tbl_ivr_databases",data:{...L,ivr_id:r.intelliflowId||0}},f=await(await fetch(`${Oe}${N}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)})).json();f.success?(!y&&f.insertId&&(t(String(f.insertId)),n&&n(`${h.name} (${h.db_type})`)),s(!1),H(),C()):m(f.error||"Failed to save database")}catch(N){m("Failed to save database: "+N.message)}finally{g(!1)}},A=N=>{k(N.id),b({db_type:N.db_type||"mysql",name:N.name||"",host:N.host||"localhost",port:N.port||"3306",username:N.username||"",password:N.password||""}),m(null),s(!0)},$=async(N,L)=>{if(confirm(`Are you sure you want to delete "${L}"?`))try{(await(await fetch(`${Oe}/api/delete-record`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:"yovo_tbl_ivr_databases",where:{id:N}})})).json()).success&&(C(),String(e)===String(N)&&(t(""),n&&n("")))}catch(P){console.error("Failed to delete:",P)}},I=N=>{var L;return`${N.name} (${((L=R.find(P=>P.value===N.db_type))==null?void 0:L.label)||N.db_type})`};return l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[l.jsxs("select",{value:e||"",onChange:N=>{const L=a.find(P=>String(P.id)===N.target.value);t(N.target.value),n&&n(L?I(L):N.target.value)},style:{...ke,flex:1},children:[l.jsx("option",{value:"",children:"-- Select Database --"}),a.map(N=>l.jsx("option",{value:N.id,children:I(N)},N.id))]}),l.jsx("button",{onClick:()=>C(),style:{...Se,padding:"8px",background:"#f3f4f6",border:"1px solid #e5e7eb"},title:"Refresh",children:l.jsx(ot,{size:16})})]}),a.length>0&&l.jsx("div",{style:{marginBottom:"12px",maxHeight:"150px",overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:"6px"},children:a.map(N=>{var L;return l.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",borderBottom:"1px solid #f3f4f6",fontSize:"13px",background:String(e)===String(N.id)?"#eff6ff":"transparent"},children:[l.jsxs("div",{style:{flex:1,cursor:"pointer"},onClick:()=>{t(String(N.id)),n&&n(I(N))},children:[l.jsx("span",{style:{fontWeight:"500"},children:N.name}),l.jsxs("span",{style:{color:"#6b7280",marginLeft:"8px",fontSize:"11px"},children:["(",((L=R.find(P=>P.value===N.db_type))==null?void 0:L.label)||N.db_type,")"]}),l.jsxs("div",{style:{color:"#9ca3af",fontSize:"11px"},children:[N.host,":",N.port]})]}),l.jsxs("div",{style:{display:"flex",gap:"4px"},children:[l.jsx("button",{onClick:P=>{P.stopPropagation(),A(N)},style:{background:"transparent",border:"none",cursor:"pointer",padding:"4px"},title:"Edit",children:l.jsx(kr,{size:14,color:"#6b7280"})}),l.jsx("button",{onClick:P=>{P.stopPropagation(),$(N.id,N.name)},style:{background:"transparent",border:"none",cursor:"pointer",padding:"4px"},title:"Delete",children:l.jsx(vn,{size:14,color:"#ef4444"})})]})]},N.id)})}),l.jsxs("button",{onClick:()=>{H(),s(!0)},style:{...Se,background:"#3b82f6",color:"#fff",border:"none",width:"100%",justifyContent:"center"},children:[l.jsx(or,{size:16})," Create New Database Connection"]}),l.jsxs(jr,{isOpen:i,onClose:()=>{s(!1),H()},title:y?"Edit Database Connection":"Create Database Connection",icon:Di,children:[x&&l.jsx("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"6px",padding:"10px",marginBottom:"16px",color:"#dc2626",fontSize:"13px"},children:x}),l.jsxs("div",{style:{display:"grid",gap:"16px"},children:[l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Database Type"}),l.jsx("select",{value:h.db_type,onChange:N=>b({...h,db_type:N.target.value}),style:ke,children:R.map(N=>l.jsx("option",{value:N.value,children:N.label},N.value))})]}),l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Database Name *"}),l.jsx("input",{type:"text",value:h.name,onChange:N=>b({...h,name:N.target.value}),placeholder:"e.g., my_database",style:ze})]}),l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"12px"},children:[l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Host"}),l.jsx("input",{type:"text",value:h.host,onChange:N=>b({...h,host:N.target.value}),placeholder:"localhost",style:ze})]}),l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Port"}),l.jsx("input",{type:"text",value:h.port,onChange:N=>b({...h,port:N.target.value}),placeholder:"3306",style:ze})]})]}),l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Username *"}),l.jsx("input",{type:"text",value:h.username,onChange:N=>b({...h,username:N.target.value}),placeholder:"db_user",style:ze})]}),l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Password"}),l.jsx("input",{type:"password",value:h.password,onChange:N=>b({...h,password:N.target.value}),placeholder:"",style:ze})]})]}),l.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",justifyContent:"flex-end"},children:[l.jsx("button",{onClick:()=>{s(!1),H()},style:{...Se,background:"#f3f4f6",border:"1px solid #e5e7eb",color:"#374151"},children:"Cancel"}),l.jsxs("button",{onClick:_,disabled:p,style:{...Se,background:"#3b82f6",color:"#fff",border:"none",opacity:p?.7:1},children:[p?l.jsx(sr,{size:16}):l.jsx(ir,{size:16}),p?"Saving...":y?"Update":"Create"]})]})]})]})},xp=({value:e,onChange:t,onLabelChange:n,flowContext:r={},prop:o})=>{const[i,s]=S.useState(!1),[a,u]=S.useState([]),[c,d]=S.useState(!1),[p,g]=S.useState(!1),[x,m]=S.useState(null),[y,k]=S.useState(null),[h,b]=S.useState({name:"",variable_type:"global"}),R=[{value:"global",label:"Global Variable"},{value:"channel",label:"Channel Variable"},{value:"agent_cti",label:"CTI Variable"},{value:"agent_cti_arr",label:"CTI Array (in-memory)"},{value:"agent_cti_json",label:"CTI Json"}],C=async()=>{if(r.intelliflowId){d(!0);try{const I=await(await fetch(`${Oe}/api/query-raw`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`SELECT id, name, variable_type FROM yovo_tbl_ivr_variables WHERE ivr_id = ${r.intelliflowId}`})})).json();I.success&&u(I.rows||[])}catch($){console.error("Failed to fetch variables:",$)}finally{d(!1)}}};S.useEffect(()=>{C()},[r.intelliflowId]);const H=async()=>{if(!h.name){m("Variable name is required");return}g(!0),m(null);try{const $=y?"/api/update-record":"/api/create-record",I=y?{table:"yovo_tbl_ivr_variables",data:{name:h.name,variable_type:h.variable_type},where:{id:y}}:{table:"yovo_tbl_ivr_variables",data:{ivr_id:r.intelliflowId||0,name:h.name,variable_type:h.variable_type}},L=await(await fetch(`${Oe}${$}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)})).json();L.success?(!y&&L.insertId&&(t(h.name),n&&n(h.name)),s(!1),k(null),b({name:"",variable_type:"global"}),C()):m(L.error||"Failed to save variable")}catch($){m("Failed to save variable: "+$.message)}finally{g(!1)}},_=$=>{k($.id),b({name:$.name,variable_type:$.variable_type||"global"}),s(!0)},A=async($,I)=>{if(confirm("Are you sure you want to delete this variable?"))try{(await(await fetch(`${Oe}/api/delete-record`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:"yovo_tbl_ivr_variables",where:{id:$}})})).json()).success&&(C(),e===I&&(t(""),n&&n("")))}catch(N){console.error("Failed to delete:",N)}};return l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[l.jsxs("select",{value:e||"",onChange:$=>{const I=a.find(N=>N.name===$.target.value);t($.target.value),n&&n((I==null?void 0:I.name)||$.target.value)},style:{...ke,flex:1},children:[l.jsx("option",{value:"",children:"-- Select Variable --"}),a.map($=>{var I;return l.jsxs("option",{value:$.name,children:[$.name," (",((I=R.find(N=>N.value===$.variable_type))==null?void 0:I.label)||$.variable_type,")"]},$.id)})]}),l.jsx("button",{onClick:()=>C(),style:{...Se,padding:"8px",background:"#f3f4f6",border:"1px solid #e5e7eb"},title:"Refresh",children:l.jsx(ot,{size:16})})]}),a.length>0&&l.jsx("div",{style:{marginBottom:"12px",maxHeight:"150px",overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:"6px"},children:a.map($=>{var I;return l.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",borderBottom:"1px solid #f3f4f6",fontSize:"13px",background:$.name===e?"#eff6ff":"transparent"},children:[l.jsxs("div",{style:{flex:1,cursor:"pointer"},onClick:()=>{t($.name),n&&n($.name)},children:[l.jsx("span",{style:{fontWeight:"500"},children:$.name}),l.jsxs("span",{style:{color:"#6b7280",marginLeft:"8px",fontSize:"11px"},children:["(",((I=R.find(N=>N.value===$.variable_type))==null?void 0:I.label)||$.variable_type||"global",")"]})]}),l.jsxs("div",{style:{display:"flex",gap:"4px"},children:[l.jsx("button",{onClick:N=>{N.stopPropagation(),_($)},style:{background:"transparent",border:"none",cursor:"pointer",padding:"4px"},title:"Edit",children:l.jsx(kr,{size:14,color:"#6b7280"})}),l.jsx("button",{onClick:N=>{N.stopPropagation(),A($.id,$.name)},style:{background:"transparent",border:"none",cursor:"pointer",padding:"4px"},title:"Delete",children:l.jsx(vn,{size:14,color:"#ef4444"})})]})]},$.id)})}),l.jsxs("button",{onClick:()=>{k(null),b({name:"",variable_type:"global"}),s(!0)},style:{...Se,background:"#10b981",color:"#fff",border:"none",width:"100%",justifyContent:"center"},children:[l.jsx(or,{size:16})," Create New Variable"]}),l.jsxs(jr,{isOpen:i,onClose:()=>{s(!1),k(null),m(null)},title:y?"Edit Variable":"Create Variable",icon:ap,children:[x&&l.jsx("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"6px",padding:"10px",marginBottom:"16px",color:"#dc2626",fontSize:"13px"},children:x}),l.jsxs("div",{style:{display:"grid",gap:"16px"},children:[l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Variable Name *"}),l.jsx("input",{type:"text",value:h.name,onChange:$=>b({...h,name:$.target.value}),placeholder:"e.g., customer_id",style:ze})]}),l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Variable Type"}),l.jsx("select",{value:h.variable_type,onChange:$=>b({...h,variable_type:$.target.value}),style:ke,children:R.map($=>l.jsx("option",{value:$.value,children:$.label},$.value))})]})]}),l.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",justifyContent:"flex-end"},children:[l.jsx("button",{onClick:()=>{s(!1),k(null),m(null)},style:{...Se,background:"#f3f4f6",border:"1px solid #e5e7eb",color:"#374151"},children:"Cancel"}),l.jsxs("button",{onClick:H,disabled:p,style:{...Se,background:"#10b981",color:"#fff",border:"none",opacity:p?.7:1},children:[p?l.jsx(sr,{size:16}):l.jsx(ir,{size:16}),p?"Saving...":y?"Update":"Create"]})]})]})]})},yp=({value:e,onChange:t,onLabelChange:n,flowContext:r={},prop:o,isMulti:i=!1})=>{const[s,a]=S.useState(!1),[u,c]=S.useState([]),[d,p]=S.useState(!1),[g,x]=S.useState(!1),[m,y]=S.useState(null),[k,h]=S.useState(null),[b,R]=S.useState({name:"",time_start:"00:00:00",time_end:"23:59:59",weekday_start:"mon",weekday_end:"sun",monthday_start:"1",monthday_end:"31",month_start:"jan",month_end:"dec"}),C=[{value:"mon",label:"Monday"},{value:"tue",label:"Tuesday"},{value:"wed",label:"Wednesday"},{value:"thu",label:"Thursday"},{value:"fri",label:"Friday"},{value:"sat",label:"Saturday"},{value:"sun",label:"Sunday"}],H=[{value:"jan",label:"January"},{value:"feb",label:"February"},{value:"mar",label:"March"},{value:"apr",label:"April"},{value:"may",label:"May"},{value:"jun",label:"June"},{value:"jul",label:"July"},{value:"aug",label:"August"},{value:"sep",label:"September"},{value:"oct",label:"October"},{value:"nov",label:"November"},{value:"dec",label:"December"}],_=Array.from({length:31},(w,f)=>({value:String(f+1),label:String(f+1)})),A=(w,f,T)=>{if(!w||w==="*")return{start:f,end:T};const j=w.split("-");return j.length===2?{start:j[0],end:j[1]}:{start:f,end:T}},$=async()=>{if(r.intelliflowId){p(!0);try{const f=await(await fetch(`${Oe}/api/query-raw`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`SELECT id, name, time_range, weekday_range, monthday_range, month_range FROM yovo_tbl_ivr_timestamps WHERE ivr_id = ${r.intelliflowId}`})})).json();f.success&&c(f.rows||[])}catch(w){console.error("Failed to fetch timestamps:",w)}finally{p(!1)}}};S.useEffect(()=>{$()},[r.intelliflowId]);const I=async()=>{if(!b.name){y("Timestamp name is required");return}x(!0),y(null);try{const w=k?"/api/update-record":"/api/create-record",f={name:b.name,time_range:`${b.time_start}-${b.time_end}`,weekday_range:`${b.weekday_start}-${b.weekday_end}`,monthday_range:`${b.monthday_start}-${b.monthday_end}`,month_range:`${b.month_start}-${b.month_end}`},T=k?{table:"yovo_tbl_ivr_timestamps",data:f,where:{id:k}}:{table:"yovo_tbl_ivr_timestamps",data:{...f,ivr_id:r.intelliflowId||0}},D=await(await fetch(`${Oe}${w}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)})).json();D.success?(!k&&D.insertId&&(t(String(D.insertId)),n&&n(b.name)),a(!1),h(null),R({name:"",time_start:"00:00:00",time_end:"23:59:59",weekday_start:"mon",weekday_end:"sun",monthday_start:"1",monthday_end:"31",month_start:"jan",month_end:"dec"}),$()):y(D.error||"Failed to save timestamp")}catch(w){y("Failed to save timestamp: "+w.message)}finally{x(!1)}},N=w=>{h(w.id);const f=A(w.time_range,"00:00:00","23:59:59"),T=A(w.weekday_range,"mon","sun"),j=A(w.monthday_range,"1","31"),D=A(w.month_range,"jan","dec");R({name:w.name||"",time_start:f.start,time_end:f.end,weekday_start:T.start,weekday_end:T.end,monthday_start:j.start,monthday_end:j.end,month_start:D.start,month_end:D.end}),a(!0)},L=async w=>{if(confirm("Are you sure you want to delete this timestamp?"))try{(await(await fetch(`${Oe}/api/delete-record`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:"yovo_tbl_ivr_timestamps",where:{id:w}})})).json()).success&&($(),String(e)===String(w)&&(t(""),n&&n("")))}catch(f){console.error("Failed to delete:",f)}},P=w=>{const f=w.time_range||"*",T=w.weekday_range||"*";return`${f} | ${T}`};return l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[l.jsxs("select",{value:e||"",onChange:w=>{const f=u.find(T=>String(T.id)===w.target.value);t(w.target.value),n&&n((f==null?void 0:f.name)||w.target.value)},style:{...ke,flex:1},children:[l.jsx("option",{value:"",children:"-- Select Timestamp --"}),u.map(w=>l.jsxs("option",{value:w.id,children:[w.name," (",w.time_range||"*",")"]},w.id))]}),l.jsx("button",{onClick:()=>$(),style:{...Se,padding:"8px",background:"#f3f4f6",border:"1px solid #e5e7eb"},title:"Refresh",children:l.jsx(ot,{size:16})})]}),u.length>0&&l.jsx("div",{style:{marginBottom:"12px",maxHeight:"150px",overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:"6px"},children:u.map(w=>l.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",borderBottom:"1px solid #f3f4f6",fontSize:"12px",background:String(e)===String(w.id)?"#eff6ff":"transparent"},children:[l.jsxs("div",{style:{flex:1,cursor:"pointer"},onClick:()=>{t(String(w.id)),n&&n(w.name)},children:[l.jsx("div",{style:{fontWeight:"500"},children:w.name}),l.jsx("div",{style:{color:"#6b7280",fontSize:"11px"},children:P(w)})]}),l.jsxs("div",{style:{display:"flex",gap:"4px"},children:[l.jsx("button",{onClick:f=>{f.stopPropagation(),N(w)},style:{background:"transparent",border:"none",cursor:"pointer",padding:"4px"},title:"Edit",children:l.jsx(kr,{size:14,color:"#6b7280"})}),l.jsx("button",{onClick:f=>{f.stopPropagation(),L(w.id)},style:{background:"transparent",border:"none",cursor:"pointer",padding:"4px"},title:"Delete",children:l.jsx(vn,{size:14,color:"#ef4444"})})]})]},w.id))}),l.jsxs("button",{onClick:()=>{h(null),R({name:"",time_start:"00:00:00",time_end:"23:59:59",weekday_start:"mon",weekday_end:"sun",monthday_start:"1",monthday_end:"31",month_start:"jan",month_end:"dec"}),y(null),a(!0)},style:{...Se,background:"#8b5cf6",color:"#fff",border:"none",width:"100%",justifyContent:"center"},children:[l.jsx(or,{size:16})," Create New Timestamp"]}),l.jsxs(jr,{isOpen:s,onClose:()=>{a(!1),h(null),y(null)},title:k?"Edit Timestamp":"Create Timestamp",icon:sp,children:[m&&l.jsx("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"6px",padding:"10px",marginBottom:"16px",color:"#dc2626",fontSize:"13px"},children:m}),l.jsxs("div",{style:{display:"grid",gap:"16px"},children:[l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Timestamp Name *"}),l.jsx("input",{type:"text",value:b.name,onChange:w=>R({...b,name:w.target.value}),placeholder:"e.g., Business Hours",style:ze})]}),l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Time Start (HH:MM:SS)"}),l.jsx("input",{type:"time",step:"1",value:b.time_start,onChange:w=>R({...b,time_start:w.target.value||"00:00:00"}),style:ze})]}),l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Time End (HH:MM:SS)"}),l.jsx("input",{type:"time",step:"1",value:b.time_end,onChange:w=>R({...b,time_end:w.target.value||"23:59:59"}),style:ze})]})]}),l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Weekday Start"}),l.jsx("select",{value:b.weekday_start,onChange:w=>R({...b,weekday_start:w.target.value}),style:ke,children:C.map(w=>l.jsx("option",{value:w.value,children:w.label},w.value))})]}),l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Weekday End"}),l.jsx("select",{value:b.weekday_end,onChange:w=>R({...b,weekday_end:w.target.value}),style:ke,children:C.map(w=>l.jsx("option",{value:w.value,children:w.label},w.value))})]})]}),l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Monthday Start (1-31)"}),l.jsx("select",{value:b.monthday_start,onChange:w=>R({...b,monthday_start:w.target.value}),style:ke,children:_.map(w=>l.jsx("option",{value:w.value,children:w.label},w.value))})]}),l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Monthday End (1-31)"}),l.jsx("select",{value:b.monthday_end,onChange:w=>R({...b,monthday_end:w.target.value}),style:ke,children:_.map(w=>l.jsx("option",{value:w.value,children:w.label},w.value))})]})]}),l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Month Start"}),l.jsx("select",{value:b.month_start,onChange:w=>R({...b,month_start:w.target.value}),style:ke,children:H.map(w=>l.jsx("option",{value:w.value,children:w.label},w.value))})]}),l.jsxs("div",{children:[l.jsx("label",{style:pe,children:"Month End"}),l.jsx("select",{value:b.month_end,onChange:w=>R({...b,month_end:w.target.value}),style:ke,children:H.map(w=>l.jsx("option",{value:w.value,children:w.label},w.value))})]})]})]}),l.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px",justifyContent:"flex-end"},children:[l.jsx("button",{onClick:()=>{a(!1),h(null),y(null)},style:{...Se,background:"#f3f4f6",border:"1px solid #e5e7eb",color:"#374151"},children:"Cancel"}),l.jsxs("button",{onClick:I,disabled:g,style:{...Se,background:"#8b5cf6",color:"#fff",border:"none",opacity:g?.7:1},children:[g?l.jsx(sr,{size:16}):l.jsx(ir,{size:16}),g?"Saving...":k?"Update":"Create"]})]})]})]})},mp=({selectedNode:e,blockTypes:t,onUpdateNode:n,onDeleteNode:r,onCloneNode:o,flowContext:i={}})=>{var H;const[s,a]=S.useState(""),u=So.systemVariables||[];if(!e)return null;const c=(H=e.data)==null?void 0:H.blockDef;if(!c)return null;const d=e.data.properties||{},p=e.data.propertyLabels||{},g=e.data.outputLabels||[...c.outputs.labels||[]],x=c.outputs.mode==="dynamic",m=(_,A)=>{n(e.id,{...e.data,properties:{...d,[_]:A}})},y=(_,A)=>{n(e.id,{...e.data,propertyLabels:{...p,[_]:A}})},k=(_,A)=>{const I=(d[_]||"")+A.key;m(_,I)},h=()=>{if(!s.trim())return;const _=[...g,s.trim()];n(e.id,{...e.data,outputLabels:_}),a("")},b=_=>{const A=g.filter(($,I)=>I!==_);n(e.id,{...e.data,outputLabels:A})},R=(_,A)=>{const $=[...g];$[_]=A,n(e.id,{...e.data,outputLabels:$})},C=_=>{var T,j,D;const A=d[_.key]??_.default??"",$={width:"100%",padding:"8px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"13px",fontFamily:"inherit",transition:"border-color 0.2s ease"},I=({propKey:z})=>{const[E,v]=S.useState(!1);return l.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[l.jsxs("button",{type:"button",onClick:()=>v(!E),style:{padding:"4px 8px",fontSize:"11px",border:"1px solid #d1d5db",borderRadius:"4px",background:"#f9fafb",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",color:"#374151",fontWeight:"500"},title:"Insert system variable",children:["Variables",l.jsx(Dt,{size:12})]}),E&&l.jsxs(l.Fragment,{children:[l.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:999},onClick:()=>v(!1)}),l.jsxs("div",{style:{position:"absolute",top:"100%",left:0,marginTop:"4px",background:"#fff",border:"1px solid #e5e7eb",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,minWidth:"250px",maxHeight:"300px",overflowY:"auto"},children:[l.jsx("div",{style:{padding:"8px 12px",fontSize:"11px",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",borderBottom:"1px solid #f3f4f6"},children:"System Variables"}),u.map(M=>l.jsxs("div",{onClick:()=>{k(z,M),v(!1)},style:{padding:"8px 12px",cursor:"pointer",fontSize:"12px",borderBottom:"1px solid #f9fafb",transition:"background 0.15s ease"},onMouseEnter:O=>{O.currentTarget.style.background="#f9fafb"},onMouseLeave:O=>{O.currentTarget.style.background="transparent"},children:[l.jsx("div",{style:{fontWeight:"500",color:"#374151",marginBottom:"2px",fontFamily:"monospace",fontSize:"11px"},children:M.key}),l.jsx("div",{style:{fontSize:"11px",color:"#9ca3af"},children:M.description})]},M.key))]})]})]})},N=({options:z,value:E,onChange:v,placeholder:M="-- Select --",searchPlaceholder:O="Search...",disabled:V=!1,renderPreview:W=null,selectedOption:X=null})=>{var q;const[U,J]=S.useState(!1),[Q,te]=S.useState(""),ee=S.useRef(null),oe=S.useRef(null),se=z.filter(Y=>(Y.label||"").toLowerCase().includes(Q.toLowerCase())),re=((q=z.find(Y=>Y.value==E))==null?void 0:q.label)||"";S.useEffect(()=>{const Y=F=>{ee.current&&!ee.current.contains(F.target)&&(J(!1),te(""))};return document.addEventListener("mousedown",Y),()=>document.removeEventListener("mousedown",Y)},[]),S.useEffect(()=>{U&&oe.current&&oe.current.focus()},[U]);const le=Y=>{v(Y.value,Y.label),J(!1),te("")},K=Y=>{Y.stopPropagation(),v("",""),te("")};return l.jsxs("div",{ref:ee,style:{position:"relative"},children:[l.jsxs("div",{onClick:()=>!V&&J(!U),style:{width:"100%",padding:"8px 12px",paddingRight:"60px",border:`1px solid ${U?"#3b82f6":"#e5e7eb"}`,borderRadius:"6px",fontSize:"13px",cursor:V?"not-allowed":"pointer",background:V?"#f9fafb":"#fff",opacity:V?.6:1,display:"flex",alignItems:"center",minHeight:"38px",boxSizing:"border-box"},children:[l.jsx("span",{style:{color:E?"#374151":"#9ca3af",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:re||M}),l.jsxs("div",{style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",gap:"4px"},children:[E&&!V&&l.jsx("button",{type:"button",onClick:K,style:{background:"none",border:"none",padding:"4px",cursor:"pointer",color:"#9ca3af",display:"flex",alignItems:"center"},children:l.jsx(tt,{size:14})}),l.jsx(Dt,{size:16,style:{color:"#6b7280",transform:U?"rotate(180deg)":"rotate(0)",transition:"transform 0.2s ease"}})]})]}),U&&l.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"#fff",border:"1px solid #e5e7eb",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"300px",overflow:"hidden",display:"flex",flexDirection:"column"},children:[l.jsx("div",{style:{padding:"8px",borderBottom:"1px solid #f3f4f6"},children:l.jsxs("div",{style:{position:"relative"},children:[l.jsx(un,{size:14,style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"#9ca3af"}}),l.jsx("input",{ref:oe,type:"text",value:Q,onChange:Y=>te(Y.target.value),placeholder:O,style:{width:"100%",padding:"8px 12px 8px 32px",border:"1px solid #e5e7eb",borderRadius:"4px",fontSize:"13px",outline:"none",boxSizing:"border-box"},onFocus:Y=>Y.target.style.borderColor="#3b82f6",onBlur:Y=>Y.target.style.borderColor="#e5e7eb"}),Q&&l.jsx("button",{type:"button",onClick:()=>te(""),style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",padding:"2px",cursor:"pointer",color:"#9ca3af",display:"flex"},children:l.jsx(tt,{size:12})})]})}),l.jsx("div",{style:{overflowY:"auto",maxHeight:"240px"},children:se.length===0?l.jsx("div",{style:{padding:"12px",textAlign:"center",color:"#9ca3af",fontSize:"13px"},children:"No results found"}):se.map(Y=>l.jsx("div",{onClick:()=>le(Y),style:{padding:"10px 12px",cursor:"pointer",fontSize:"13px",color:"#374151",background:Y.value==E?"#eff6ff":"transparent",borderLeft:Y.value==E?"3px solid #3b82f6":"3px solid transparent",transition:"background 0.15s ease"},onMouseEnter:F=>{Y.value!=E&&(F.currentTarget.style.background="#f9fafb")},onMouseLeave:F=>{Y.value!=E&&(F.currentTarget.style.background="transparent")},children:Y.label},Y.value))})]}),W&&X&&W(X)]})},L=({prop:z})=>{const[E,v]=S.useState([]),[M,O]=S.useState(!1),[V,W]=S.useState(null),X=z.dependsOn?d[z.dependsOn]:null,U=z.dependsOn?d[`_${z.dependsOn}_rowData`]:null,J=!!z.dependsOn,Q=J?!!X:!0,te=()=>{if(!z.query)return null;let q=z.query;if(z.dependsOn&&X){const Y=`{{${z.dependsOn}}}`;if(q=q.replace(new RegExp(Y.replace(/[{}]/g,"\\$&"),"g"),X),U){const F=new RegExp(`\\{\\{${z.dependsOn}\\.([^}]+)\\}\\}`,"g");q=q.replace(F,(Z,ie)=>{const ce=U[ie];return ce!==void 0?String(ce).replace(/'/g,"''"):(console.warn(`Column "${ie}" not found in parent row data. Available:`,Object.keys(U)),Z)})}}return q},ee=(q,Y)=>{const F={...d,[z.key]:q};Y&&Y.raw?F[`_${z.key}_rowData`]=Y.raw:delete F[`_${z.key}_rowData`];const Z={...p,[z.key]:(Y==null?void 0:Y.label)||q||""};n(e.id,{...e.data,properties:F,propertyLabels:Z})};S.useEffect(()=>{if(!Q){v([]),A&&m(z.key,"");return}const q=te();q&&oe(q)},[X,U,z.query]);const oe=async q=>{try{O(!0),W(null);const Y=await Qs(q,z.valueField||"id",z.labelField||"label",z.previewField||null,i);if(Y.length===0&&z.dependencyOptional&&z.options){const F=z.options.map(Z=>({value:typeof Z=="object"?Z.value:Z,label:typeof Z=="object"?Z.label:Z,preview:null}));v(F)}else v(Y)}catch(Y){if(console.error("Failed to load options:",Y),W(Y.message),z.dependencyOptional&&z.options){const F=z.options.map(Z=>({value:typeof Z=="object"?Z.value:Z,label:typeof Z=="object"?Z.label:Z,preview:null}));v(F)}else v([])}finally{O(!1)}},se=E.find(q=>q.value==A),re=q=>!z.propertyType||!q?null:f(z.propertyType,q),le=()=>M?"Loading...":Q?z.placeholder||"-- Select --":z.disabledPlaceholder||`Select ${z.dependsOn} first...`,K=M||!Q;return z.searchable?l.jsxs("div",{children:[l.jsx(N,{options:E,value:A,onChange:(q,Y)=>{const F=E.find(Z=>Z.value==q);ee(q,F)},placeholder:le(),searchPlaceholder:z.searchPlaceholder||"Search...",disabled:K,renderPreview:re,selectedOption:se}),J&&!Q&&l.jsxs("div",{style:{marginTop:"6px",padding:"6px 10px",background:"#fef3c7",border:"1px solid #fcd34d",borderRadius:"4px",fontSize:"11px",color:"#92400e",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx(pt,{size:14}),l.jsxs("span",{children:["Select ",l.jsx("strong",{children:z.dependsOn})," first"]})]}),V&&Q&&l.jsxs("div",{style:{marginTop:"6px",padding:"6px 10px",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"4px",fontSize:"11px",color:"#991b1b",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx(pt,{size:14}),l.jsx("span",{children:V})]}),!M&&Q&&l.jsxs("button",{type:"button",onClick:()=>oe(te()),style:{marginTop:"6px",padding:"4px 8px",fontSize:"11px",border:"1px solid #d1d5db",borderRadius:"4px",background:"#fff",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",color:"#374151",fontWeight:"500"},children:[l.jsx(ot,{size:12}),"Refresh"]})]}):l.jsxs("div",{children:[l.jsxs("div",{style:{position:"relative"},children:[l.jsxs("select",{value:A,onChange:q=>{const Y=q.target.value,F=E.find(Z=>Z.value==Y);ee(Y,F)},disabled:K,style:{...$,cursor:K?"not-allowed":"pointer",backgroundImage:K?"none":`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1.5 4.5h9z'/%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 10px center",paddingRight:"32px",appearance:"none",opacity:K?.6:1,backgroundColor:K?"#f9fafb":"#fff"},onFocus:q=>!K&&(q.target.style.borderColor="#3b82f6"),onBlur:q=>q.target.style.borderColor="#e5e7eb",children:[l.jsx("option",{value:"",children:le()}),E.map(q=>l.jsx("option",{value:q.value,children:q.label},q.value))]}),M&&l.jsx("div",{style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",pointerEvents:"none"},children:l.jsx(wo,{size:16,color:"#3b82f6",className:"spin"})})]}),J&&!Q&&l.jsxs("div",{style:{marginTop:"6px",padding:"6px 10px",background:"#fef3c7",border:"1px solid #fcd34d",borderRadius:"4px",fontSize:"11px",color:"#92400e",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx(pt,{size:14}),l.jsxs("span",{children:["Select ",l.jsx("strong",{children:z.dependsOn})," first"]})]}),V&&Q&&l.jsxs("div",{style:{marginTop:"6px",padding:"6px 10px",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"4px",fontSize:"11px",color:"#991b1b",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx(pt,{size:14}),l.jsx("span",{children:V})]}),!M&&Q&&l.jsxs("button",{type:"button",onClick:()=>oe(te()),style:{marginTop:"6px",padding:"4px 8px",fontSize:"11px",border:"1px solid #d1d5db",borderRadius:"4px",background:"#fff",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",color:"#374151",fontWeight:"500"},children:[l.jsx(ot,{size:12}),"Refresh"]}),z.propertyType&&A&&se&&f(z.propertyType,se)]})},P=({prop:z})=>{const[E,v]=S.useState([]),[M,O]=S.useState(!1),[V,W]=S.useState(null),[X,U]=S.useState(!1),[J,Q]=S.useState(""),te=S.useRef(null),ee=S.useRef(null);S.useEffect(()=>{z.groups&&z.groups.length>0&&oe()},[z.groups]),S.useEffect(()=>{const F=Z=>{te.current&&!te.current.contains(Z.target)&&U(!1)};return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[]),S.useEffect(()=>{X&&ee.current&&ee.current.focus()},[X]);const oe=async()=>{try{O(!0),W(null);const F=await hp(z.groups,i);v(F)}catch(F){console.error("Failed to load grouped options:",F),W(F.message),v([])}finally{O(!1)}},re=(()=>{var F,Z;for(let ie=0;ie<E.length;ie++){const ce=E[ie],me=(F=ce.options)==null?void 0:F.find(ge=>ge.value==A);if(me){const ge=(Z=z.groups)==null?void 0:Z[ie];return{...me,groupLabel:ce.label,propertyType:(ge==null?void 0:ge.propertyType)||null}}}return null})(),K=J?E.map(F=>{var Z;return{...F,options:((Z=F.options)==null?void 0:Z.filter(ie=>(ie.label||"").toLowerCase().includes(J.toLowerCase())))||[]}}).filter(F=>F.options.length>0):E,q=(F,Z)=>{m(z.key,F),y(z.key,Z||F),U(!1),Q("")},Y=()=>{m(z.key,""),y(z.key,""),Q("")};return z.searchable?l.jsxs("div",{ref:te,style:{position:"relative"},children:[l.jsxs("div",{onClick:()=>!M&&U(!X),style:{...$,cursor:M?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",opacity:M?.6:1,backgroundColor:"#fff"},children:[l.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:re?"#1f2937":"#9ca3af"},children:M?"Loading...":re?re.label:z.placeholder||"-- Select --"}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[A&&!M&&l.jsx(tt,{size:14,style:{cursor:"pointer",color:"#6b7280"},onClick:F=>{F.stopPropagation(),Y()}}),l.jsx(Dt,{size:16,style:{color:"#6b7280"}})]})]}),X&&l.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"#fff",border:"1px solid #e5e7eb",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:1e3,maxHeight:"300px",overflow:"hidden",display:"flex",flexDirection:"column"},children:[l.jsx("div",{style:{padding:"8px",borderBottom:"1px solid #e5e7eb"},children:l.jsxs("div",{style:{position:"relative"},children:[l.jsx(un,{size:14,style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"#9ca3af"}}),l.jsx("input",{ref:ee,type:"text",value:J,onChange:F=>Q(F.target.value),placeholder:z.searchPlaceholder||"Search...",style:{width:"100%",padding:"8px 8px 8px 32px",border:"1px solid #e5e7eb",borderRadius:"4px",fontSize:"13px",outline:"none"}})]})}),l.jsx("div",{style:{overflowY:"auto",maxHeight:"240px"},children:K.length===0?l.jsx("div",{style:{padding:"12px",textAlign:"center",color:"#9ca3af",fontSize:"13px"},children:"No results found"}):K.map((F,Z)=>{var ie;return l.jsxs("div",{children:[l.jsx("div",{style:{padding:"8px 12px",fontSize:"11px",fontWeight:"600",color:"#6b7280",backgroundColor:"#f9fafb",textTransform:"uppercase",letterSpacing:"0.5px",borderTop:Z>0?"1px solid #e5e7eb":"none"},children:F.label}),(ie=F.options)==null?void 0:ie.map((ce,me)=>l.jsx("div",{onClick:()=>q(ce.value,ce.label),style:{padding:"10px 12px 10px 20px",cursor:"pointer",fontSize:"13px",backgroundColor:ce.value==A?"#eff6ff":"transparent",color:ce.value==A?"#2563eb":"#374151",borderLeft:ce.value==A?"3px solid #2563eb":"3px solid transparent"},onMouseEnter:ge=>{ce.value!=A&&(ge.currentTarget.style.background="#f3f4f6")},onMouseLeave:ge=>{ce.value!=A&&(ge.currentTarget.style.background="transparent")},children:ce.label},`${Z}-${me}`))]},Z)})})]}),V&&l.jsxs("div",{style:{marginTop:"6px",padding:"6px 10px",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"4px",fontSize:"11px",color:"#991b1b",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx(pt,{size:14}),l.jsx("span",{children:V})]}),!M&&l.jsxs("button",{type:"button",onClick:oe,style:{marginTop:"6px",padding:"4px 8px",fontSize:"11px",border:"1px solid #d1d5db",borderRadius:"4px",background:"#fff",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",color:"#374151",fontWeight:"500"},children:[l.jsx(ot,{size:12}),"Refresh"]}),re&&re.propertyType&&re.preview&&f(re.propertyType,re)]}):l.jsxs("div",{children:[l.jsxs("div",{style:{position:"relative"},children:[l.jsxs("select",{value:A,onChange:F=>m(z.key,F.target.value),disabled:M,style:{...$,cursor:M?"wait":"pointer",backgroundImage:M?"none":`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1.5 4.5h9z'/%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 10px center",paddingRight:"32px",appearance:"none",opacity:M?.6:1},children:[l.jsx("option",{value:"",children:M?"Loading...":z.placeholder||"-- Select --"}),E.map((F,Z)=>{var ie;return l.jsx("optgroup",{label:F.label,children:(ie=F.options)==null?void 0:ie.map((ce,me)=>l.jsx("option",{value:ce.value,children:ce.label},`${Z}-${me}`))},Z)})]}),M&&l.jsx("div",{style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",pointerEvents:"none"},children:l.jsx(wo,{size:16,color:"#3b82f6",className:"spin"})})]}),V&&l.jsxs("div",{style:{marginTop:"6px",padding:"6px 10px",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"4px",fontSize:"11px",color:"#991b1b",display:"flex",alignItems:"center",gap:"6px"},children:[l.jsx(pt,{size:14}),l.jsx("span",{children:V})]}),!M&&l.jsxs("button",{type:"button",onClick:oe,style:{marginTop:"6px",padding:"4px 8px",fontSize:"11px",border:"1px solid #d1d5db",borderRadius:"4px",background:"#fff",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",color:"#374151",fontWeight:"500"},children:[l.jsx(ot,{size:12}),"Refresh"]}),re&&re.propertyType&&re.preview&&f(re.propertyType,re)]})},w=({groups:z,value:E,onChange:v,placeholder:M,searchPlaceholder:O})=>{const[V,W]=S.useState(!1),[X,U]=S.useState(""),J=S.useRef(null),Q=S.useRef(null);S.useEffect(()=>{const K=q=>{J.current&&!J.current.contains(q.target)&&W(!1)};return document.addEventListener("mousedown",K),()=>document.removeEventListener("mousedown",K)},[]),S.useEffect(()=>{V&&Q.current&&Q.current.focus()},[V]);const ee=(()=>{var K;for(const q of z){const Y=(K=q.options)==null?void 0:K.find(F=>F.value==E);if(Y)return{...Y,groupLabel:q.label}}return null})(),se=X?z.map(K=>{var q;return{...K,options:((q=K.options)==null?void 0:q.filter(Y=>(Y.label||"").toLowerCase().includes(X.toLowerCase())))||[]}}).filter(K=>K.options.length>0):z,re=(K,q)=>{v(K,q),W(!1),U("")},le=()=>{v("",""),U("")};return l.jsxs("div",{ref:J,style:{position:"relative"},children:[l.jsxs("div",{onClick:()=>W(!V),style:{...$,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"#fff"},children:[l.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:ee?"#1f2937":"#9ca3af"},children:ee?ee.label:M}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[E&&l.jsx(tt,{size:14,style:{cursor:"pointer",color:"#6b7280"},onClick:K=>{K.stopPropagation(),le()}}),l.jsx(Dt,{size:16,style:{color:"#6b7280"}})]})]}),V&&l.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"#fff",border:"1px solid #e5e7eb",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:1e3,maxHeight:"300px",overflow:"hidden",display:"flex",flexDirection:"column"},children:[l.jsx("div",{style:{padding:"8px",borderBottom:"1px solid #e5e7eb"},children:l.jsxs("div",{style:{position:"relative"},children:[l.jsx(un,{size:14,style:{position:"absolute",left:"10px",top:"50%",transform:"translateY(-50%)",color:"#9ca3af"}}),l.jsx("input",{ref:Q,type:"text",value:X,onChange:K=>U(K.target.value),placeholder:O,style:{width:"100%",padding:"8px 8px 8px 32px",border:"1px solid #e5e7eb",borderRadius:"4px",fontSize:"13px",outline:"none"}})]})}),l.jsx("div",{style:{overflowY:"auto",maxHeight:"240px"},children:se.length===0?l.jsx("div",{style:{padding:"12px",textAlign:"center",color:"#9ca3af",fontSize:"13px"},children:"No results found"}):se.map((K,q)=>{var Y;return l.jsxs("div",{children:[l.jsx("div",{style:{padding:"8px 12px",fontSize:"11px",fontWeight:"600",color:"#6b7280",backgroundColor:"#f9fafb",textTransform:"uppercase",letterSpacing:"0.5px",borderTop:q>0?"1px solid #e5e7eb":"none"},children:K.label}),(Y=K.options)==null?void 0:Y.map((F,Z)=>l.jsx("div",{onClick:()=>re(F.value,F.label),style:{padding:"10px 12px 10px 20px",cursor:"pointer",fontSize:"13px",backgroundColor:F.value==E?"#eff6ff":"transparent",color:F.value==E?"#2563eb":"#374151",borderLeft:F.value==E?"3px solid #2563eb":"3px solid transparent"},onMouseEnter:ie=>{F.value!=E&&(ie.currentTarget.style.background="#f3f4f6")},onMouseLeave:ie=>{F.value!=E&&(ie.currentTarget.style.background="transparent")},children:F.label},`${q}-${Z}`))]},q)})})]})]})},f=(z,E)=>{const v=E.preview;if(!v)return null;switch(z){case"media_audio":return l.jsxs("div",{style:{marginTop:"12px",padding:"12px",background:"#f9fafb",borderRadius:"6px",border:"1px solid #e5e7eb"},children:[l.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"8px",textTransform:"uppercase"},children:"Audio Preview"}),l.jsx("audio",{controls:!0,style:{width:"100%",height:"32px"},src:v,children:"Your browser does not support audio playback."})]});case"media_image":return l.jsxs("div",{style:{marginTop:"12px",padding:"12px",background:"#f9fafb",borderRadius:"6px",border:"1px solid #e5e7eb"},children:[l.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"8px",textTransform:"uppercase"},children:"Image Preview"}),l.jsx("img",{src:v,alt:E.label,style:{width:"100%",height:"auto",borderRadius:"4px",maxHeight:"200px",objectFit:"contain",background:"#fff"},onError:M=>{M.target.style.display="none"}})]});case"media_video":return l.jsxs("div",{style:{marginTop:"12px",padding:"12px",background:"#f9fafb",borderRadius:"6px",border:"1px solid #e5e7eb"},children:[l.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#6b7280",marginBottom:"8px",textTransform:"uppercase"},children:"Video Preview"}),l.jsx("video",{controls:!0,style:{width:"100%",height:"auto",borderRadius:"4px",maxHeight:"200px",background:"#000"},src:v,children:"Your browser does not support video playback."})]});default:return null}};switch(_.type){case"text":return l.jsxs("div",{children:[l.jsx("input",{type:"text",value:A,onChange:v=>m(_.key,v.target.value),placeholder:_.placeholder,style:$,onFocus:v=>v.target.style.borderColor="#3b82f6",onBlur:v=>v.target.style.borderColor="#e5e7eb"}),_.showPredefinedVariables&&l.jsx("div",{style:{marginTop:"6px"},children:l.jsx(I,{propKey:_.key})})]});case"textarea":return l.jsxs("div",{children:[l.jsx("textarea",{value:A,onChange:v=>m(_.key,v.target.value),placeholder:_.placeholder,rows:4,style:{...$,fontFamily:"Monaco, Consolas, monospace",fontSize:"12px",resize:"vertical"},onFocus:v=>v.target.style.borderColor="#3b82f6",onBlur:v=>v.target.style.borderColor="#e5e7eb"}),_.showPredefinedVariables&&l.jsx("div",{style:{marginTop:"6px"},children:l.jsx(I,{propKey:_.key})})]});case"number":return l.jsx("input",{type:"number",value:A,onChange:v=>m(_.key,parseFloat(v.target.value)),min:_.min,max:_.max,step:_.step||1,style:$,onFocus:v=>v.target.style.borderColor="#3b82f6",onBlur:v=>v.target.style.borderColor="#e5e7eb"});case"boolean":return l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",padding:"8px 0"},children:[l.jsx("input",{type:"checkbox",checked:A,onChange:v=>m(_.key,v.target.checked),style:{width:"18px",height:"18px",cursor:"pointer",accentColor:c.color}}),l.jsx("span",{style:{fontSize:"13px",color:"#374151"},children:"Enable"})]});case"select":if(_.groups&&_.groups.length>0){if(_.searchable){const v=_.groups.map(M=>({label:M.label,options:(M.options||[]).map(O=>({value:typeof O=="object"?O.value:O,label:typeof O=="object"?O.label:O}))}));return l.jsx(w,{groups:v,value:A,onChange:(M,O)=>{m(_.key,M),y(_.key,O||M)},placeholder:_.placeholder||"-- Select --",searchPlaceholder:_.searchPlaceholder||"Search..."})}return l.jsxs("select",{value:A,onChange:v=>{const M=v.target.value;let O=M;for(const V of _.groups){const W=(V.options||[]).find(X=>{const U=typeof X=="object"?X.value:X;return String(U)===M});if(W){O=typeof W=="object"?W.label:W;break}}m(_.key,M),y(_.key,O)},style:{...$,cursor:"pointer",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1.5 4.5h9z'/%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 10px center",paddingRight:"32px",appearance:"none"},onFocus:v=>v.target.style.borderColor="#3b82f6",onBlur:v=>v.target.style.borderColor="#e5e7eb",children:[l.jsx("option",{value:"",children:_.placeholder||"-- Select --"}),_.groups.map((v,M)=>l.jsx("optgroup",{label:v.label,children:(v.options||[]).map((O,V)=>{const W=typeof O=="object"?O.value:O,X=typeof O=="object"?O.label:O;return l.jsx("option",{value:W,children:X},`${M}-${V}`)})},M))]})}const z=(_.options||[]).map(v=>({value:typeof v=="object"?v.value:v,label:typeof v=="object"?v.label:v}));return _.searchable?l.jsx(N,{options:z,value:A,onChange:(v,M)=>{m(_.key,v),y(_.key,M||v)},placeholder:_.placeholder||"-- Select --",searchPlaceholder:_.searchPlaceholder||"Search..."}):l.jsxs("select",{value:A,onChange:v=>{const M=v.target.value,O=(_.options||[]).find(W=>{const X=typeof W=="object"?W.value:W;return String(X)===M}),V=O?typeof O=="object"?O.label:O:M;m(_.key,M),y(_.key,V)},style:{...$,cursor:"pointer",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1.5 4.5h9z'/%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 10px center",paddingRight:"32px",appearance:"none"},onFocus:v=>v.target.style.borderColor="#3b82f6",onBlur:v=>v.target.style.borderColor="#e5e7eb",children:[l.jsx("option",{value:"",children:_.placeholder||"-- Select --"}),(_.options||[]).map((v,M)=>{const O=typeof v=="object"?v.value:v,V=typeof v=="object"?v.label:v;return l.jsx("option",{value:O,children:V},M)})]});case"select_database":return _.key==="gotoiftime_condition"||_.key==="gotoiftimemulti_condition"?l.jsx(yp,{value:A,onChange:v=>m(_.key,v),onLabelChange:v=>y(_.key,v),flowContext:i,prop:_}):(((T=_.key)==null?void 0:T.includes("_variable"))||_.key==="ivr_variable"||((j=_.key)==null?void 0:j.includes("variable_name")))&&((D=_.query)==null?void 0:D.toLowerCase().includes("variable"))?l.jsx(xp,{value:A,onChange:v=>m(_.key,v),onLabelChange:v=>y(_.key,v),flowContext:i,prop:_}):_.key==="database_connection"||_.key==="db_connection"||_.customComponent==="database"?l.jsx(gp,{value:A,onChange:v=>m(_.key,v),onLabelChange:v=>y(_.key,v),flowContext:i,prop:_}):_.groups&&_.groups.length>0?l.jsx(P,{prop:_}):l.jsx(L,{prop:_});default:return l.jsxs("div",{style:{fontSize:"12px",color:"#ef4444"},children:["Unsupported type: ",_.type]})}};return l.jsxs("div",{style:{width:"320px",background:"#fff",borderLeft:"1px solid #e5e7eb",padding:"20px",overflowY:"auto",height:"100vh"},children:[l.jsxs("div",{style:{marginBottom:"24px"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},children:[l.jsx("div",{style:{fontSize:"20px",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",background:`${c.color}15`,borderRadius:"8px"},children:c.icon}),l.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"700",color:"#1a1a1a",letterSpacing:"-0.01em"},children:c.name})]}),l.jsx("div",{style:{fontSize:"11px",color:"#6b7280",fontFamily:"Monaco, Consolas, monospace"},children:e.id})]}),c.properties.length>0&&l.jsxs("div",{style:{marginBottom:"24px"},children:[l.jsx("h4",{style:{fontSize:"13px",fontWeight:"600",marginBottom:"16px",color:"#374151",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Properties"}),c.properties.map(_=>l.jsxs("div",{style:{marginBottom:"16px"},children:[l.jsxs("label",{style:{display:"block",marginBottom:"6px",fontSize:"13px",fontWeight:"500",color:"#374151"},children:[_.label,_.required&&l.jsx("span",{style:{color:"#ef4444",marginLeft:"2px"},children:"*"})]}),C(_)]},_.key))]}),!x&&c.outputs.labels&&c.outputs.labels.length>4&&l.jsxs("div",{style:{marginBottom:"24px"},children:[l.jsxs("h4",{style:{fontSize:"13px",fontWeight:"600",marginBottom:"12px",color:"#374151",textTransform:"uppercase",letterSpacing:"0.05em",display:"flex",alignItems:"center",gap:"8px"},children:["Output Branches",l.jsxs("span",{style:{fontSize:"10px",fontWeight:"600",background:"#fef3c7",color:"#92400e",padding:"2px 8px",borderRadius:"12px",textTransform:"none",letterSpacing:"normal"},children:[(e.data.enabledOutputs||c.outputs.labels).length," / ",c.outputs.labels.length," Active"]})]}),l.jsx("div",{style:{fontSize:"11px",color:"#6b7280",marginBottom:"12px",padding:"8px 10px",background:"#f9fafb",borderRadius:"6px"},children:" Select which output branches to show on the canvas. Disabled branches won't appear but can be re-enabled anytime."}),l.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"12px",paddingBottom:"12px",borderBottom:"1px solid #f3f4f6"},children:[l.jsx("button",{onClick:()=>{n(e.id,{...e.data,enabledOutputs:c.outputs.labels.map((_,A)=>A)})},style:{padding:"6px 12px",fontSize:"11px",background:"#f3f4f6",border:"1px solid #e5e7eb",borderRadius:"4px",cursor:"pointer",fontWeight:"500"},children:" Enable All"}),l.jsx("button",{onClick:()=>{n(e.id,{...e.data,enabledOutputs:[]})},style:{padding:"6px 12px",fontSize:"11px",background:"#f3f4f6",border:"1px solid #e5e7eb",borderRadius:"4px",cursor:"pointer",fontWeight:"500"},children:" Disable All"})]}),l.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"6px",maxHeight:"300px",overflowY:"auto",padding:"4px"},children:c.outputs.labels.map((_,A)=>{const $=e.data.enabledOutputs||c.outputs.labels.map((N,L)=>L),I=$.includes(A);return l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 10px",background:I?"#ecfdf5":"#f9fafb",border:`1px solid ${I?"#a7f3d0":"#e5e7eb"}`,borderRadius:"6px",cursor:"pointer",transition:"all 0.15s ease"},onMouseEnter:N=>{N.currentTarget.style.borderColor=I?"#34d399":"#d1d5db"},onMouseLeave:N=>{N.currentTarget.style.borderColor=I?"#a7f3d0":"#e5e7eb"},children:[l.jsx("input",{type:"checkbox",checked:I,onChange:N=>{let L;N.target.checked?L=[...$,A].sort((P,w)=>P-w):L=$.filter(P=>P!==A),n(e.id,{...e.data,enabledOutputs:L})},style:{width:"16px",height:"16px",accentColor:"#10b981",cursor:"pointer"}}),l.jsxs("div",{style:{flex:1,minWidth:0},children:[l.jsx("div",{style:{fontSize:"12px",fontWeight:"500",color:I?"#065f46":"#6b7280",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:_}),l.jsxs("div",{style:{fontSize:"10px",color:"#9ca3af"},children:["Index: ",A]})]})]},A)})})]}),x&&l.jsxs("div",{style:{marginBottom:"24px"},children:[l.jsxs("h4",{style:{fontSize:"13px",fontWeight:"600",marginBottom:"12px",color:"#374151",textTransform:"uppercase",letterSpacing:"0.05em",display:"flex",alignItems:"center",gap:"8px"},children:["Output Branches",l.jsx("span",{style:{fontSize:"10px",fontWeight:"600",background:"#dbeafe",color:"#1e40af",padding:"2px 8px",borderRadius:"12px",textTransform:"none",letterSpacing:"normal"},children:"Dynamic"})]}),l.jsx("div",{style:{marginBottom:"12px"},children:g.map((_,A)=>l.jsxs("div",{style:{display:"flex",gap:"6px",marginBottom:"8px",alignItems:"center"},children:[l.jsx("input",{type:"text",value:_,onChange:$=>R(A,$.target.value),style:{flex:1,padding:"8px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"13px"},onFocus:$=>$.target.style.borderColor="#3b82f6",onBlur:$=>$.target.style.borderColor="#e5e7eb"}),l.jsx("button",{onClick:()=>b(A),style:{background:"#fff",color:"#ef4444",border:"1px solid #fecaca",borderRadius:"6px",padding:"8px 10px",cursor:"pointer",fontSize:"16px",lineHeight:"1"},title:"Remove branch",children:""})]},A))}),l.jsxs("div",{style:{display:"flex",gap:"6px",marginTop:"12px",paddingTop:"12px",borderTop:"1px solid #f3f4f6"},children:[l.jsx("input",{type:"text",value:s,onChange:_=>a(_.target.value),onKeyPress:_=>{_.key==="Enter"&&h()},placeholder:"New branch name...",style:{flex:1,padding:"8px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"13px"},onFocus:_=>_.target.style.borderColor="#3b82f6",onBlur:_=>_.target.style.borderColor="#e5e7eb"}),l.jsx("button",{onClick:h,disabled:!s.trim(),style:{background:s.trim()?"#3b82f6":"#e5e7eb",color:s.trim()?"#fff":"#9ca3af",border:"none",borderRadius:"6px",padding:"8px 16px",cursor:s.trim()?"pointer":"not-allowed",fontSize:"13px",fontWeight:"600"},children:"Add"})]})]}),l.jsx("div",{style:{marginBottom:"24px",padding:"12px",background:"#f9fafb",borderRadius:"8px",border:"1px solid #f3f4f6"},children:l.jsxs("div",{style:{fontSize:"12px",color:"#6b7280",lineHeight:"1.6"},children:[l.jsxs("div",{style:{marginBottom:"4px"},children:[l.jsx("strong",{style:{color:"#374151"},children:"Inputs:"})," ",c.inputs.min," - ",c.inputs.max===-1?"":c.inputs.max]}),l.jsxs("div",{children:[l.jsx("strong",{style:{color:"#374151"},children:"Outputs:"})," ",c.outputs.min," - ",c.outputs.max===-1?"":c.outputs.max,x&&` (${g.length} active)`]})]})}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[l.jsx("button",{onClick:()=>o(e.id),style:{padding:"10px",background:"#fff",color:"#3b82f6",border:"1px solid #3b82f6",borderRadius:"8px",cursor:"pointer",fontSize:"13px",fontWeight:"600"},children:"Clone Block"}),l.jsx("button",{onClick:()=>r(e.id),style:{padding:"10px",background:"#fff",color:"#ef4444",border:"1px solid #fecaca",borderRadius:"8px",cursor:"pointer",fontSize:"13px",fontWeight:"600"},children:"Delete Block"})]}),l.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
          .spin {
            animation: spin 1s linear infinite;
          }
        `})]})},bp=({onZoomIn:e,onZoomOut:t,onFitView:n,onExport:r,onImport:o,onClear:i})=>{const s=()=>{window.open("/block-editor.html","_blank")};return l.jsxs("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:"#fff",borderRadius:"10px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",display:"flex",gap:"4px",padding:"6px",zIndex:10,border:"1px solid #e5e7eb"},children:[l.jsx("button",{onClick:e,style:Qe,title:"Zoom In",onMouseOver:a=>a.currentTarget.style.background="#f3f4f6",onMouseOut:a=>a.currentTarget.style.background="transparent",children:l.jsx(lp,{size:18})}),l.jsx("button",{onClick:t,style:Qe,title:"Zoom Out",onMouseOver:a=>a.currentTarget.style.background="#f3f4f6",onMouseOut:a=>a.currentTarget.style.background="transparent",children:l.jsx(cp,{size:18})}),l.jsx("button",{onClick:n,style:Qe,title:"Fit View",onMouseOver:a=>a.currentTarget.style.background="#f3f4f6",onMouseOut:a=>a.currentTarget.style.background="transparent",children:l.jsx(ip,{size:18})}),l.jsx("div",{style:{width:"1px",background:"#e5e7eb",margin:"4px 4px"}}),l.jsx("button",{onClick:r,style:Qe,title:"Export Flow JSON",onMouseOver:a=>a.currentTarget.style.background="#f3f4f6",onMouseOut:a=>a.currentTarget.style.background="transparent",children:l.jsx(Pi,{size:18})}),l.jsx("button",{onClick:o,style:Qe,title:"Import Flow JSON",onMouseOver:a=>a.currentTarget.style.background="#f3f4f6",onMouseOut:a=>a.currentTarget.style.background="transparent",children:l.jsx(Oi,{size:18})}),l.jsx("div",{style:{width:"1px",background:"#e5e7eb",margin:"4px 4px"}}),l.jsx("button",{onClick:s,style:{...Qe,color:"#6366f1"},title:"Block Definition Editor",onMouseOver:a=>{a.currentTarget.style.background="#eef2ff"},onMouseOut:a=>{a.currentTarget.style.background="transparent"},children:l.jsx(Bi,{size:18})}),l.jsx("button",{onClick:i,style:{...Qe,color:"#ef4444"},title:"Clear All",onMouseOver:a=>{a.currentTarget.style.background="#fef2f2"},onMouseOut:a=>{a.currentTarget.style.background="transparent"},children:l.jsx(vn,{size:18})})]})},Qe={background:"transparent",border:"none",padding:"8px",cursor:"pointer",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",color:"#374151"},vp={custom:op},wp={custom:up};let Sp=1;const _p=()=>{const e=new URLSearchParams(window.location.search),t={};for(const[n,r]of e.entries())t[n]=r;return t};function Ep(){const e=S.useRef(null),[t,n,r]=Rf([]),[o,i,s]=Af([]),[a,u]=S.useState(null),[c,d]=S.useState(null),p=S.useMemo(()=>_p(),[]),g=So.blockTypes;S.useEffect(()=>{const P=w=>{const{edgeId:f}=w.detail;i(T=>T.filter(j=>j.id!==f))};return window.addEventListener("deleteEdge",P),()=>{window.removeEventListener("deleteEdge",P)}},[i]);const x=S.useCallback(P=>{var E,v;const w=t.find(M=>M.id===P.source),f=t.find(M=>M.id===P.target);if(!w||!f)return!1;const T=(E=w.data)==null?void 0:E.blockDef,j=(v=f.data)==null?void 0:v.blockDef;if(!T||!j)return!1;const D=o.filter(M=>M.source===P.source&&M.sourceHandle===P.sourceHandle).length,z=o.filter(M=>M.target===P.target&&M.targetHandle===P.targetHandle).length;return!(T.outputs.max!==-1&&D>=T.outputs.max||j.inputs.max!==-1&&z>=j.inputs.max)},[t,o]),m=S.useCallback(P=>{x(P)&&i(w=>ps({...P,type:"custom",markerEnd:{type:jt.ArrowClosed,color:"#94a3b8"}},w))},[x,i]),y=S.useCallback(P=>{P.preventDefault(),P.dataTransfer.dropEffect="move"},[]),k=S.useCallback(P=>{P.preventDefault();const w=P.dataTransfer.getData("application/reactflow");if(!w)return;const f=g[w];if(!f)return;const T=a.screenToFlowPosition({x:P.clientX,y:P.clientY}),j=f.outputs.mode==="dynamic"?[...f.outputs.labels||[]]:void 0,D={id:`node-${Sp++}`,type:"custom",position:T,data:{blockDef:f,properties:{},...j&&{outputLabels:j}}};n(z=>z.concat(D))},[a,g,n]),h=S.useCallback((P,w)=>{d(w)},[]),b=S.useCallback(()=>{d(null)},[]),R=S.useCallback((P,w)=>{n(f=>f.map(T=>T.id===P?{...T,data:w}:T)),d(f=>f&&f.id===P?{...f,data:w}:f)},[n]),C=S.useCallback(P=>{n(w=>w.filter(f=>f.id!==P)),i(w=>w.filter(f=>f.source!==P&&f.target!==P)),d(null)},[n,i]),H=S.useCallback(P=>{const w=t.find(T=>T.id===P);if(!w)return;const f={...w,id:`node-${P++}`,position:{x:w.position.x+50,y:w.position.y+50},data:{...w.data,properties:{...w.data.properties},...w.data.outputLabels&&{outputLabels:[...w.data.outputLabels]},...w.data.enabledOutputs&&{enabledOutputs:[...w.data.enabledOutputs]}}};n(T=>T.concat(f))},[t,n]),_=S.useCallback(()=>{const P={version:"1.0",blocks:t.map(D=>({id:D.id,type:D.type==="custom"?D.data.blockDef.id:D.type,position:D.position,properties:D.data.properties||{},...D.data.outputLabels&&{outputLabels:D.data.outputLabels},...D.data.enabledOutputs&&{enabledOutputs:D.data.enabledOutputs}})),connections:o.map(D=>({id:D.id,from:D.source,to:D.target,sourceHandle:D.sourceHandle,targetHandle:D.targetHandle}))},w=JSON.stringify(P,null,2),f="data:application/json;charset=utf-8,"+encodeURIComponent(w),T=`flow-${Date.now()}.json`,j=document.createElement("a");j.setAttribute("href",f),j.setAttribute("download",T),j.click()},[t,o]),A=S.useCallback(()=>{const P=document.createElement("input");P.type="file",P.accept=".json",P.onchange=w=>{const f=w.target.files[0],T=new FileReader;T.onload=j=>{try{const D=JSON.parse(j.target.result),z=D.blocks.map(v=>({id:v.id,type:"custom",position:v.position,data:{blockDef:g[v.type],properties:v.properties||{},...v.outputLabels&&{outputLabels:v.outputLabels},...v.enabledOutputs&&{enabledOutputs:v.enabledOutputs}}})),E=D.connections.map(v=>({id:v.id,source:v.from,target:v.to,sourceHandle:v.sourceHandle,targetHandle:v.targetHandle,type:"custom",markerEnd:{type:jt.ArrowClosed,color:"#94a3b8"}}));n(z),i(E),alert("Flow imported successfully!")}catch(D){alert("Error importing flow: "+D.message)}},T.readAsText(f)},P.click()},[g,n,i]),$=S.useCallback(()=>{confirm("Are you sure you want to clear all blocks?")&&(n([]),i([]),d(null))},[n,i]),I=S.useCallback(()=>{a==null||a.zoomIn()},[a]),N=S.useCallback(()=>{a==null||a.zoomOut()},[a]),L=S.useCallback(()=>{a==null||a.fitView()},[a]);return l.jsxs("div",{style:{display:"flex",height:"100vh",width:"100vw",background:"#f9fafb"},children:[l.jsx(dp,{blockTypes:g}),l.jsxs("div",{ref:e,style:{flex:1,position:"relative"},children:[l.jsx(bp,{onZoomIn:I,onZoomOut:N,onFitView:L,onExport:_,onImport:A,onClear:$}),l.jsxs(qs,{nodes:t,edges:o,onNodesChange:r,onEdgesChange:s,onConnect:m,onInit:u,onDrop:k,onDragOver:y,onNodeClick:h,onPaneClick:b,nodeTypes:vp,edgeTypes:wp,isValidConnection:x,deleteKeyCode:["Backspace","Delete"],edgesFocusable:!0,edgesUpdatable:!0,fitView:!0,children:[l.jsx(rp,{variant:"dots",gap:16,size:1,color:"#d1d5db"}),l.jsx(Kf,{}),l.jsx(Wf,{nodeColor:P=>{var w;return((w=P.data.blockDef)==null?void 0:w.color)||"#999"},style:{background:"#f8f9fa",border:"1px solid #e5e7eb",borderRadius:"8px"},maskColor:"rgba(0, 0, 0, 0.1)",pannable:!0,zoomable:!0})]})]}),c&&l.jsx(mp,{selectedNode:c,blockTypes:g,onUpdateNode:R,onDeleteNode:C,onCloneNode:H,flowContext:p})]})}function kp(){return l.jsx(Er,{children:l.jsx(Ep,{})})}Hi.createRoot(document.getElementById("root")).render(l.jsx(B.StrictMode,{children:l.jsx(kp,{})}));
